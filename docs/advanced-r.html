<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1.1 Advanced R | _main.utf8.md</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="1.1 Advanced R | _main.utf8.md" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1.1 Advanced R | _main.utf8.md" />
  
  
  

<meta name="author" content="Chase Hickman" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="programming.html"/>
<link rel="next" href="misc-temp-r.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Chase Hickman</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="licensing.html"><a href="licensing.html"><i class="fa fa-check"></i>Licensing</a></li>
<li class="chapter" data-level="" data-path="about-the-author.html"><a href="about-the-author.html"><i class="fa fa-check"></i>About the Author</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i><b>1</b> Programming</a>
<ul>
<li class="chapter" data-level="1.1" data-path="advanced-r.html"><a href="advanced-r.html"><i class="fa fa-check"></i><b>1.1</b> Advanced R</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="advanced-r.html"><a href="advanced-r.html#arnandv"><i class="fa fa-check"></i><b>1.1.1</b> Names and Values</a>
<ul>
<li class="chapter" data-level="1.1.1.1" data-path="advanced-r.html"><a href="advanced-r.html#arbinding"><i class="fa fa-check"></i><b>1.1.1.1</b> Binding</a></li>
<li class="chapter" data-level="1.1.1.2" data-path="advanced-r.html"><a href="advanced-r.html#arsyntacticnames"><i class="fa fa-check"></i><b>1.1.1.2</b> Syntactic Names</a></li>
<li class="chapter" data-level="1.1.1.3" data-path="advanced-r.html"><a href="advanced-r.html#arcopyonmod"><i class="fa fa-check"></i><b>1.1.1.3</b> Copy-on-Modify</a>
<ul>
<li class="chapter" data-level="1.1.1.3.1" data-path="advanced-r.html"><a href="advanced-r.html#artracecopy"><i class="fa fa-check"></i><b>1.1.1.3.1</b> Trace Copying of Objects</a></li>
<li class="chapter" data-level="1.1.1.3.2" data-path="advanced-r.html"><a href="advanced-r.html#arlobjects"><i class="fa fa-check"></i><b>1.1.1.3.2</b> List Objects</a></li>
<li class="chapter" data-level="1.1.1.3.3" data-path="advanced-r.html"><a href="advanced-r.html#ardataframes"><i class="fa fa-check"></i><b>1.1.1.3.3</b> Data Frames</a></li>
<li class="chapter" data-level="1.1.1.3.4" data-path="advanced-r.html"><a href="advanced-r.html#archarvar"><i class="fa fa-check"></i><b>1.1.1.3.4</b> Character Vectors</a></li>
</ul></li>
<li class="chapter" data-level="1.1.1.4" data-path="advanced-r.html"><a href="advanced-r.html#arobjsize"><i class="fa fa-check"></i><b>1.1.1.4</b> Object Size</a></li>
<li class="chapter" data-level="1.1.1.5" data-path="advanced-r.html"><a href="advanced-r.html#armodinplace"><i class="fa fa-check"></i><b>1.1.1.5</b> Modify-in-Place</a></li>
<li class="chapter" data-level="1.1.1.6" data-path="advanced-r.html"><a href="advanced-r.html#argc"><i class="fa fa-check"></i><b>1.1.1.6</b> Unbinding and Garbage Collector (GC)</a></li>
</ul></li>
<li class="chapter" data-level="1.1.2" data-path="advanced-r.html"><a href="advanced-r.html#arv"><i class="fa fa-check"></i><b>1.1.2</b> Vectors</a>
<ul>
<li class="chapter" data-level="1.1.2.1" data-path="advanced-r.html"><a href="advanced-r.html#atomic-vectors"><i class="fa fa-check"></i><b>1.1.2.1</b> Atomic Vectors</a>
<ul>
<li class="chapter" data-level="1.1.2.1.1" data-path="advanced-r.html"><a href="advanced-r.html#types"><i class="fa fa-check"></i><b>1.1.2.1.1</b> Types</a></li>
<li class="chapter" data-level="1.1.2.1.2" data-path="advanced-r.html"><a href="advanced-r.html#combine-scalars"><i class="fa fa-check"></i><b>1.1.2.1.2</b> Combine scalars</a></li>
<li class="chapter" data-level="1.1.2.1.3" data-path="advanced-r.html"><a href="advanced-r.html#missing-values"><i class="fa fa-check"></i><b>1.1.2.1.3</b> Missing values</a></li>
<li class="chapter" data-level="1.1.2.1.4" data-path="advanced-r.html"><a href="advanced-r.html#testing-and-coercing-vectors"><i class="fa fa-check"></i><b>1.1.2.1.4</b> Testing and coercing vectors</a></li>
</ul></li>
<li class="chapter" data-level="1.1.2.2" data-path="advanced-r.html"><a href="advanced-r.html#attributes"><i class="fa fa-check"></i><b>1.1.2.2</b> Attributes</a>
<ul>
<li class="chapter" data-level="1.1.2.2.1" data-path="advanced-r.html"><a href="advanced-r.html#getting-and-setting-attributes"><i class="fa fa-check"></i><b>1.1.2.2.1</b> Getting and setting attributes</a></li>
<li class="chapter" data-level="1.1.2.2.2" data-path="advanced-r.html"><a href="advanced-r.html#names"><i class="fa fa-check"></i><b>1.1.2.2.2</b> Names</a></li>
<li class="chapter" data-level="1.1.2.2.3" data-path="advanced-r.html"><a href="advanced-r.html#dimensions"><i class="fa fa-check"></i><b>1.1.2.2.3</b> Dimensions</a></li>
</ul></li>
<li class="chapter" data-level="1.1.2.3" data-path="advanced-r.html"><a href="advanced-r.html#s3-atomic-vectors"><i class="fa fa-check"></i><b>1.1.2.3</b> S3 Atomic Vectors</a>
<ul>
<li class="chapter" data-level="1.1.2.3.1" data-path="advanced-r.html"><a href="advanced-r.html#factors"><i class="fa fa-check"></i><b>1.1.2.3.1</b> Factors</a></li>
<li class="chapter" data-level="1.1.2.3.2" data-path="advanced-r.html"><a href="advanced-r.html#dates"><i class="fa fa-check"></i><b>1.1.2.3.2</b> Dates</a></li>
<li class="chapter" data-level="1.1.2.3.3" data-path="advanced-r.html"><a href="advanced-r.html#date-times"><i class="fa fa-check"></i><b>1.1.2.3.3</b> Date-times</a></li>
<li class="chapter" data-level="1.1.2.3.4" data-path="advanced-r.html"><a href="advanced-r.html#difftimes"><i class="fa fa-check"></i><b>1.1.2.3.4</b> Difftimes</a></li>
</ul></li>
<li class="chapter" data-level="1.1.2.4" data-path="advanced-r.html"><a href="advanced-r.html#lists"><i class="fa fa-check"></i><b>1.1.2.4</b> Lists</a>
<ul>
<li class="chapter" data-level="1.1.2.4.1" data-path="advanced-r.html"><a href="advanced-r.html#testing-and-coercing-lists"><i class="fa fa-check"></i><b>1.1.2.4.1</b> Testing and coercing lists</a></li>
</ul></li>
<li class="chapter" data-level="1.1.2.5" data-path="advanced-r.html"><a href="advanced-r.html#data-frames-and-tibbles"><i class="fa fa-check"></i><b>1.1.2.5</b> Data frames and tibbles</a>
<ul>
<li class="chapter" data-level="1.1.2.5.1" data-path="advanced-r.html"><a href="advanced-r.html#creating-data.frame-or-tbl_df"><i class="fa fa-check"></i><b>1.1.2.5.1</b> Creating data.frame or tbl_df</a></li>
<li class="chapter" data-level="1.1.2.5.2" data-path="advanced-r.html"><a href="advanced-r.html#row-names"><i class="fa fa-check"></i><b>1.1.2.5.2</b> Row Names</a></li>
<li class="chapter" data-level="1.1.2.5.3" data-path="advanced-r.html"><a href="advanced-r.html#subsetting"><i class="fa fa-check"></i><b>1.1.2.5.3</b> Subsetting</a></li>
<li class="chapter" data-level="1.1.2.5.4" data-path="advanced-r.html"><a href="advanced-r.html#testing-and-coercion"><i class="fa fa-check"></i><b>1.1.2.5.4</b> Testing and coercion</a></li>
<li class="chapter" data-level="1.1.2.5.5" data-path="advanced-r.html"><a href="advanced-r.html#list-columns"><i class="fa fa-check"></i><b>1.1.2.5.5</b> List Columns</a></li>
</ul></li>
<li class="chapter" data-level="1.1.2.6" data-path="advanced-r.html"><a href="advanced-r.html#null"><i class="fa fa-check"></i><b>1.1.2.6</b> NULL</a></li>
</ul></li>
<li class="chapter" data-level="1.1.3" data-path="advanced-r.html"><a href="advanced-r.html#arsub"><i class="fa fa-check"></i><b>1.1.3</b> Subsetting</a>
<ul>
<li class="chapter" data-level="1.1.3.1" data-path="advanced-r.html"><a href="advanced-r.html#selecting-multiple-elements"><i class="fa fa-check"></i><b>1.1.3.1</b> Selecting multiple elements</a>
<ul>
<li class="chapter" data-level="1.1.3.1.1" data-path="advanced-r.html"><a href="advanced-r.html#atomic-vectors-1"><i class="fa fa-check"></i><b>1.1.3.1.1</b> Atomic Vectors</a></li>
<li class="chapter" data-level="1.1.3.1.2" data-path="advanced-r.html"><a href="advanced-r.html#lists-1"><i class="fa fa-check"></i><b>1.1.3.1.2</b> Lists</a></li>
<li class="chapter" data-level="1.1.3.1.3" data-path="advanced-r.html"><a href="advanced-r.html#matrices-and-arrays"><i class="fa fa-check"></i><b>1.1.3.1.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="1.1.3.1.4" data-path="advanced-r.html"><a href="advanced-r.html#data-frames-and-tibbles-1"><i class="fa fa-check"></i><b>1.1.3.1.4</b> Data frames and tibbles</a></li>
</ul></li>
<li class="chapter" data-level="1.1.3.2" data-path="advanced-r.html"><a href="advanced-r.html#selecting-a-single-element"><i class="fa fa-check"></i><b>1.1.3.2</b> Selecting a single element</a>
<ul>
<li class="chapter" data-level="1.1.3.2.1" data-path="advanced-r.html"><a href="advanced-r.html#section"><i class="fa fa-check"></i><b>1.1.3.2.1</b> [[</a></li>
<li class="chapter" data-level="1.1.3.2.2" data-path="advanced-r.html"><a href="advanced-r.html#section-1"><i class="fa fa-check"></i><b>1.1.3.2.2</b> $</a></li>
</ul></li>
<li class="chapter" data-level="1.1.3.3" data-path="advanced-r.html"><a href="advanced-r.html#subassignment"><i class="fa fa-check"></i><b>1.1.3.3</b> Subassignment</a></li>
<li class="chapter" data-level="1.1.3.4" data-path="advanced-r.html"><a href="advanced-r.html#applications"><i class="fa fa-check"></i><b>1.1.3.4</b> Applications</a>
<ul>
<li class="chapter" data-level="1.1.3.4.1" data-path="advanced-r.html"><a href="advanced-r.html#lookup-tables"><i class="fa fa-check"></i><b>1.1.3.4.1</b> Lookup tables</a></li>
<li class="chapter" data-level="1.1.3.4.2" data-path="advanced-r.html"><a href="advanced-r.html#matching-and-merging-by-integer-subsetting"><i class="fa fa-check"></i><b>1.1.3.4.2</b> Matching and merging by integer subsetting</a></li>
<li class="chapter" data-level="1.1.3.4.3" data-path="advanced-r.html"><a href="advanced-r.html#random-and-bootstrap-sampling"><i class="fa fa-check"></i><b>1.1.3.4.3</b> Random and Bootstrap sampling</a></li>
<li class="chapter" data-level="1.1.3.4.4" data-path="advanced-r.html"><a href="advanced-r.html#arordering"><i class="fa fa-check"></i><b>1.1.3.4.4</b> Ordering</a></li>
<li class="chapter" data-level="1.1.3.4.5" data-path="advanced-r.html"><a href="advanced-r.html#random-sort"><i class="fa fa-check"></i><b>1.1.3.4.5</b> Random sort</a></li>
<li class="chapter" data-level="1.1.3.4.6" data-path="advanced-r.html"><a href="advanced-r.html#expanding-aggregate-counts"><i class="fa fa-check"></i><b>1.1.3.4.6</b> Expanding aggregate counts</a></li>
<li class="chapter" data-level="1.1.3.4.7" data-path="advanced-r.html"><a href="advanced-r.html#removing-data-frame-columns"><i class="fa fa-check"></i><b>1.1.3.4.7</b> Removing data frame columns</a></li>
<li class="chapter" data-level="1.1.3.4.8" data-path="advanced-r.html"><a href="advanced-r.html#logical-subsetting"><i class="fa fa-check"></i><b>1.1.3.4.8</b> Logical subsetting</a></li>
<li class="chapter" data-level="1.1.3.4.9" data-path="advanced-r.html"><a href="advanced-r.html#boolean-algebra-and-sets"><i class="fa fa-check"></i><b>1.1.3.4.9</b> Boolean algebra and sets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1.1.4" data-path="advanced-r.html"><a href="advanced-r.html#arconflow"><i class="fa fa-check"></i><b>1.1.4</b> Control Flow</a>
<ul>
<li class="chapter" data-level="1.1.4.1" data-path="advanced-r.html"><a href="advanced-r.html#choices"><i class="fa fa-check"></i><b>1.1.4.1</b> Choices</a>
<ul>
<li class="chapter" data-level="1.1.4.1.1" data-path="advanced-r.html"><a href="advanced-r.html#vectorized-if"><i class="fa fa-check"></i><b>1.1.4.1.1</b> Vectorized <code>if</code></a></li>
<li class="chapter" data-level="1.1.4.1.2" data-path="advanced-r.html"><a href="advanced-r.html#switch-statement"><i class="fa fa-check"></i><b>1.1.4.1.2</b> <code>switch()</code> statement</a></li>
</ul></li>
<li class="chapter" data-level="1.1.4.2" data-path="advanced-r.html"><a href="advanced-r.html#loops"><i class="fa fa-check"></i><b>1.1.4.2</b> Loops</a>
<ul>
<li class="chapter" data-level="1.1.4.2.1" data-path="advanced-r.html"><a href="advanced-r.html#other-loops"><i class="fa fa-check"></i><b>1.1.4.2.1</b> Other loops</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1.1.5" data-path="advanced-r.html"><a href="advanced-r.html#arfunc"><i class="fa fa-check"></i><b>1.1.5</b> Functions</a>
<ul>
<li class="chapter" data-level="1.1.5.1" data-path="advanced-r.html"><a href="advanced-r.html#function-components"><i class="fa fa-check"></i><b>1.1.5.1</b> Function Components</a></li>
<li class="chapter" data-level="1.1.5.2" data-path="advanced-r.html"><a href="advanced-r.html#primitives"><i class="fa fa-check"></i><b>1.1.5.2</b> Primitives</a></li>
<li class="chapter" data-level="1.1.5.3" data-path="advanced-r.html"><a href="advanced-r.html#anonymous-functions-and-closures"><i class="fa fa-check"></i><b>1.1.5.3</b> Anonymous functions and Closures</a></li>
<li class="chapter" data-level="1.1.5.4" data-path="advanced-r.html"><a href="advanced-r.html#invoking-functions"><i class="fa fa-check"></i><b>1.1.5.4</b> Invoking functions</a></li>
<li class="chapter" data-level="1.1.5.5" data-path="advanced-r.html"><a href="advanced-r.html#function-composition"><i class="fa fa-check"></i><b>1.1.5.5</b> Function Composition</a></li>
<li class="chapter" data-level="1.1.5.6" data-path="advanced-r.html"><a href="advanced-r.html#lexical-scoping"><i class="fa fa-check"></i><b>1.1.5.6</b> Lexical scoping</a>
<ul>
<li class="chapter" data-level="1.1.5.6.1" data-path="advanced-r.html"><a href="advanced-r.html#name-masking"><i class="fa fa-check"></i><b>1.1.5.6.1</b> Name masking</a></li>
<li class="chapter" data-level="1.1.5.6.2" data-path="advanced-r.html"><a href="advanced-r.html#functions-vs-variables"><i class="fa fa-check"></i><b>1.1.5.6.2</b> Functions vs variables</a></li>
<li class="chapter" data-level="1.1.5.6.3" data-path="advanced-r.html"><a href="advanced-r.html#variable-lifespan"><i class="fa fa-check"></i><b>1.1.5.6.3</b> Variable lifespan</a></li>
<li class="chapter" data-level="1.1.5.6.4" data-path="advanced-r.html"><a href="advanced-r.html#dynamic-lookup"><i class="fa fa-check"></i><b>1.1.5.6.4</b> Dynamic lookup</a></li>
</ul></li>
<li class="chapter" data-level="1.1.5.7" data-path="advanced-r.html"><a href="advanced-r.html#lazy-evaluation"><i class="fa fa-check"></i><b>1.1.5.7</b> Lazy evaluation</a>
<ul>
<li class="chapter" data-level="1.1.5.7.1" data-path="advanced-r.html"><a href="advanced-r.html#promises"><i class="fa fa-check"></i><b>1.1.5.7.1</b> Promises</a></li>
<li class="chapter" data-level="1.1.5.7.2" data-path="advanced-r.html"><a href="advanced-r.html#default-arguments"><i class="fa fa-check"></i><b>1.1.5.7.2</b> Default arguments</a></li>
<li class="chapter" data-level="1.1.5.7.3" data-path="advanced-r.html"><a href="advanced-r.html#missing-arguments"><i class="fa fa-check"></i><b>1.1.5.7.3</b> Missing arguments</a>
<ul>
<li class="chapter" data-level="1.1.5.7.3.1" data-path="advanced-r.html"><a href="advanced-r.html#infix-function"><i class="fa fa-check"></i><b>1.1.5.7.3.1</b> <code>%||%</code> infix function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1.1.5.8" data-path="advanced-r.html"><a href="advanced-r.html#dot-dot-dot"><i class="fa fa-check"></i><b>1.1.5.8</b> <code>...</code> (dot-dot-dot)</a></li>
<li class="chapter" data-level="1.1.5.9" data-path="advanced-r.html"><a href="advanced-r.html#exiting-a-function"><i class="fa fa-check"></i><b>1.1.5.9</b> Exiting a function</a>
<ul>
<li class="chapter" data-level="1.1.5.9.1" data-path="advanced-r.html"><a href="advanced-r.html#explicit-vs-implicit"><i class="fa fa-check"></i><b>1.1.5.9.1</b> Explicit vs implicit</a></li>
<li class="chapter" data-level="1.1.5.9.2" data-path="advanced-r.html"><a href="advanced-r.html#visible-vs-invisible"><i class="fa fa-check"></i><b>1.1.5.9.2</b> Visible vs invisible</a></li>
<li class="chapter" data-level="1.1.5.9.3" data-path="advanced-r.html"><a href="advanced-r.html#errors"><i class="fa fa-check"></i><b>1.1.5.9.3</b> Errors</a></li>
<li class="chapter" data-level="1.1.5.9.4" data-path="advanced-r.html"><a href="advanced-r.html#exit-handlers"><i class="fa fa-check"></i><b>1.1.5.9.4</b> Exit handlers</a></li>
</ul></li>
<li class="chapter" data-level="1.1.5.10" data-path="advanced-r.html"><a href="advanced-r.html#function-forms"><i class="fa fa-check"></i><b>1.1.5.10</b> Function forms</a>
<ul>
<li class="chapter" data-level="1.1.5.10.1" data-path="advanced-r.html"><a href="advanced-r.html#prefix-form"><i class="fa fa-check"></i><b>1.1.5.10.1</b> Prefix form</a></li>
<li class="chapter" data-level="1.1.5.10.2" data-path="advanced-r.html"><a href="advanced-r.html#infix-form"><i class="fa fa-check"></i><b>1.1.5.10.2</b> Infix form</a></li>
<li class="chapter" data-level="1.1.5.10.3" data-path="advanced-r.html"><a href="advanced-r.html#replacement-form"><i class="fa fa-check"></i><b>1.1.5.10.3</b> Replacement form</a></li>
<li class="chapter" data-level="1.1.5.10.4" data-path="advanced-r.html"><a href="advanced-r.html#specials"><i class="fa fa-check"></i><b>1.1.5.10.4</b> Specials</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1.1.6" data-path="advanced-r.html"><a href="advanced-r.html#environments"><i class="fa fa-check"></i><b>1.1.6</b> Environments</a></li>
<li class="chapter" data-level="1.1.7" data-path="advanced-r.html"><a href="advanced-r.html#conditionals"><i class="fa fa-check"></i><b>1.1.7</b> Conditionals</a></li>
<li class="chapter" data-level="1.1.8" data-path="advanced-r.html"><a href="advanced-r.html#arfunctionals"><i class="fa fa-check"></i><b>1.1.8</b> Functionals</a>
<ul>
<li class="chapter" data-level="1.1.8.1" data-path="advanced-r.html"><a href="advanced-r.html#lapply-and-purrrmap"><i class="fa fa-check"></i><b>1.1.8.1</b> lapply() and purrr::map()</a>
<ul>
<li class="chapter" data-level="1.1.8.1.1" data-path="advanced-r.html"><a href="advanced-r.html#returning-atomic-vectors"><i class="fa fa-check"></i><b>1.1.8.1.1</b> Returning atomic vectors</a></li>
<li class="chapter" data-level="1.1.8.1.2" data-path="advanced-r.html"><a href="advanced-r.html#anonymous-functions-and-purrr-formulas"><i class="fa fa-check"></i><b>1.1.8.1.2</b> Anonymous functions and purrr formulas</a></li>
<li class="chapter" data-level="1.1.8.1.3" data-path="advanced-r.html"><a href="advanced-r.html#dots-for-passing-arguments"><i class="fa fa-check"></i><b>1.1.8.1.3</b> … (dots) for passing arguments</a></li>
<li class="chapter" data-level="1.1.8.1.4" data-path="advanced-r.html"><a href="advanced-r.html#apply-as-for-loop-generator"><i class="fa fa-check"></i><b>1.1.8.1.4</b> Apply as for loop generator</a></li>
</ul></li>
<li class="chapter" data-level="1.1.8.2" data-path="advanced-r.html"><a href="advanced-r.html#purrr-style"><i class="fa fa-check"></i><b>1.1.8.2</b> Purrr style</a></li>
<li class="chapter" data-level="1.1.8.3" data-path="advanced-r.html"><a href="advanced-r.html#map-variants"><i class="fa fa-check"></i><b>1.1.8.3</b> Map variants</a>
<ul>
<li class="chapter" data-level="1.1.8.3.1" data-path="advanced-r.html"><a href="advanced-r.html#modify"><i class="fa fa-check"></i><b>1.1.8.3.1</b> <code>modify()</code></a></li>
<li class="chapter" data-level="1.1.8.3.2" data-path="advanced-r.html"><a href="advanced-r.html#map2"><i class="fa fa-check"></i><b>1.1.8.3.2</b> <code>map2()</code></a></li>
<li class="chapter" data-level="1.1.8.3.3" data-path="advanced-r.html"><a href="advanced-r.html#walk"><i class="fa fa-check"></i><b>1.1.8.3.3</b> <code>walk()</code></a></li>
<li class="chapter" data-level="1.1.8.3.4" data-path="advanced-r.html"><a href="advanced-r.html#imap"><i class="fa fa-check"></i><b>1.1.8.3.4</b> <code>imap()</code></a></li>
<li class="chapter" data-level="1.1.8.3.5" data-path="advanced-r.html"><a href="advanced-r.html#pmap"><i class="fa fa-check"></i><b>1.1.8.3.5</b> <code>pmap()</code></a></li>
</ul></li>
<li class="chapter" data-level="1.1.8.4" data-path="advanced-r.html"><a href="advanced-r.html#reduce"><i class="fa fa-check"></i><b>1.1.8.4</b> Reduce</a>
<ul>
<li class="chapter" data-level="1.1.8.4.1" data-path="advanced-r.html"><a href="advanced-r.html#basics"><i class="fa fa-check"></i><b>1.1.8.4.1</b> Basics</a></li>
<li class="chapter" data-level="1.1.8.4.2" data-path="advanced-r.html"><a href="advanced-r.html#accumulate"><i class="fa fa-check"></i><b>1.1.8.4.2</b> Accumulate</a></li>
<li class="chapter" data-level="1.1.8.4.3" data-path="advanced-r.html"><a href="advanced-r.html#output-types"><i class="fa fa-check"></i><b>1.1.8.4.3</b> Output types</a></li>
<li class="chapter" data-level="1.1.8.4.4" data-path="advanced-r.html"><a href="advanced-r.html#multiple-inputs"><i class="fa fa-check"></i><b>1.1.8.4.4</b> Multiple inputs</a></li>
<li class="chapter" data-level="1.1.8.4.5" data-path="advanced-r.html"><a href="advanced-r.html#map-reduce"><i class="fa fa-check"></i><b>1.1.8.4.5</b> Map-Reduce</a></li>
</ul></li>
<li class="chapter" data-level="1.1.8.5" data-path="advanced-r.html"><a href="advanced-r.html#predicates"><i class="fa fa-check"></i><b>1.1.8.5</b> Predicates</a>
<ul>
<li class="chapter" data-level="1.1.8.5.1" data-path="advanced-r.html"><a href="advanced-r.html#predicate-functionals"><i class="fa fa-check"></i><b>1.1.8.5.1</b> Predicate functionals</a></li>
<li class="chapter" data-level="1.1.8.5.2" data-path="advanced-r.html"><a href="advanced-r.html#map-variants-1"><i class="fa fa-check"></i><b>1.1.8.5.2</b> Map variants</a></li>
</ul></li>
<li class="chapter" data-level="1.1.8.6" data-path="advanced-r.html"><a href="advanced-r.html#base-functionals"><i class="fa fa-check"></i><b>1.1.8.6</b> Base functionals</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="misc-temp-r.html"><a href="misc-temp-r.html"><i class="fa fa-check"></i><b>1.2</b> Misc Temp R</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="misc-temp-r.html"><a href="misc-temp-r.html#combining-execution"><i class="fa fa-check"></i><b>1.2.1</b> combining execution</a></li>
<li class="chapter" data-level="1.2.2" data-path="misc-temp-r.html"><a href="misc-temp-r.html#infixfuncs"><i class="fa fa-check"></i><b>1.2.2</b> Infix functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="import.html"><a href="import.html"><i class="fa fa-check"></i><b>2</b> Import</a></li>
<li class="chapter" data-level="3" data-path="tidy.html"><a href="tidy.html"><i class="fa fa-check"></i><b>3</b> Tidy</a></li>
<li class="chapter" data-level="4" data-path="transform.html"><a href="transform.html"><i class="fa fa-check"></i><b>4</b> Transform</a></li>
<li class="chapter" data-level="5" data-path="visualise.html"><a href="visualise.html"><i class="fa fa-check"></i><b>5</b> Visualise</a></li>
<li class="chapter" data-level="6" data-path="statistics.html"><a href="statistics.html"><i class="fa fa-check"></i><b>6</b> Statistics</a>
<ul>
<li class="chapter" data-level="6.1" data-path="set-theory.html"><a href="set-theory.html"><i class="fa fa-check"></i><b>6.1</b> set theory</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="communicate.html"><a href="communicate.html"><i class="fa fa-check"></i><b>7</b> Communicate</a>
<ul>
<li class="chapter" data-level="7.1" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html"><i class="fa fa-check"></i><b>7.1</b> Markdown/bookdown tips</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#syntax"><i class="fa fa-check"></i><b>7.1.1</b> Syntax</a>
<ul>
<li class="chapter" data-level="7.1.1.1" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#inline-formatting"><i class="fa fa-check"></i><b>7.1.1.1</b> Inline Formatting</a></li>
<li class="chapter" data-level="7.1.1.2" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#line-returns"><i class="fa fa-check"></i><b>7.1.1.2</b> Line Returns</a></li>
<li class="chapter" data-level="7.1.1.3" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#section-headers"><i class="fa fa-check"></i><b>7.1.1.3</b> Section Headers</a></li>
<li class="chapter" data-level="7.1.1.4" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#unordered-lists"><i class="fa fa-check"></i><b>7.1.1.4</b> Unordered Lists</a></li>
<li class="chapter" data-level="7.1.1.5" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#ordered-lists"><i class="fa fa-check"></i><b>7.1.1.5</b> Ordered lists</a></li>
<li class="chapter" data-level="7.1.1.6" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#block-quotes"><i class="fa fa-check"></i><b>7.1.1.6</b> Block Quotes</a></li>
<li class="chapter" data-level="7.1.1.7" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#code-blocks"><i class="fa fa-check"></i><b>7.1.1.7</b> Code Blocks</a>
<ul>
<li class="chapter" data-level="7.1.1.7.1" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#syntax-highlighting"><i class="fa fa-check"></i><b>7.1.1.7.1</b> Syntax highlighting</a></li>
</ul></li>
<li class="chapter" data-level="7.1.1.8" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#tables"><i class="fa fa-check"></i><b>7.1.1.8</b> Tables</a>
<ul>
<li class="chapter" data-level="7.1.1.8.1" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#grid-tables"><i class="fa fa-check"></i><b>7.1.1.8.1</b> Grid Tables</a></li>
<li class="chapter" data-level="7.1.1.8.2" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#pipe-tables"><i class="fa fa-check"></i><b>7.1.1.8.2</b> Pipe Tables</a></li>
</ul></li>
<li class="chapter" data-level="7.1.1.9" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#horizontal-rules"><i class="fa fa-check"></i><b>7.1.1.9</b> Horizontal Rules</a></li>
<li class="chapter" data-level="7.1.1.10" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#task-lists"><i class="fa fa-check"></i><b>7.1.1.10</b> Task lists</a></li>
</ul></li>
<li class="chapter" data-level="7.1.2" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#cache-large-code-chunks"><i class="fa fa-check"></i><b>7.1.2</b> Cache large code chunks</a></li>
<li class="chapter" data-level="7.1.3" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#chunk-options"><i class="fa fa-check"></i><b>7.1.3</b> Chunk Options</a>
<ul>
<li class="chapter" data-level="7.1.3.1" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#collapse"><i class="fa fa-check"></i><b>7.1.3.1</b> Collapse</a></li>
<li class="chapter" data-level="7.1.3.2" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#error"><i class="fa fa-check"></i><b>7.1.3.2</b> Error</a></li>
</ul></li>
<li class="chapter" data-level="7.1.4" data-path="markdownbookdown-tips.html"><a href="markdownbookdown-tips.html#resources"><i class="fa fa-check"></i><b>7.1.4</b> Resources</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="advanced-r" class="section level2" number="1.1">
<h2 number="1.1"><span class="header-section-number">1.1</span> Advanced R</h2>
<p><a href="https://adv-r.hadley.nz/">Advanced R</a> 2nd ed. Hadley Wickham</p>
<p><em>Selected Chapters</em><br />
<a href="advanced-r.html#arnandv">Names and Values</a><br />
<a href="advanced-r.html#arv">Vectors</a><br />
<a href="advanced-r.html#arsub">Subsetting</a><br />
<a href="advanced-r.html#arconflow">Control Flow</a><br />
<a href="advanced-r.html#arfunc">Functions</a><br />
<a href="advanced-r.html#arfunctionals">Functionals</a></p>
<div id="arnandv" class="section level3" number="1.1.1">
<h3 number="1.1.1"><span class="header-section-number">1.1.1</span> Names and Values</h3>
<div id="arbinding" class="section level4" number="1.1.1.1">
<h4 number="1.1.1.1"><span class="header-section-number">1.1.1.1</span> Binding</h4>
<p>In R, names are assigned a value (e.g. a vector doesn’t have a name, rather, a name(s) points to a vector). The actual address of an object is exposed by <code>lobstr::obj_addr()</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="advanced-r.html#cb1-1"></a>x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb1-2"><a href="advanced-r.html#cb1-2"></a><span class="kw">obj_addr</span>(x)</span>
<span id="cb1-3"><a href="advanced-r.html#cb1-3"></a><span class="co">## [1] &quot;0x1517f8b0&quot;</span></span>
<span id="cb1-4"><a href="advanced-r.html#cb1-4"></a></span>
<span id="cb1-5"><a href="advanced-r.html#cb1-5"></a><span class="co"># notice x and y are pointers to the same object</span></span>
<span id="cb1-6"><a href="advanced-r.html#cb1-6"></a>y &lt;-<span class="st"> </span>x</span>
<span id="cb1-7"><a href="advanced-r.html#cb1-7"></a><span class="kw">obj_addr</span>(y)</span>
<span id="cb1-8"><a href="advanced-r.html#cb1-8"></a><span class="co">## [1] &quot;0x1517f8b0&quot;</span></span>
<span id="cb1-9"><a href="advanced-r.html#cb1-9"></a></span>
<span id="cb1-10"><a href="advanced-r.html#cb1-10"></a><span class="co"># this applies to function arguments in their environment as well</span></span>
<span id="cb1-11"><a href="advanced-r.html#cb1-11"></a>fn &lt;-<span class="st"> </span><span class="cf">function</span>(z){</span>
<span id="cb1-12"><a href="advanced-r.html#cb1-12"></a>  z</span>
<span id="cb1-13"><a href="advanced-r.html#cb1-13"></a>}</span>
<span id="cb1-14"><a href="advanced-r.html#cb1-14"></a><span class="co"># fn() returns the argument z at the same address</span></span>
<span id="cb1-15"><a href="advanced-r.html#cb1-15"></a><span class="kw">obj_addr</span>(<span class="kw">fn</span>(x))</span>
<span id="cb1-16"><a href="advanced-r.html#cb1-16"></a><span class="co">## [1] &quot;0x1517f8b0&quot;</span></span></code></pre></div>
</div>
<div id="arsyntacticnames" class="section level4" number="1.1.1.2">
<h4 number="1.1.1.2"><span class="header-section-number">1.1.1.2</span> Syntactic Names</h4>
<p>Names in R can be letters, numbers, <code>.</code> or <code>_</code>; but cannot start with a number or <code>_</code> or contain <code>?Reserved</code> words.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="advanced-r.html#cb2-1"></a><span class="co"># assigning a vector a name startign with `_` throws an error</span></span>
<span id="cb2-2"><a href="advanced-r.html#cb2-2"></a>_x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb2-3"><a href="advanced-r.html#cb2-3"></a><span class="co">## Error: &lt;text&gt;:2:1: unexpected input</span></span>
<span id="cb2-4"><a href="advanced-r.html#cb2-4"></a><span class="co">## 1: # assigning a vector a name startign with `_` throws an error</span></span>
<span id="cb2-5"><a href="advanced-r.html#cb2-5"></a><span class="co">## 2: _</span></span>
<span id="cb2-6"><a href="advanced-r.html#cb2-6"></a><span class="co">##    ^</span></span></code></pre></div>
</div>
<div id="arcopyonmod" class="section level4" number="1.1.1.3">
<h4 number="1.1.1.3"><span class="header-section-number">1.1.1.3</span> Copy-on-Modify</h4>
<p>R objects are generally immutable. A new copy is made when you modify an object. There are two <a href="advanced-r.html#armodinplace">Modify-in-Place</a> exceptions.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="advanced-r.html#cb3-1"></a><span class="co"># create vector x</span></span>
<span id="cb3-2"><a href="advanced-r.html#cb3-2"></a>x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb3-3"><a href="advanced-r.html#cb3-3"></a><span class="kw">obj_addr</span>(x)</span>
<span id="cb3-4"><a href="advanced-r.html#cb3-4"></a><span class="co">## [1] &quot;0x180fe9d8&quot;</span></span>
<span id="cb3-5"><a href="advanced-r.html#cb3-5"></a></span>
<span id="cb3-6"><a href="advanced-r.html#cb3-6"></a><span class="co"># modify first value in x</span></span>
<span id="cb3-7"><a href="advanced-r.html#cb3-7"></a>x[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb3-8"><a href="advanced-r.html#cb3-8"></a></span>
<span id="cb3-9"><a href="advanced-r.html#cb3-9"></a><span class="co"># note x now points to a new object</span></span>
<span id="cb3-10"><a href="advanced-r.html#cb3-10"></a><span class="kw">obj_addr</span>(x)</span>
<span id="cb3-11"><a href="advanced-r.html#cb3-11"></a><span class="co">## [1] &quot;0x1806d148&quot;</span></span></code></pre></div>
<div id="artracecopy" class="section level5" number="1.1.1.3.1">
<h5 number="1.1.1.3.1"><span class="header-section-number">1.1.1.3.1</span> Trace Copying of Objects</h5>
<p><code>base::tracemem()</code> will mark an object and print a message whenever it is copied. This is
a major cause of hard-to-predict memory usage.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="advanced-r.html#cb4-1"></a><span class="co"># tell R to trace copies of object reference `x`</span></span>
<span id="cb4-2"><a href="advanced-r.html#cb4-2"></a><span class="kw">tracemem</span>(<span class="dt">x =</span> x)</span>
<span id="cb4-3"><a href="advanced-r.html#cb4-3"></a></span>
<span id="cb4-4"><a href="advanced-r.html#cb4-4"></a><span class="co"># modify the first element in vector `x`</span></span>
<span id="cb4-5"><a href="advanced-r.html#cb4-5"></a><span class="co"># R prints a tracemem message to show the object is copied to a new address</span></span>
<span id="cb4-6"><a href="advanced-r.html#cb4-6"></a>x[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb4-7"><a href="advanced-r.html#cb4-7"></a><span class="co">#&gt; tracemem[0x000002379ca5a190 -&gt; 0x000002379cd8dbb0]:</span></span>
<span id="cb4-8"><a href="advanced-r.html#cb4-8"></a></span>
<span id="cb4-9"><a href="advanced-r.html#cb4-9"></a><span class="co"># tell R to stop tracing this object</span></span>
<span id="cb4-10"><a href="advanced-r.html#cb4-10"></a>base<span class="op">::</span><span class="kw">untracemem</span>(<span class="dt">x =</span> x)</span></code></pre></div>
</div>
<div id="arlobjects" class="section level5" number="1.1.1.3.2">
<h5 number="1.1.1.3.2"><span class="header-section-number">1.1.1.3.2</span> List Objects</h5>
<p>Just like variables, each element of a list also points to a value. <a href="advanced-r.html#arcopyonmod">Copy-on-modify</a> and <a href="advanced-r.html#armodinplace">modify-in-place</a> applies here as well. R creates a <strong>shallow</strong> copy of the list. Meaning
the list object and its bindings are copied; however, the underlying values are not.</p>
<p>In a deep copy, like prior to R 3.1.0, the underlying values are also copied.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="advanced-r.html#cb5-1"></a><span class="co"># create a list named `l`</span></span>
<span id="cb5-2"><a href="advanced-r.html#cb5-2"></a>l &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="ot">TRUE</span>, <span class="kw">c</span>(<span class="st">&#39;Apple&#39;</span>,<span class="st">&#39;Broccoli&#39;</span>,<span class="st">&#39;Chowder&#39;</span>))</span>
<span id="cb5-3"><a href="advanced-r.html#cb5-3"></a></span>
<span id="cb5-4"><a href="advanced-r.html#cb5-4"></a><span class="co"># show the address of the third list element</span></span>
<span id="cb5-5"><a href="advanced-r.html#cb5-5"></a><span class="kw">obj_addr</span>(l[[<span class="dv">3</span>]])</span>
<span id="cb5-6"><a href="advanced-r.html#cb5-6"></a><span class="co">## [1] &quot;0x18641c28&quot;</span></span>
<span id="cb5-7"><a href="advanced-r.html#cb5-7"></a></span>
<span id="cb5-8"><a href="advanced-r.html#cb5-8"></a><span class="co"># modify the third list element</span></span>
<span id="cb5-9"><a href="advanced-r.html#cb5-9"></a>l[[<span class="dv">3</span>]] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Appricot&#39;</span>,<span class="st">&#39;Basmati Rice&#39;</span>,<span class="st">&#39;Cheese&#39;</span>)</span>
<span id="cb5-10"><a href="advanced-r.html#cb5-10"></a></span>
<span id="cb5-11"><a href="advanced-r.html#cb5-11"></a><span class="co"># the third list element&#39;s address is changed</span></span>
<span id="cb5-12"><a href="advanced-r.html#cb5-12"></a><span class="kw">obj_addr</span>(l[[<span class="dv">3</span>]])</span>
<span id="cb5-13"><a href="advanced-r.html#cb5-13"></a><span class="co">## [1] &quot;0x186db4c0&quot;</span></span></code></pre></div>
<p>Use <code>lobstr::ref()</code> to see common values between lists:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="advanced-r.html#cb6-1"></a><span class="co"># create a list object</span></span>
<span id="cb6-2"><a href="advanced-r.html#cb6-2"></a>listA &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb6-3"><a href="advanced-r.html#cb6-3"></a></span>
<span id="cb6-4"><a href="advanced-r.html#cb6-4"></a><span class="co"># create a new pointer to the same list object</span></span>
<span id="cb6-5"><a href="advanced-r.html#cb6-5"></a>listB &lt;-<span class="st"> </span>listA</span>
<span id="cb6-6"><a href="advanced-r.html#cb6-6"></a></span>
<span id="cb6-7"><a href="advanced-r.html#cb6-7"></a><span class="co"># modify the third list element of listB, creating a shallow copy of the list object </span></span>
<span id="cb6-8"><a href="advanced-r.html#cb6-8"></a>listB[[<span class="dv">3</span>]] &lt;-<span class="st"> </span><span class="dv">4</span></span>
<span id="cb6-9"><a href="advanced-r.html#cb6-9"></a></span>
<span id="cb6-10"><a href="advanced-r.html#cb6-10"></a><span class="co"># ref() lists the address of each list element. Notice two values are still shared </span></span>
<span id="cb6-11"><a href="advanced-r.html#cb6-11"></a><span class="co"># between `listA` and `listB`.</span></span>
<span id="cb6-12"><a href="advanced-r.html#cb6-12"></a><span class="kw">ref</span>(listA, listB)</span>
<span id="cb6-13"><a href="advanced-r.html#cb6-13"></a><span class="co">## o [1:0x18ad0ff0] &lt;list&gt; </span></span>
<span id="cb6-14"><a href="advanced-r.html#cb6-14"></a><span class="co">## +-[2:0x189423a8] &lt;dbl&gt; </span></span>
<span id="cb6-15"><a href="advanced-r.html#cb6-15"></a><span class="co">## +-[3:0x18942370] &lt;dbl&gt; </span></span>
<span id="cb6-16"><a href="advanced-r.html#cb6-16"></a><span class="co">## \-[4:0x18942338] &lt;dbl&gt; </span></span>
<span id="cb6-17"><a href="advanced-r.html#cb6-17"></a><span class="co">##  </span></span>
<span id="cb6-18"><a href="advanced-r.html#cb6-18"></a><span class="co">## o [5:0x18b87d90] &lt;list&gt; </span></span>
<span id="cb6-19"><a href="advanced-r.html#cb6-19"></a><span class="co">## +-[2:0x189423a8] </span></span>
<span id="cb6-20"><a href="advanced-r.html#cb6-20"></a><span class="co">## +-[3:0x18942370] </span></span>
<span id="cb6-21"><a href="advanced-r.html#cb6-21"></a><span class="co">## \-[6:0x18942220] &lt;dbl&gt;</span></span></code></pre></div>
</div>
<div id="ardataframes" class="section level5" number="1.1.1.3.3">
<h5 number="1.1.1.3.3"><span class="header-section-number">1.1.1.3.3</span> Data Frames</h5>
<p>A data frame is simply a list where each element is a vector of the same length.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="advanced-r.html#cb7-1"></a><span class="co"># create a data frame with three columns</span></span>
<span id="cb7-2"><a href="advanced-r.html#cb7-2"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">col1 =</span> <span class="ot">TRUE</span>, </span>
<span id="cb7-3"><a href="advanced-r.html#cb7-3"></a>                 <span class="dt">col2 =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, </span>
<span id="cb7-4"><a href="advanced-r.html#cb7-4"></a>                 <span class="dt">col3 =</span> <span class="kw">rep</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&#39;On&#39;</span>,<span class="st">&#39;Off&#39;</span>), </span>
<span id="cb7-5"><a href="advanced-r.html#cb7-5"></a>                            <span class="dt">length.out =</span> <span class="dv">10</span>))</span>
<span id="cb7-6"><a href="advanced-r.html#cb7-6"></a></span>
<span id="cb7-7"><a href="advanced-r.html#cb7-7"></a><span class="co"># show the address of the data frame and each element (i.e. column)</span></span>
<span id="cb7-8"><a href="advanced-r.html#cb7-8"></a><span class="kw">ref</span>(df)</span>
<span id="cb7-9"><a href="advanced-r.html#cb7-9"></a><span class="co">## o [1:0x195b9330] &lt;df[,3]&gt; </span></span>
<span id="cb7-10"><a href="advanced-r.html#cb7-10"></a><span class="co">## +-col1 = [2:0x19580628] &lt;lgl&gt; </span></span>
<span id="cb7-11"><a href="advanced-r.html#cb7-11"></a><span class="co">## +-col2 = [3:0x195aaaf0] &lt;int&gt; </span></span>
<span id="cb7-12"><a href="advanced-r.html#cb7-12"></a><span class="co">## \-col3 = [4:0x19580778] &lt;fct&gt;</span></span></code></pre></div>
<p>When a <strong>column</strong> is modified only one element is copied:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="advanced-r.html#cb8-1"></a><span class="co"># modify a column and note the addresses of the unchanged columns remain the same</span></span>
<span id="cb8-2"><a href="advanced-r.html#cb8-2"></a><span class="co"># because they point to the same objects as before</span></span>
<span id="cb8-3"><a href="advanced-r.html#cb8-3"></a>df<span class="op">$</span>col1 &lt;-<span class="st"> </span><span class="ot">FALSE</span>; <span class="kw">ref</span>(df)</span>
<span id="cb8-4"><a href="advanced-r.html#cb8-4"></a><span class="co">## o [1:0x198fd0d8] &lt;df[,3]&gt; </span></span>
<span id="cb8-5"><a href="advanced-r.html#cb8-5"></a><span class="co">## +-col1 = [2:0x198b3110] &lt;lgl&gt; </span></span>
<span id="cb8-6"><a href="advanced-r.html#cb8-6"></a><span class="co">## +-col2 = [3:0x195aaaf0] &lt;int&gt; </span></span>
<span id="cb8-7"><a href="advanced-r.html#cb8-7"></a><span class="co">## \-col3 = [4:0x19580778] &lt;fct&gt;</span></span></code></pre></div>
<p>This has important consequences for memory when you update <strong>rows</strong> of data where each
element gets copied:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="advanced-r.html#cb9-1"></a><span class="co"># modify the first row of the data frame</span></span>
<span id="cb9-2"><a href="advanced-r.html#cb9-2"></a>df[<span class="dv">1</span>,] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="dv">0</span>, <span class="st">&#39;Off&#39;</span>)</span>
<span id="cb9-3"><a href="advanced-r.html#cb9-3"></a></span>
<span id="cb9-4"><a href="advanced-r.html#cb9-4"></a><span class="co"># *all* elements are copied to new addresses</span></span>
<span id="cb9-5"><a href="advanced-r.html#cb9-5"></a><span class="kw">ref</span>(df)</span>
<span id="cb9-6"><a href="advanced-r.html#cb9-6"></a><span class="co">## o [1:0x15fded80] &lt;df[,3]&gt; </span></span>
<span id="cb9-7"><a href="advanced-r.html#cb9-7"></a><span class="co">## +-col1 = [2:0x160c22b0] &lt;chr&gt; </span></span>
<span id="cb9-8"><a href="advanced-r.html#cb9-8"></a><span class="co">## +-col2 = [3:0x158b5f90] &lt;chr&gt; </span></span>
<span id="cb9-9"><a href="advanced-r.html#cb9-9"></a><span class="co">## \-col3 = [4:0x160189b8] &lt;fct&gt;</span></span></code></pre></div>
</div>
<div id="archarvar" class="section level5" number="1.1.1.3.4">
<h5 number="1.1.1.3.4"><span class="header-section-number">1.1.1.3.4</span> Character Vectors</h5>
<p>R uses a <em>global string pool</em> to store unique character objects so they are not duplicated
unnecessarily. Use the <code>character</code> argument to show their address in the global string pool
with <code>lobstr::ref()</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="advanced-r.html#cb10-1"></a><span class="co"># create a character vector</span></span>
<span id="cb10-2"><a href="advanced-r.html#cb10-2"></a>chr &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Quarter&#39;</span>,</span>
<span id="cb10-3"><a href="advanced-r.html#cb10-3"></a>         <span class="st">&#39;Dime&#39;</span>,</span>
<span id="cb10-4"><a href="advanced-r.html#cb10-4"></a>         <span class="st">&#39;Nickle&#39;</span>,</span>
<span id="cb10-5"><a href="advanced-r.html#cb10-5"></a>         <span class="st">&#39;Penny&#39;</span>,</span>
<span id="cb10-6"><a href="advanced-r.html#cb10-6"></a>         <span class="st">&#39;Penny&#39;</span>)</span>
<span id="cb10-7"><a href="advanced-r.html#cb10-7"></a></span>
<span id="cb10-8"><a href="advanced-r.html#cb10-8"></a><span class="co"># show addresses in the global string pool. Notice the shared value for &#39;Penny&#39;</span></span>
<span id="cb10-9"><a href="advanced-r.html#cb10-9"></a><span class="kw">ref</span>(chr, </span>
<span id="cb10-10"><a href="advanced-r.html#cb10-10"></a>    <span class="dt">character =</span> <span class="ot">TRUE</span>)</span>
<span id="cb10-11"><a href="advanced-r.html#cb10-11"></a><span class="co">## o [1:0x17e3a7f8] &lt;chr&gt; </span></span>
<span id="cb10-12"><a href="advanced-r.html#cb10-12"></a><span class="co">## +-[2:0x15cd8930] &lt;string: &quot;Quarter&quot;&gt; </span></span>
<span id="cb10-13"><a href="advanced-r.html#cb10-13"></a><span class="co">## +-[3:0x15cd88c0] &lt;string: &quot;Dime&quot;&gt; </span></span>
<span id="cb10-14"><a href="advanced-r.html#cb10-14"></a><span class="co">## +-[4:0x15cd8818] &lt;string: &quot;Nickle&quot;&gt; </span></span>
<span id="cb10-15"><a href="advanced-r.html#cb10-15"></a><span class="co">## +-[5:0x15cd87a8] &lt;string: &quot;Penny&quot;&gt; </span></span>
<span id="cb10-16"><a href="advanced-r.html#cb10-16"></a><span class="co">## \-[5:0x15cd87a8]</span></span></code></pre></div>
</div>
</div>
<div id="arobjsize" class="section level4" number="1.1.1.4">
<h4 number="1.1.1.4"><span class="header-section-number">1.1.1.4</span> Object Size</h4>
<p><code>lobstr::obj_size()</code> shows the amount of memory an object takes, while <code>obj_sizes()</code>
breaks down multiple objects into their individual contribution to <em>total</em> memory.</p>
<p>Due to binding names, global string pools, and ALTREP (alternate representation where some vectors
are stored in a compact manor; e.g. 1:1000 only stores the first and last numbers, not 1,000 numbers)
the size of objects may surprise you.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="advanced-r.html#cb11-1"></a><span class="co"># create a length one chracter vector and a length 100 character vector</span></span>
<span id="cb11-2"><a href="advanced-r.html#cb11-2"></a>x &lt;-<span class="st"> &#39;Charlie&#39;</span></span>
<span id="cb11-3"><a href="advanced-r.html#cb11-3"></a>y &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dt">x =</span> <span class="st">&#39;Charlie&#39;</span>, <span class="dt">times =</span> <span class="dv">100</span>)</span>
<span id="cb11-4"><a href="advanced-r.html#cb11-4"></a></span>
<span id="cb11-5"><a href="advanced-r.html#cb11-5"></a><span class="co"># y is only ~8x the size of x, not 100x</span></span>
<span id="cb11-6"><a href="advanced-r.html#cb11-6"></a><span class="kw">obj_size</span>(x); <span class="kw">obj_size</span>(y)</span>
<span id="cb11-7"><a href="advanced-r.html#cb11-7"></a><span class="co">## 112 B</span></span>
<span id="cb11-8"><a href="advanced-r.html#cb11-8"></a><span class="co">## 904 B</span></span>
<span id="cb11-9"><a href="advanced-r.html#cb11-9"></a></span>
<span id="cb11-10"><a href="advanced-r.html#cb11-10"></a></span>
<span id="cb11-11"><a href="advanced-r.html#cb11-11"></a>z &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb11-12"><a href="advanced-r.html#cb11-12"></a></span>
<span id="cb11-13"><a href="advanced-r.html#cb11-13"></a><span class="co"># create a list with one element `z`</span></span>
<span id="cb11-14"><a href="advanced-r.html#cb11-14"></a>list1 &lt;-<span class="st"> </span><span class="kw">list</span>(z)</span>
<span id="cb11-15"><a href="advanced-r.html#cb11-15"></a><span class="co"># create a list with three elements, all `z`</span></span>
<span id="cb11-16"><a href="advanced-r.html#cb11-16"></a>list2 &lt;-<span class="st"> </span><span class="kw">list</span>(z, z, z)</span>
<span id="cb11-17"><a href="advanced-r.html#cb11-17"></a></span>
<span id="cb11-18"><a href="advanced-r.html#cb11-18"></a><span class="co"># list2 only contributes an extra 80 Bytes to the total memory between the two</span></span>
<span id="cb11-19"><a href="advanced-r.html#cb11-19"></a><span class="kw">obj_sizes</span>(list1, list2)</span>
<span id="cb11-20"><a href="advanced-r.html#cb11-20"></a><span class="co">## * 736 B</span></span>
<span id="cb11-21"><a href="advanced-r.html#cb11-21"></a><span class="co">## *  80 B</span></span></code></pre></div>
</div>
<div id="armodinplace" class="section level4" number="1.1.1.5">
<h4 number="1.1.1.5"><span class="header-section-number">1.1.1.5</span> Modify-in-Place</h4>
<p>There are two places where R will optimize memory by modfiying an object “in place”
(i.e. does not make a copy).</p>
<ol style="list-style-type: decimal">
<li>objects with a single binding</li>
</ol>
<pre><code>&gt; hats &lt;- c(&#39;red&#39;,&#39;brown&#39;,&#39;blue&#39;)
&gt; obj_addr(hats)
[1] &quot;0x1d51fe614d8&quot;
&gt; 
&gt; hats[[1]] &lt;- &#39;orange&#39;
&gt; obj_addr(hats)
[1] &quot;0x1d51fe614d8&quot;

# note this is output from the R Console. RStudio runs everything within an Environment
# which breaks modify-in-place behavior</code></pre>
<p>This is one reason why looping in R is inefficient, the user is unwittingly copying
objects many times over:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="advanced-r.html#cb13-1"></a><span class="co"># create a dataframe</span></span>
<span id="cb13-2"><a href="advanced-r.html#cb13-2"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">col1 =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>))</span>
<span id="cb13-3"><a href="advanced-r.html#cb13-3"></a></span>
<span id="cb13-4"><a href="advanced-r.html#cb13-4"></a><span class="co"># trace copies of this dataframe</span></span>
<span id="cb13-5"><a href="advanced-r.html#cb13-5"></a><span class="kw">tracemem</span>(df)</span>
<span id="cb13-6"><a href="advanced-r.html#cb13-6"></a><span class="co">## [1] &quot;&lt;00000000187C6918&gt;&quot;</span></span>
<span id="cb13-7"><a href="advanced-r.html#cb13-7"></a></span>
<span id="cb13-8"><a href="advanced-r.html#cb13-8"></a><span class="co"># use a for loop to increment the dataframe values</span></span>
<span id="cb13-9"><a href="advanced-r.html#cb13-9"></a><span class="co"># R copies the object 12 times!!!</span></span>
<span id="cb13-10"><a href="advanced-r.html#cb13-10"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>){</span>
<span id="cb13-11"><a href="advanced-r.html#cb13-11"></a>  df[[<span class="dv">1</span>]][i] &lt;-<span class="st"> </span>df[[<span class="dv">1</span>]][i] <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb13-12"><a href="advanced-r.html#cb13-12"></a>}</span>
<span id="cb13-13"><a href="advanced-r.html#cb13-13"></a><span class="co">## tracemem[0x00000000187c6918 -&gt; 0x0000000018a09a00]: eval eval withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir block_exec call_block process_group.block process_group withCallingHandlers process_file &lt;Anonymous&gt; &lt;Anonymous&gt; do.call eval eval eval eval eval.parent local </span></span>
<span id="cb13-14"><a href="advanced-r.html#cb13-14"></a><span class="co">## tracemem[0x0000000018a09a00 -&gt; 0x0000000018a09840]: eval eval withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir block_exec call_block process_group.block process_group withCallingHandlers process_file &lt;Anonymous&gt; &lt;Anonymous&gt; do.call eval eval eval eval eval.parent local </span></span>
<span id="cb13-15"><a href="advanced-r.html#cb13-15"></a><span class="co">## tracemem[0x0000000018a09840 -&gt; 0x0000000018a19d10]: [[&lt;-.data.frame [[&lt;- eval eval withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir block_exec call_block process_group.block process_group withCallingHandlers process_file &lt;Anonymous&gt; &lt;Anonymous&gt; do.call eval eval eval eval eval.parent local </span></span>
<span id="cb13-16"><a href="advanced-r.html#cb13-16"></a><span class="co">## tracemem[0x0000000018a19d10 -&gt; 0x0000000018a19b88]: [[&lt;-.data.frame [[&lt;- eval eval withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir block_exec call_block process_group.block process_group withCallingHandlers process_file &lt;Anonymous&gt; &lt;Anonymous&gt; do.call eval eval eval eval eval.parent local </span></span>
<span id="cb13-17"><a href="advanced-r.html#cb13-17"></a><span class="co">## tracemem[0x0000000018a19b88 -&gt; 0x0000000018a19a00]: eval eval withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir block_exec call_block process_group.block process_group withCallingHandlers process_file &lt;Anonymous&gt; &lt;Anonymous&gt; do.call eval eval eval eval eval.parent local </span></span>
<span id="cb13-18"><a href="advanced-r.html#cb13-18"></a><span class="co">## tracemem[0x0000000018a19a00 -&gt; 0x0000000018a198b0]: eval eval withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir block_exec call_block process_group.block process_group withCallingHandlers process_file &lt;Anonymous&gt; &lt;Anonymous&gt; do.call eval eval eval eval eval.parent local </span></span>
<span id="cb13-19"><a href="advanced-r.html#cb13-19"></a><span class="co">## tracemem[0x0000000018a198b0 -&gt; 0x0000000018a197d0]: [[&lt;-.data.frame [[&lt;- eval eval withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir block_exec call_block process_group.block process_group withCallingHandlers process_file &lt;Anonymous&gt; &lt;Anonymous&gt; do.call eval eval eval eval eval.parent local </span></span>
<span id="cb13-20"><a href="advanced-r.html#cb13-20"></a><span class="co">## tracemem[0x0000000018a197d0 -&gt; 0x0000000018a19648]: [[&lt;-.data.frame [[&lt;- eval eval withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir block_exec call_block process_group.block process_group withCallingHandlers process_file &lt;Anonymous&gt; &lt;Anonymous&gt; do.call eval eval eval eval eval.parent local </span></span>
<span id="cb13-21"><a href="advanced-r.html#cb13-21"></a><span class="co">## tracemem[0x0000000018a19648 -&gt; 0x0000000018a194c0]: eval eval withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir block_exec call_block process_group.block process_group withCallingHandlers process_file &lt;Anonymous&gt; &lt;Anonymous&gt; do.call eval eval eval eval eval.parent local </span></span>
<span id="cb13-22"><a href="advanced-r.html#cb13-22"></a><span class="co">## tracemem[0x0000000018a194c0 -&gt; 0x0000000018a19370]: eval eval withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir block_exec call_block process_group.block process_group withCallingHandlers process_file &lt;Anonymous&gt; &lt;Anonymous&gt; do.call eval eval eval eval eval.parent local </span></span>
<span id="cb13-23"><a href="advanced-r.html#cb13-23"></a><span class="co">## tracemem[0x0000000018a19370 -&gt; 0x0000000018a19290]: [[&lt;-.data.frame [[&lt;- eval eval withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir block_exec call_block process_group.block process_group withCallingHandlers process_file &lt;Anonymous&gt; &lt;Anonymous&gt; do.call eval eval eval eval eval.parent local </span></span>
<span id="cb13-24"><a href="advanced-r.html#cb13-24"></a><span class="co">## tracemem[0x0000000018a19290 -&gt; 0x0000000018a19108]: [[&lt;-.data.frame [[&lt;- eval eval withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir block_exec call_block process_group.block process_group withCallingHandlers process_file &lt;Anonymous&gt; &lt;Anonymous&gt; do.call eval eval eval eval eval.parent local</span></span>
<span id="cb13-25"><a href="advanced-r.html#cb13-25"></a></span>
<span id="cb13-26"><a href="advanced-r.html#cb13-26"></a><span class="co"># turn of object memory trace</span></span>
<span id="cb13-27"><a href="advanced-r.html#cb13-27"></a><span class="kw">untracemem</span>(df)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Environments</li>
</ol>
<p>Environments are always modified in place and all objects within the environment
keep the same reference.</p>
</div>
<div id="argc" class="section level4" number="1.1.1.6">
<h4 number="1.1.1.6"><span class="header-section-number">1.1.1.6</span> Unbinding and Garbage Collector (GC)</h4>
<p>The (GC) garbage collector deletes objects that are no longer used and requests
more memory from the operating system as needed to create objects.</p>
<p>For example:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="advanced-r.html#cb14-1"></a><span class="co"># create three objects all bound to `x`</span></span>
<span id="cb14-2"><a href="advanced-r.html#cb14-2"></a>x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span> </span>
<span id="cb14-3"><a href="advanced-r.html#cb14-3"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;one&#39;</span>,<span class="st">&#39;two&#39;</span>,<span class="st">&#39;three&#39;</span>)</span>
<span id="cb14-4"><a href="advanced-r.html#cb14-4"></a>x &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb14-5"><a href="advanced-r.html#cb14-5"></a></span>
<span id="cb14-6"><a href="advanced-r.html#cb14-6"></a><span class="co"># removing `x` causes GC to delete the three objects b/c they have no other bindings</span></span>
<span id="cb14-7"><a href="advanced-r.html#cb14-7"></a><span class="kw">remove</span>(x)</span></code></pre></div>
<p>You can call GC yourself with <code>base::gc()</code>, but the user should not ever have the need.</p>

</div>
</div>
<div id="arv" class="section level3" number="1.1.2">
<h3 number="1.1.2"><span class="header-section-number">1.1.2</span> Vectors</h3>
<p>R has two types of vectors: <strong>atomic</strong> vectors and <strong>list</strong> vectors.</p>
<p>Atomic vectors have values all of the same type, while lists can have values of
different types.</p>
<p><strong>NULL</strong> is not a vector, but is often used in R to represent a zero length
vector. For practical purposes you can consider it a vector.</p>
<p>Vectors can have <em>attributes</em>; the most important are <strong>dimension</strong> and <strong>class</strong>.</p>
<ul>
<li>dimension: turns a vector into matrices and arrays</li>
<li>class: critical for S3 objects like factors, dates &amp; date-time, data frames, and tibbles</li>
</ul>
<div id="atomic-vectors" class="section level4" number="1.1.2.1">
<h4 number="1.1.2.1"><span class="header-section-number">1.1.2.1</span> Atomic Vectors</h4>
<div id="types" class="section level5" number="1.1.2.1.1">
<h5 number="1.1.2.1.1"><span class="header-section-number">1.1.2.1.1</span> Types</h5>
<p>There are four primary types of atomic vectors, and their <strong>scalars</strong> (<em>i.e. individual value</em>) can
be instantiated as:</p>
<ol style="list-style-type: decimal">
<li><strong>Logical</strong>: <code>TRUE</code>/<code>T</code>;<code>FALSE</code>/<code>F</code></li>
<li><strong>Double</strong>: decimal <code>2.345</code>, scientific <code>2e10</code>, hexadecimal <code>3425h</code>, infinite <code>Inf</code>/<code>-Inf</code>, Not a Number <code>NaN</code></li>
<li><strong>Integer</strong>: a non-fractional double followed by <code>L</code> (e.g. <code>7L</code>, <code>2e7L</code>, <code>3425hL</code> )</li>
<li><strong>Character</strong>: strings surrounded by single/double quotes; <code>'Cats'</code> or <code>"Dogs"</code></li>
</ol>
<p>Doubles and Integers belong to meta-type <strong>numeric</strong>. <code>is.numeric()</code> tests if a vector can be interpreted
as a number: <code>is.numeric(2.2)</code> = TRUE = <code>is.numeric(2L)</code> = TRUE</p>
</div>
<div id="combine-scalars" class="section level5" number="1.1.2.1.2">
<h5 number="1.1.2.1.2"><span class="header-section-number">1.1.2.1.2</span> Combine scalars</h5>
<p>Scalars can be combined to make longer vectors using <code>c()</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="advanced-r.html#cb15-1"></a><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb15-2"><a href="advanced-r.html#cb15-2"></a><span class="co">## [1] 1 2 3</span></span>
<span id="cb15-3"><a href="advanced-r.html#cb15-3"></a><span class="kw">c</span>(T,T,F)</span>
<span id="cb15-4"><a href="advanced-r.html#cb15-4"></a><span class="co">## [1]  TRUE  TRUE FALSE</span></span></code></pre></div>
<p>R will flatten atomic vectors when combined with other atomic vectors:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="advanced-r.html#cb16-1"></a><span class="kw">c</span>(<span class="dv">1</span>,<span class="kw">c</span>(<span class="dv">2</span>,<span class="kw">c</span>(<span class="fl">2.1</span>,<span class="fl">2.2</span>,<span class="fl">2.3</span>)),<span class="dv">4</span>)</span>
<span id="cb16-2"><a href="advanced-r.html#cb16-2"></a><span class="co">## [1] 1.0 2.0 2.1 2.2 2.3 4.0</span></span></code></pre></div>
<p><code>typeof()</code> and <code>length()</code> will return the type and length of an atomic vector:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="advanced-r.html#cb17-1"></a>x &lt;-<span class="st"> </span><span class="ot">TRUE</span>; y &lt;-<span class="st"> </span><span class="kw">c</span>(1L, 2L, 3L, 4L)</span>
<span id="cb17-2"><a href="advanced-r.html#cb17-2"></a></span>
<span id="cb17-3"><a href="advanced-r.html#cb17-3"></a><span class="kw">typeof</span>(x); <span class="kw">length</span>(x)</span>
<span id="cb17-4"><a href="advanced-r.html#cb17-4"></a><span class="co">## [1] &quot;logical&quot;</span></span>
<span id="cb17-5"><a href="advanced-r.html#cb17-5"></a><span class="co">## [1] 1</span></span>
<span id="cb17-6"><a href="advanced-r.html#cb17-6"></a><span class="kw">typeof</span>(y); <span class="kw">length</span>(y)</span>
<span id="cb17-7"><a href="advanced-r.html#cb17-7"></a><span class="co">## [1] &quot;integer&quot;</span></span>
<span id="cb17-8"><a href="advanced-r.html#cb17-8"></a><span class="co">## [1] 4</span></span>
<span id="cb17-9"><a href="advanced-r.html#cb17-9"></a><span class="kw">typeof</span>(<span class="ot">NULL</span>); <span class="kw">length</span>(<span class="ot">NULL</span>)</span>
<span id="cb17-10"><a href="advanced-r.html#cb17-10"></a><span class="co">## [1] &quot;NULL&quot;</span></span>
<span id="cb17-11"><a href="advanced-r.html#cb17-11"></a><span class="co">## [1] 0</span></span></code></pre></div>
</div>
<div id="missing-values" class="section level5" number="1.1.2.1.3">
<h5 number="1.1.2.1.3"><span class="header-section-number">1.1.2.1.3</span> Missing values</h5>
<p>Missing values are represented by <code>NA</code> (Not Applicable). There are logical (<code>NA</code>),
integer (<code>NA_integer_</code>), double (<code>NA_real_</code>), and character (<code>NA_character_</code>) types
but R will parse the appropriate <code>NA</code> needed.</p>
<p>Many logistical tests in R containing <code>NA</code> will return <code>NA</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="advanced-r.html#cb18-1"></a><span class="co"># not false returns true; not NA returns NA</span></span>
<span id="cb18-2"><a href="advanced-r.html#cb18-2"></a><span class="op">!</span><span class="ot">FALSE</span>; <span class="op">!</span><span class="ot">NA</span></span>
<span id="cb18-3"><a href="advanced-r.html#cb18-3"></a><span class="co">## [1] TRUE</span></span>
<span id="cb18-4"><a href="advanced-r.html#cb18-4"></a><span class="co">## [1] NA</span></span></code></pre></div>
<p>For this reason, finding missing values in a vector is not obvious:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="advanced-r.html#cb19-1"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb19-2"><a href="advanced-r.html#cb19-2"></a><span class="co"># a logistical test for NA returns all NA</span></span>
<span id="cb19-3"><a href="advanced-r.html#cb19-3"></a>x<span class="op">==</span><span class="ot">NA</span></span>
<span id="cb19-4"><a href="advanced-r.html#cb19-4"></a><span class="co">## [1] NA NA NA NA NA</span></span></code></pre></div>
<p>Instead, use <code>is.na()</code> to test for missing values:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="advanced-r.html#cb20-1"></a><span class="kw">is.na</span>(x)</span>
<span id="cb20-2"><a href="advanced-r.html#cb20-2"></a><span class="co">## [1] FALSE  TRUE  TRUE FALSE FALSE</span></span></code></pre></div>
<p>The exception is when all possible values would not change the result:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="advanced-r.html#cb21-1"></a><span class="co"># this logical statement is true regardless of all possible NA values</span></span>
<span id="cb21-2"><a href="advanced-r.html#cb21-2"></a><span class="ot">NA</span> <span class="op">|</span><span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb21-3"><a href="advanced-r.html#cb21-3"></a><span class="co">## [1] TRUE</span></span></code></pre></div>
</div>
<div id="testing-and-coercing-vectors" class="section level5" number="1.1.2.1.4">
<h5 number="1.1.2.1.4"><span class="header-section-number">1.1.2.1.4</span> Testing and coercing vectors</h5>
<p>There are many <code>is.*()</code> pattern functions in R to test vector type. <code>is.logical()</code>,
<code>is.integer()</code>, <code>is.double()</code>, and <code>is.character()</code> all test for the four primary
atomic vector types:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="advanced-r.html#cb22-1"></a><span class="kw">is.logical</span>(<span class="dt">x =</span> <span class="kw">c</span>(T,T,F,F))</span>
<span id="cb22-2"><a href="advanced-r.html#cb22-2"></a><span class="co">## [1] TRUE</span></span>
<span id="cb22-3"><a href="advanced-r.html#cb22-3"></a><span class="kw">is.integer</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="fl">2.2</span>, <span class="fl">3.0</span>))</span>
<span id="cb22-4"><a href="advanced-r.html#cb22-4"></a><span class="co">## [1] FALSE</span></span></code></pre></div>
<p>However, some <code>is.*()</code> pattern functions behave unexpectedly. <code>is.numeric()</code>,
for example, returns false for factors, Date, POSIXt and difftime because they
have their own methods for detection; even though they are numbers and arithmetic
generally makes sense. So be sure to read the documentation carefully (<code>?is.numeric()</code>).</p>
<hr />
<p><em>coercing types</em></p>
<p>It is possible to coerce vectors to a new type, or two combine two types of vectors into
one. The types will be coerced in this order: <em>character &gt; double &gt; integer &gt; logical</em></p>
<p>Use <code>as.*()</code> functions to specifically coerce types. R can also implicitly coerce types
when needed. R will give a warning message if it fails or <code>NA</code>s are introduced.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="advanced-r.html#cb23-1"></a><span class="co"># combining a double and a character returns a character vector</span></span>
<span id="cb23-2"><a href="advanced-r.html#cb23-2"></a><span class="kw">str</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="st">&quot;2&quot;</span>))</span>
<span id="cb23-3"><a href="advanced-r.html#cb23-3"></a><span class="co">##  chr [1:2] &quot;1&quot; &quot;2&quot;</span></span>
<span id="cb23-4"><a href="advanced-r.html#cb23-4"></a></span>
<span id="cb23-5"><a href="advanced-r.html#cb23-5"></a><span class="co"># implicitly return the sum of a logical as integer </span></span>
<span id="cb23-6"><a href="advanced-r.html#cb23-6"></a><span class="kw">str</span>(<span class="kw">sum</span>(<span class="kw">c</span>(T,T,F)))</span>
<span id="cb23-7"><a href="advanced-r.html#cb23-7"></a><span class="co">##  int 2</span></span>
<span id="cb23-8"><a href="advanced-r.html#cb23-8"></a></span>
<span id="cb23-9"><a href="advanced-r.html#cb23-9"></a><span class="co"># explicitly coerce doubles to characters</span></span>
<span id="cb23-10"><a href="advanced-r.html#cb23-10"></a><span class="kw">str</span>(<span class="kw">as.character</span>(<span class="kw">c</span>(<span class="fl">2e1</span>, <span class="dv">200</span>)))</span>
<span id="cb23-11"><a href="advanced-r.html#cb23-11"></a><span class="co">##  chr [1:2] &quot;20&quot; &quot;200&quot;</span></span></code></pre></div>
</div>
</div>
<div id="attributes" class="section level4" number="1.1.2.2">
<h4 number="1.1.2.2"><span class="header-section-number">1.1.2.2</span> Attributes</h4>
<p>Other data-structures in R are built on top of these atomic vectors using attributes.
For example, the <strong>dimension</strong> attribute transforms vectors into matrices and arrays.</p>
<div id="getting-and-setting-attributes" class="section level5" number="1.1.2.2.1">
<h5 number="1.1.2.2.1"><span class="header-section-number">1.1.2.2.1</span> Getting and setting attributes</h5>
<p>Attributes are like meta-data you assign in name-value pairs:</p>
<ul>
<li><code>attr()</code> to retrieve and set single attributes</li>
<li><code>attributes()</code> to retrieve multiple attributes</li>
<li><code>structure()</code> to set multiple attributes</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="advanced-r.html#cb24-1"></a>fruit &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb24-2"><a href="advanced-r.html#cb24-2"></a></span>
<span id="cb24-3"><a href="advanced-r.html#cb24-3"></a><span class="co"># create fruit attributes type and days old</span></span>
<span id="cb24-4"><a href="advanced-r.html#cb24-4"></a><span class="kw">attr</span>(<span class="dt">x =</span> fruit, <span class="dt">which =</span> <span class="st">&#39;type&#39;</span>) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;orange&#39;</span>,<span class="st">&#39;apple&#39;</span>,<span class="st">&#39;pear&#39;</span>)</span>
<span id="cb24-5"><a href="advanced-r.html#cb24-5"></a><span class="kw">attr</span>(fruit,<span class="st">&#39;type&#39;</span>)</span>
<span id="cb24-6"><a href="advanced-r.html#cb24-6"></a><span class="co">## [1] &quot;orange&quot; &quot;apple&quot;  &quot;pear&quot;</span></span>
<span id="cb24-7"><a href="advanced-r.html#cb24-7"></a></span>
<span id="cb24-8"><a href="advanced-r.html#cb24-8"></a><span class="kw">attr</span>(<span class="dt">x =</span> fruit, <span class="dt">which =</span> <span class="st">&#39;days old&#39;</span>) &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb24-9"><a href="advanced-r.html#cb24-9"></a><span class="kw">str</span>(<span class="kw">attributes</span>(<span class="dt">x =</span> fruit))</span>
<span id="cb24-10"><a href="advanced-r.html#cb24-10"></a><span class="co">## List of 2</span></span>
<span id="cb24-11"><a href="advanced-r.html#cb24-11"></a><span class="co">##  $ type    : chr [1:3] &quot;orange&quot; &quot;apple&quot; &quot;pear&quot;</span></span>
<span id="cb24-12"><a href="advanced-r.html#cb24-12"></a><span class="co">##  $ days old: num 2</span></span>
<span id="cb24-13"><a href="advanced-r.html#cb24-13"></a></span>
<span id="cb24-14"><a href="advanced-r.html#cb24-14"></a><span class="co"># simultaneously create object and attributes</span></span>
<span id="cb24-15"><a href="advanced-r.html#cb24-15"></a>fruit &lt;-<span class="st"> </span><span class="kw">structure</span>(</span>
<span id="cb24-16"><a href="advanced-r.html#cb24-16"></a>  <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</span>
<span id="cb24-17"><a href="advanced-r.html#cb24-17"></a>  <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&#39;orange&#39;</span>,<span class="st">&#39;apple&#39;</span>,<span class="st">&#39;pear&#39;</span>),</span>
<span id="cb24-18"><a href="advanced-r.html#cb24-18"></a>  <span class="st">&#39;days old&#39;</span> =<span class="st"> </span><span class="dv">2</span></span>
<span id="cb24-19"><a href="advanced-r.html#cb24-19"></a>)</span>
<span id="cb24-20"><a href="advanced-r.html#cb24-20"></a></span>
<span id="cb24-21"><a href="advanced-r.html#cb24-21"></a><span class="kw">str</span>(<span class="kw">attributes</span>(fruit))</span>
<span id="cb24-22"><a href="advanced-r.html#cb24-22"></a><span class="co">## List of 2</span></span>
<span id="cb24-23"><a href="advanced-r.html#cb24-23"></a><span class="co">##  $ type    : chr [1:3] &quot;orange&quot; &quot;apple&quot; &quot;pear&quot;</span></span>
<span id="cb24-24"><a href="advanced-r.html#cb24-24"></a><span class="co">##  $ days old: num 2</span></span></code></pre></div>
</div>
<div id="names" class="section level5" number="1.1.2.2.2">
<h5 number="1.1.2.2.2"><span class="header-section-number">1.1.2.2.2</span> Names</h5>
<p><code>names</code> is a special and important attribute in R. Although it is not enforced,
names should be unique and complete. They can be set several ways:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="advanced-r.html#cb25-1"></a><span class="co"># on creation</span></span>
<span id="cb25-2"><a href="advanced-r.html#cb25-2"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">a=</span><span class="dv">1</span>,<span class="dt">b=</span><span class="dv">2</span>,<span class="dt">c=</span><span class="dv">3</span>)</span>
<span id="cb25-3"><a href="advanced-r.html#cb25-3"></a><span class="kw">attr</span>(x, <span class="dt">which=</span><span class="st">&#39;names&#39;</span>)</span>
<span id="cb25-4"><a href="advanced-r.html#cb25-4"></a><span class="co">## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></span>
<span id="cb25-5"><a href="advanced-r.html#cb25-5"></a></span>
<span id="cb25-6"><a href="advanced-r.html#cb25-6"></a><span class="co"># assigning a vector of names</span></span>
<span id="cb25-7"><a href="advanced-r.html#cb25-7"></a>x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span></span>
<span id="cb25-8"><a href="advanced-r.html#cb25-8"></a><span class="kw">names</span>(x) &lt;-<span class="st"> </span>letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</span>
<span id="cb25-9"><a href="advanced-r.html#cb25-9"></a><span class="kw">attr</span>(x, <span class="dt">which=</span><span class="st">&#39;names&#39;</span>)</span>
<span id="cb25-10"><a href="advanced-r.html#cb25-10"></a><span class="co">## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></span>
<span id="cb25-11"><a href="advanced-r.html#cb25-11"></a></span>
<span id="cb25-12"><a href="advanced-r.html#cb25-12"></a><span class="co"># inline with setNames()</span></span>
<span id="cb25-13"><a href="advanced-r.html#cb25-13"></a>x &lt;-<span class="st"> </span><span class="kw">setNames</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])</span>
<span id="cb25-14"><a href="advanced-r.html#cb25-14"></a><span class="kw">attr</span>(x, <span class="dt">which=</span><span class="st">&#39;names&#39;</span>)</span>
<span id="cb25-15"><a href="advanced-r.html#cb25-15"></a><span class="co">## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></span>
<span id="cb25-16"><a href="advanced-r.html#cb25-16"></a></span>
<span id="cb25-17"><a href="advanced-r.html#cb25-17"></a><span class="co"># with attr()</span></span>
<span id="cb25-18"><a href="advanced-r.html#cb25-18"></a><span class="kw">attr</span>(x, <span class="dt">which =</span> <span class="st">&#39;names&#39;</span>) &lt;-<span class="st"> </span>letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</span>
<span id="cb25-19"><a href="advanced-r.html#cb25-19"></a><span class="kw">attr</span>(x, <span class="dt">which=</span><span class="st">&#39;names&#39;</span>)</span>
<span id="cb25-20"><a href="advanced-r.html#cb25-20"></a><span class="co">## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></span></code></pre></div>
</div>
<div id="dimensions" class="section level5" number="1.1.2.2.3">
<h5 number="1.1.2.2.3"><span class="header-section-number">1.1.2.2.3</span> Dimensions</h5>
<p>The <code>dim</code> attribute transforms <code>NULL</code> dimensional vectors into 2d matrices and multi-dimensional arrays, and can be set by <code>dim()</code>, <code>matrix()</code>, and <code>array()</code>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="advanced-r.html#cb26-1"></a>x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">6</span></span>
<span id="cb26-2"><a href="advanced-r.html#cb26-2"></a></span>
<span id="cb26-3"><a href="advanced-r.html#cb26-3"></a><span class="kw">dim</span>(x) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb26-4"><a href="advanced-r.html#cb26-4"></a>x</span>
<span id="cb26-5"><a href="advanced-r.html#cb26-5"></a><span class="co">##      [,1] [,2] [,3]</span></span>
<span id="cb26-6"><a href="advanced-r.html#cb26-6"></a><span class="co">## [1,]    1    3    5</span></span>
<span id="cb26-7"><a href="advanced-r.html#cb26-7"></a><span class="co">## [2,]    2    4    6</span></span>
<span id="cb26-8"><a href="advanced-r.html#cb26-8"></a></span>
<span id="cb26-9"><a href="advanced-r.html#cb26-9"></a><span class="kw">matrix</span>(<span class="dt">data =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">ncol =</span> <span class="dv">6</span>)</span>
<span id="cb26-10"><a href="advanced-r.html#cb26-10"></a><span class="co">##      [,1] [,2] [,3] [,4] [,5] [,6]</span></span>
<span id="cb26-11"><a href="advanced-r.html#cb26-11"></a><span class="co">## [1,]    1    2    3    4    5    6</span></span>
<span id="cb26-12"><a href="advanced-r.html#cb26-12"></a></span>
<span id="cb26-13"><a href="advanced-r.html#cb26-13"></a><span class="kw">array</span>(<span class="dt">data =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">dim =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb26-14"><a href="advanced-r.html#cb26-14"></a><span class="co">##      [,1] [,2] [,3]</span></span>
<span id="cb26-15"><a href="advanced-r.html#cb26-15"></a><span class="co">## [1,]    1    3    5</span></span>
<span id="cb26-16"><a href="advanced-r.html#cb26-16"></a><span class="co">## [2,]    2    4    6</span></span>
<span id="cb26-17"><a href="advanced-r.html#cb26-17"></a></span>
<span id="cb26-18"><a href="advanced-r.html#cb26-18"></a><span class="co"># non-idiomatic</span></span>
<span id="cb26-19"><a href="advanced-r.html#cb26-19"></a><span class="kw">attr</span>(x, <span class="st">&#39;dim&#39;</span>) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb26-20"><a href="advanced-r.html#cb26-20"></a>x</span>
<span id="cb26-21"><a href="advanced-r.html#cb26-21"></a><span class="co">##      [,1] [,2]</span></span>
<span id="cb26-22"><a href="advanced-r.html#cb26-22"></a><span class="co">## [1,]    1    4</span></span>
<span id="cb26-23"><a href="advanced-r.html#cb26-23"></a><span class="co">## [2,]    2    5</span></span>
<span id="cb26-24"><a href="advanced-r.html#cb26-24"></a><span class="co">## [3,]    3    6</span></span></code></pre></div>
<p>Vector functions usually have matrix or array counterparts:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="advanced-r.html#cb27-1"></a><span class="co"># vector, matrix, and array bindings</span></span>
<span id="cb27-2"><a href="advanced-r.html#cb27-2"></a>v &lt;-<span class="st"> </span><span class="kw">structure</span>(<span class="dt">.Data =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>, </span>
<span id="cb27-3"><a href="advanced-r.html#cb27-3"></a>               <span class="dt">names =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>])</span>
<span id="cb27-4"><a href="advanced-r.html#cb27-4"></a></span>
<span id="cb27-5"><a href="advanced-r.html#cb27-5"></a>m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">data =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>, </span>
<span id="cb27-6"><a href="advanced-r.html#cb27-6"></a>            <span class="dt">nrow =</span> <span class="dv">3</span>, </span>
<span id="cb27-7"><a href="advanced-r.html#cb27-7"></a>            <span class="dt">ncol =</span> <span class="dv">3</span>, </span>
<span id="cb27-8"><a href="advanced-r.html#cb27-8"></a>            <span class="dt">dimnames =</span> <span class="kw">list</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], </span>
<span id="cb27-9"><a href="advanced-r.html#cb27-9"></a>                            letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]))</span>
<span id="cb27-10"><a href="advanced-r.html#cb27-10"></a>                                                            </span>
<span id="cb27-11"><a href="advanced-r.html#cb27-11"></a>a &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="dt">data =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>, </span>
<span id="cb27-12"><a href="advanced-r.html#cb27-12"></a>           <span class="dt">dim =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">3</span>), </span>
<span id="cb27-13"><a href="advanced-r.html#cb27-13"></a>           <span class="dt">dimnames =</span> <span class="kw">list</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], </span>
<span id="cb27-14"><a href="advanced-r.html#cb27-14"></a>                           letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]))</span>
<span id="cb27-15"><a href="advanced-r.html#cb27-15"></a></span>
<span id="cb27-16"><a href="advanced-r.html#cb27-16"></a><span class="co"># Names</span></span>
<span id="cb27-17"><a href="advanced-r.html#cb27-17"></a><span class="kw">names</span>(v)</span>
<span id="cb27-18"><a href="advanced-r.html#cb27-18"></a><span class="co">## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot; &quot;g&quot; &quot;h&quot; &quot;i&quot;</span></span>
<span id="cb27-19"><a href="advanced-r.html#cb27-19"></a><span class="kw">rownames</span>(m); <span class="kw">colnames</span>(m)</span>
<span id="cb27-20"><a href="advanced-r.html#cb27-20"></a><span class="co">## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></span>
<span id="cb27-21"><a href="advanced-r.html#cb27-21"></a><span class="co">## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></span>
<span id="cb27-22"><a href="advanced-r.html#cb27-22"></a><span class="kw">dimnames</span>(a)</span>
<span id="cb27-23"><a href="advanced-r.html#cb27-23"></a><span class="co">## [[1]]</span></span>
<span id="cb27-24"><a href="advanced-r.html#cb27-24"></a><span class="co">## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></span>
<span id="cb27-25"><a href="advanced-r.html#cb27-25"></a><span class="co">## </span></span>
<span id="cb27-26"><a href="advanced-r.html#cb27-26"></a><span class="co">## [[2]]</span></span>
<span id="cb27-27"><a href="advanced-r.html#cb27-27"></a><span class="co">## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></span>
<span id="cb27-28"><a href="advanced-r.html#cb27-28"></a></span>
<span id="cb27-29"><a href="advanced-r.html#cb27-29"></a><span class="co"># Lengths</span></span>
<span id="cb27-30"><a href="advanced-r.html#cb27-30"></a></span>
<span id="cb27-31"><a href="advanced-r.html#cb27-31"></a><span class="kw">length</span>(v)</span>
<span id="cb27-32"><a href="advanced-r.html#cb27-32"></a><span class="co">## [1] 9</span></span>
<span id="cb27-33"><a href="advanced-r.html#cb27-33"></a><span class="kw">nrow</span>(m);<span class="kw">ncol</span>(m)</span>
<span id="cb27-34"><a href="advanced-r.html#cb27-34"></a><span class="co">## [1] 3</span></span>
<span id="cb27-35"><a href="advanced-r.html#cb27-35"></a><span class="co">## [1] 3</span></span>
<span id="cb27-36"><a href="advanced-r.html#cb27-36"></a><span class="kw">dim</span>(a)</span>
<span id="cb27-37"><a href="advanced-r.html#cb27-37"></a><span class="co">## [1] 3 3</span></span>
<span id="cb27-38"><a href="advanced-r.html#cb27-38"></a></span>
<span id="cb27-39"><a href="advanced-r.html#cb27-39"></a><span class="co"># Combine</span></span>
<span id="cb27-40"><a href="advanced-r.html#cb27-40"></a></span>
<span id="cb27-41"><a href="advanced-r.html#cb27-41"></a><span class="kw">c</span>(v, <span class="kw">c</span>(<span class="dt">j=</span><span class="dv">10</span>))</span>
<span id="cb27-42"><a href="advanced-r.html#cb27-42"></a><span class="co">##  a  b  c  d  e  f  g  h  i  j </span></span>
<span id="cb27-43"><a href="advanced-r.html#cb27-43"></a><span class="co">##  1  2  3  4  5  6  7  8  9 10</span></span>
<span id="cb27-44"><a href="advanced-r.html#cb27-44"></a><span class="kw">rbind</span>(m, <span class="dv">10</span><span class="op">:</span><span class="dv">12</span>);<span class="kw">cbind</span>(m, <span class="dv">10</span><span class="op">:</span><span class="dv">12</span>)</span>
<span id="cb27-45"><a href="advanced-r.html#cb27-45"></a><span class="co">##    a  b  c</span></span>
<span id="cb27-46"><a href="advanced-r.html#cb27-46"></a><span class="co">## a  1  4  7</span></span>
<span id="cb27-47"><a href="advanced-r.html#cb27-47"></a><span class="co">## b  2  5  8</span></span>
<span id="cb27-48"><a href="advanced-r.html#cb27-48"></a><span class="co">## c  3  6  9</span></span>
<span id="cb27-49"><a href="advanced-r.html#cb27-49"></a><span class="co">##   10 11 12</span></span>
<span id="cb27-50"><a href="advanced-r.html#cb27-50"></a><span class="co">##   a b c   </span></span>
<span id="cb27-51"><a href="advanced-r.html#cb27-51"></a><span class="co">## a 1 4 7 10</span></span>
<span id="cb27-52"><a href="advanced-r.html#cb27-52"></a><span class="co">## b 2 5 8 11</span></span>
<span id="cb27-53"><a href="advanced-r.html#cb27-53"></a><span class="co">## c 3 6 9 12</span></span>
<span id="cb27-54"><a href="advanced-r.html#cb27-54"></a>abind<span class="op">::</span><span class="kw">abind</span>(a, <span class="dv">10</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">along=</span><span class="dv">1</span>); abind<span class="op">::</span><span class="kw">abind</span>(a, <span class="dv">10</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">along=</span><span class="dv">2</span>)</span>
<span id="cb27-55"><a href="advanced-r.html#cb27-55"></a><span class="co">##    a  b  c</span></span>
<span id="cb27-56"><a href="advanced-r.html#cb27-56"></a><span class="co">## a  1  4  7</span></span>
<span id="cb27-57"><a href="advanced-r.html#cb27-57"></a><span class="co">## b  2  5  8</span></span>
<span id="cb27-58"><a href="advanced-r.html#cb27-58"></a><span class="co">## c  3  6  9</span></span>
<span id="cb27-59"><a href="advanced-r.html#cb27-59"></a><span class="co">##   10 11 12</span></span>
<span id="cb27-60"><a href="advanced-r.html#cb27-60"></a><span class="co">##   a b c   </span></span>
<span id="cb27-61"><a href="advanced-r.html#cb27-61"></a><span class="co">## a 1 4 7 10</span></span>
<span id="cb27-62"><a href="advanced-r.html#cb27-62"></a><span class="co">## b 2 5 8 11</span></span>
<span id="cb27-63"><a href="advanced-r.html#cb27-63"></a><span class="co">## c 3 6 9 12</span></span>
<span id="cb27-64"><a href="advanced-r.html#cb27-64"></a></span>
<span id="cb27-65"><a href="advanced-r.html#cb27-65"></a><span class="co"># Transpose</span></span>
<span id="cb27-66"><a href="advanced-r.html#cb27-66"></a></span>
<span id="cb27-67"><a href="advanced-r.html#cb27-67"></a><span class="kw">t</span>(m)</span>
<span id="cb27-68"><a href="advanced-r.html#cb27-68"></a><span class="co">##   a b c</span></span>
<span id="cb27-69"><a href="advanced-r.html#cb27-69"></a><span class="co">## a 1 2 3</span></span>
<span id="cb27-70"><a href="advanced-r.html#cb27-70"></a><span class="co">## b 4 5 6</span></span>
<span id="cb27-71"><a href="advanced-r.html#cb27-71"></a><span class="co">## c 7 8 9</span></span>
<span id="cb27-72"><a href="advanced-r.html#cb27-72"></a><span class="kw">aperm</span>(a)</span>
<span id="cb27-73"><a href="advanced-r.html#cb27-73"></a><span class="co">##   a b c</span></span>
<span id="cb27-74"><a href="advanced-r.html#cb27-74"></a><span class="co">## a 1 2 3</span></span>
<span id="cb27-75"><a href="advanced-r.html#cb27-75"></a><span class="co">## b 4 5 6</span></span>
<span id="cb27-76"><a href="advanced-r.html#cb27-76"></a><span class="co">## c 7 8 9</span></span>
<span id="cb27-77"><a href="advanced-r.html#cb27-77"></a></span>
<span id="cb27-78"><a href="advanced-r.html#cb27-78"></a><span class="co"># Type test</span></span>
<span id="cb27-79"><a href="advanced-r.html#cb27-79"></a></span>
<span id="cb27-80"><a href="advanced-r.html#cb27-80"></a><span class="kw">is.vector</span>(v, <span class="dt">mode=</span><span class="st">&#39;any&#39;</span>)</span>
<span id="cb27-81"><a href="advanced-r.html#cb27-81"></a><span class="co">## [1] TRUE</span></span>
<span id="cb27-82"><a href="advanced-r.html#cb27-82"></a><span class="kw">is.matrix</span>(m)</span>
<span id="cb27-83"><a href="advanced-r.html#cb27-83"></a><span class="co">## [1] TRUE</span></span>
<span id="cb27-84"><a href="advanced-r.html#cb27-84"></a><span class="kw">is.array</span>(a)</span>
<span id="cb27-85"><a href="advanced-r.html#cb27-85"></a><span class="co">## [1] TRUE</span></span></code></pre></div>
<p>Vectors may have different dimensions. They may print similar but will behave differently. Pay
attention to [] syntax:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="advanced-r.html#cb28-1"></a><span class="co"># 1d vector</span></span>
<span id="cb28-2"><a href="advanced-r.html#cb28-2"></a><span class="kw">str</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb28-3"><a href="advanced-r.html#cb28-3"></a><span class="co">##  int [1:10] 1 2 3 4 5 6 7 8 9 10</span></span>
<span id="cb28-4"><a href="advanced-r.html#cb28-4"></a></span>
<span id="cb28-5"><a href="advanced-r.html#cb28-5"></a><span class="co"># column vector</span></span>
<span id="cb28-6"><a href="advanced-r.html#cb28-6"></a><span class="kw">str</span>(<span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">ncol =</span> <span class="dv">1</span>))</span>
<span id="cb28-7"><a href="advanced-r.html#cb28-7"></a><span class="co">##  int [1:10, 1] 1 2 3 4 5 6 7 8 9 10</span></span>
<span id="cb28-8"><a href="advanced-r.html#cb28-8"></a></span>
<span id="cb28-9"><a href="advanced-r.html#cb28-9"></a><span class="co"># row vector</span></span>
<span id="cb28-10"><a href="advanced-r.html#cb28-10"></a><span class="kw">str</span>(<span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">nrow =</span> <span class="dv">1</span>))</span>
<span id="cb28-11"><a href="advanced-r.html#cb28-11"></a><span class="co">##  int [1, 1:10] 1 2 3 4 5 6 7 8 9 10</span></span>
<span id="cb28-12"><a href="advanced-r.html#cb28-12"></a></span>
<span id="cb28-13"><a href="advanced-r.html#cb28-13"></a><span class="co"># 1d &quot;array&quot; vector</span></span>
<span id="cb28-14"><a href="advanced-r.html#cb28-14"></a><span class="kw">str</span>(<span class="kw">array</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb28-15"><a href="advanced-r.html#cb28-15"></a><span class="co">##  int [1:10(1d)] 1 2 3 4 5 6 7 8 9 10</span></span></code></pre></div>
</div>
</div>
<div id="s3-atomic-vectors" class="section level4" number="1.1.2.3">
<h4 number="1.1.2.3"><span class="header-section-number">1.1.2.3</span> S3 Atomic Vectors</h4>
<p>The attribute <code>class</code> is what makes an object part of the S3 object system in R, and
changes how generic functions behave compared to regular vectors. S3 objects are built
on top of atomic vectors.</p>
<div id="factors" class="section level5" number="1.1.2.3.1">
<h5 number="1.1.2.3.1"><span class="header-section-number">1.1.2.3.1</span> Factors</h5>
<p>Factors are a ubiquitous S3 object in base R. They handle categorical variables where the
vector must contain only known values.</p>
<p>Factors are built on atomic vectors of type <code>integer</code>, and only have two attributes: <code>class</code> “factor” and <code>levels</code>, which defines the set, and sometimes order, of possible values.</p>
<p>Use <code>factor()</code> create a factor:</p>
<ul>
<li><em>x</em>: a vector coercible to <code>character</code></li>
<li><em>levels</em>: a unique vector of <em>expected</em> values in x; which can contain values not found in x or, conversely, exclude values found in x</li>
<li><em>labels</em>: a vector of name <em>aliases</em> for levels (in the same order as levels) or scalar</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="advanced-r.html#cb29-1"></a><span class="co"># create a factor from a vector of state abbreviations</span></span>
<span id="cb29-2"><a href="advanced-r.html#cb29-2"></a><span class="co"># tell R to expect values MO, NY, AK, HI and their aliases are Missouri, New York, Alaska, </span></span>
<span id="cb29-3"><a href="advanced-r.html#cb29-3"></a><span class="co"># &amp; Hawaii</span></span>
<span id="cb29-4"><a href="advanced-r.html#cb29-4"></a>states &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&#39;MO&#39;</span>,<span class="st">&#39;NY&#39;</span>,<span class="st">&#39;AK&#39;</span>,<span class="st">&#39;MO&#39;</span>,<span class="st">&#39;AK&#39;</span>,<span class="st">&#39;IL&#39;</span>),</span>
<span id="cb29-5"><a href="advanced-r.html#cb29-5"></a>                 <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&#39;MO&#39;</span>,<span class="st">&#39;NY&#39;</span>,<span class="st">&#39;AK&#39;</span>,<span class="st">&#39;HI&#39;</span>),</span>
<span id="cb29-6"><a href="advanced-r.html#cb29-6"></a>                 <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;Missouri&#39;</span>,<span class="st">&#39;New York&#39;</span>,<span class="st">&#39;Alaska&#39;</span>,<span class="st">&#39;Hawaii&#39;</span>))</span>
<span id="cb29-7"><a href="advanced-r.html#cb29-7"></a></span>
<span id="cb29-8"><a href="advanced-r.html#cb29-8"></a><span class="co"># factor() converts the vector to integer values under-the-hood. These are rarely visible </span></span>
<span id="cb29-9"><a href="advanced-r.html#cb29-9"></a><span class="co"># but can be exposed using c() (or unclass() but then you no longer have a factor). The </span></span>
<span id="cb29-10"><a href="advanced-r.html#cb29-10"></a><span class="co"># integer refers to the sequence of levels given, starting with &#39;MO&#39; in this case.</span></span>
<span id="cb29-11"><a href="advanced-r.html#cb29-11"></a><span class="kw">str</span>(<span class="kw">c</span>(states))</span>
<span id="cb29-12"><a href="advanced-r.html#cb29-12"></a><span class="co">##  int [1:6] 1 2 3 1 3 NA</span></span>
<span id="cb29-13"><a href="advanced-r.html#cb29-13"></a></span>
<span id="cb29-14"><a href="advanced-r.html#cb29-14"></a><span class="co"># usually factors print their levels attribute</span></span>
<span id="cb29-15"><a href="advanced-r.html#cb29-15"></a>states</span>
<span id="cb29-16"><a href="advanced-r.html#cb29-16"></a><span class="co">## [1] Missouri New York Alaska   Missouri Alaska   &lt;NA&gt;    </span></span>
<span id="cb29-17"><a href="advanced-r.html#cb29-17"></a><span class="co">## Levels: Missouri New York Alaska Hawaii</span></span>
<span id="cb29-18"><a href="advanced-r.html#cb29-18"></a><span class="co"># notice it did not print the levels given in factor(), but rather the label aliases </span></span>
<span id="cb29-19"><a href="advanced-r.html#cb29-19"></a><span class="co"># were given to attribute `levels`. If no labels argument is given it defaults to same</span></span>
<span id="cb29-20"><a href="advanced-r.html#cb29-20"></a><span class="co"># as levels.</span></span>
<span id="cb29-21"><a href="advanced-r.html#cb29-21"></a><span class="kw">attributes</span>(states)</span>
<span id="cb29-22"><a href="advanced-r.html#cb29-22"></a><span class="co">## $levels</span></span>
<span id="cb29-23"><a href="advanced-r.html#cb29-23"></a><span class="co">## [1] &quot;Missouri&quot; &quot;New York&quot; &quot;Alaska&quot;   &quot;Hawaii&quot;  </span></span>
<span id="cb29-24"><a href="advanced-r.html#cb29-24"></a><span class="co">## </span></span>
<span id="cb29-25"><a href="advanced-r.html#cb29-25"></a><span class="co">## $class</span></span>
<span id="cb29-26"><a href="advanced-r.html#cb29-26"></a><span class="co">## [1] &quot;factor&quot;</span></span>
<span id="cb29-27"><a href="advanced-r.html#cb29-27"></a></span>
<span id="cb29-28"><a href="advanced-r.html#cb29-28"></a><span class="co"># if no levels argument was given, factor() would have defaulted to the unique set of values </span></span>
<span id="cb29-29"><a href="advanced-r.html#cb29-29"></a><span class="co"># in x in ascending order. Note this would include Illinois (which we originally excluded and</span></span>
<span id="cb29-30"><a href="advanced-r.html#cb29-30"></a><span class="co"># values in states became `NA`), and would have excluded Hawaii (which we may have wanted</span></span>
<span id="cb29-31"><a href="advanced-r.html#cb29-31"></a><span class="co"># even though it is not in the current vector x).</span></span>
<span id="cb29-32"><a href="advanced-r.html#cb29-32"></a><span class="kw">sort</span>(<span class="kw">unique</span>(<span class="kw">as.character</span>(<span class="kw">c</span>(<span class="st">&#39;MO&#39;</span>,<span class="st">&#39;NY&#39;</span>,<span class="st">&#39;AK&#39;</span>,<span class="st">&#39;MO&#39;</span>,<span class="st">&#39;AK&#39;</span>,<span class="st">&#39;IL&#39;</span>))))</span>
<span id="cb29-33"><a href="advanced-r.html#cb29-33"></a><span class="co">## [1] &quot;AK&quot; &quot;IL&quot; &quot;MO&quot; &quot;NY&quot;</span></span>
<span id="cb29-34"><a href="advanced-r.html#cb29-34"></a></span>
<span id="cb29-35"><a href="advanced-r.html#cb29-35"></a><span class="co"># notice tabulated results appear in level order and include counts even for values not</span></span>
<span id="cb29-36"><a href="advanced-r.html#cb29-36"></a><span class="co"># present in states</span></span>
<span id="cb29-37"><a href="advanced-r.html#cb29-37"></a><span class="kw">table</span>(states)</span>
<span id="cb29-38"><a href="advanced-r.html#cb29-38"></a><span class="co">## states</span></span>
<span id="cb29-39"><a href="advanced-r.html#cb29-39"></a><span class="co">## Missouri New York   Alaska   Hawaii </span></span>
<span id="cb29-40"><a href="advanced-r.html#cb29-40"></a><span class="co">##        2        1        2        0</span></span>
<span id="cb29-41"><a href="advanced-r.html#cb29-41"></a></span>
<span id="cb29-42"><a href="advanced-r.html#cb29-42"></a><span class="co"># many base R functions convert character vectors to factor by default. This may not be </span></span>
<span id="cb29-43"><a href="advanced-r.html#cb29-43"></a><span class="co"># desirable as the vector may not contain the complete set of values, or infer their</span></span>
<span id="cb29-44"><a href="advanced-r.html#cb29-44"></a><span class="co"># correct order.</span></span>
<span id="cb29-45"><a href="advanced-r.html#cb29-45"></a><span class="kw">class</span>(<span class="kw">data.frame</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="st">&#39;red&#39;</span>,<span class="st">&#39;yellow&#39;</span>,<span class="st">&#39;blue&#39;</span>))[[<span class="dv">1</span>]])</span>
<span id="cb29-46"><a href="advanced-r.html#cb29-46"></a><span class="co">## [1] &quot;factor&quot;</span></span>
<span id="cb29-47"><a href="advanced-r.html#cb29-47"></a></span>
<span id="cb29-48"><a href="advanced-r.html#cb29-48"></a><span class="co"># use arguement stringsAsFactor to inhibit default factor creation</span></span>
<span id="cb29-49"><a href="advanced-r.html#cb29-49"></a><span class="kw">class</span>(<span class="kw">data.frame</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="st">&#39;red&#39;</span>,<span class="st">&#39;yellow&#39;</span>,<span class="st">&#39;blue&#39;</span>),</span>
<span id="cb29-50"><a href="advanced-r.html#cb29-50"></a>                 <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)[[<span class="dv">1</span>]])</span>
<span id="cb29-51"><a href="advanced-r.html#cb29-51"></a><span class="co">## [1] &quot;character&quot;</span></span></code></pre></div>
<p>Some categorical variables have order. Methods and modeling functions usually
treat ordered and unordered factors very differently. Use <code>ordered()</code> to create an
object of <code>class</code> “ordered factor”, where the order in levels implies the order
between factor levels.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="advanced-r.html#cb30-1"></a>priority &lt;-<span class="st"> </span><span class="kw">ordered</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&#39;low&#39;</span>,<span class="st">&#39;medium&#39;</span>,<span class="st">&#39;high&#39;</span>),</span>
<span id="cb30-2"><a href="advanced-r.html#cb30-2"></a>                    <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&#39;low&#39;</span>,<span class="st">&#39;medium&#39;</span>,<span class="st">&#39;high&#39;</span>))</span>
<span id="cb30-3"><a href="advanced-r.html#cb30-3"></a></span>
<span id="cb30-4"><a href="advanced-r.html#cb30-4"></a><span class="kw">str</span>(priority)</span>
<span id="cb30-5"><a href="advanced-r.html#cb30-5"></a><span class="co">##  Ord.factor w/ 3 levels &quot;low&quot;&lt;&quot;medium&quot;&lt;..: 1 2 3</span></span></code></pre></div>
<p>Finally, some functions coerce factors into strings (e.g. <code>grepl()</code>) while others
(e.g. <code>c()</code>) return the integer substrate. If you want string-like behavior, best to
coerce <code>as.character()</code> before performing string operations.</p>
</div>
<div id="dates" class="section level5" number="1.1.2.3.2">
<h5 number="1.1.2.3.2"><span class="header-section-number">1.1.2.3.2</span> Dates</h5>
<p>Date vectors are S3 objects built on type <code>double</code>, and have only attribute: <code>class</code> “Date”. They
represent days from the <a href="https://en.wikipedia.org/wiki/Unix_time">UNIX Epoch</a>, 01-Jan-1970; and take
into account leap-days, but not leap-seconds.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="advanced-r.html#cb31-1"></a><span class="co"># today&#39;s date</span></span>
<span id="cb31-2"><a href="advanced-r.html#cb31-2"></a>today &lt;-<span class="st"> </span><span class="kw">Sys.Date</span>()</span>
<span id="cb31-3"><a href="advanced-r.html#cb31-3"></a><span class="kw">typeof</span>(today)</span>
<span id="cb31-4"><a href="advanced-r.html#cb31-4"></a><span class="co">## [1] &quot;double&quot;</span></span>
<span id="cb31-5"><a href="advanced-r.html#cb31-5"></a><span class="kw">class</span>(today)</span>
<span id="cb31-6"><a href="advanced-r.html#cb31-6"></a><span class="co">## [1] &quot;Date&quot;</span></span>
<span id="cb31-7"><a href="advanced-r.html#cb31-7"></a><span class="co"># unclass the Date object to see the underlying double</span></span>
<span id="cb31-8"><a href="advanced-r.html#cb31-8"></a><span class="kw">unclass</span>(today)</span>
<span id="cb31-9"><a href="advanced-r.html#cb31-9"></a><span class="co">## [1] 18399</span></span></code></pre></div>
</div>
<div id="date-times" class="section level5" number="1.1.2.3.3">
<h5 number="1.1.2.3.3"><span class="header-section-number">1.1.2.3.3</span> Date-times</h5>
<p>S3 Date-times come in two flavors: POSIX<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>ct <em>(calendar time)</em> &amp; POSIXlt <em>(local time)</em>. POSIXct is build on type <code>double</code> whereas POSIXlt is type <code>list</code>,
which we’ll discuss later.</p>
<p>POSIXct represents the number of seconds since the UNIX Epoch, 01-JAN-1970, and
has the attributes <code>class</code> &amp; <code>tzone</code>. Pass the <code>tz</code> argument a <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">tz database</a> time zone
to change attribute <code>tzone</code> from the default local time. This does not change the underlying
<code>double</code>, only how it prints.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="advanced-r.html#cb32-1"></a>ct &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="dt">x =</span> <span class="st">&quot;2020-04-28 05:00:00&quot;</span>, <span class="dt">tz=</span><span class="st">&#39;UTC&#39;</span>)</span>
<span id="cb32-2"><a href="advanced-r.html#cb32-2"></a><span class="co"># the calendar time object</span></span>
<span id="cb32-3"><a href="advanced-r.html#cb32-3"></a>ct</span>
<span id="cb32-4"><a href="advanced-r.html#cb32-4"></a><span class="co">## [1] &quot;2020-04-28 05:00:00 UTC&quot;</span></span>
<span id="cb32-5"><a href="advanced-r.html#cb32-5"></a></span>
<span id="cb32-6"><a href="advanced-r.html#cb32-6"></a><span class="co"># built on doubles</span></span>
<span id="cb32-7"><a href="advanced-r.html#cb32-7"></a><span class="kw">typeof</span>(ct)</span>
<span id="cb32-8"><a href="advanced-r.html#cb32-8"></a><span class="co">## [1] &quot;double&quot;</span></span>
<span id="cb32-9"><a href="advanced-r.html#cb32-9"></a><span class="co"># has attributes class and tzone</span></span>
<span id="cb32-10"><a href="advanced-r.html#cb32-10"></a><span class="kw">attributes</span>(ct)</span>
<span id="cb32-11"><a href="advanced-r.html#cb32-11"></a><span class="co">## $class</span></span>
<span id="cb32-12"><a href="advanced-r.html#cb32-12"></a><span class="co">## [1] &quot;POSIXct&quot; &quot;POSIXt&quot; </span></span>
<span id="cb32-13"><a href="advanced-r.html#cb32-13"></a><span class="co">## </span></span>
<span id="cb32-14"><a href="advanced-r.html#cb32-14"></a><span class="co">## $tzone</span></span>
<span id="cb32-15"><a href="advanced-r.html#cb32-15"></a><span class="co">## [1] &quot;UTC&quot;</span></span>
<span id="cb32-16"><a href="advanced-r.html#cb32-16"></a></span>
<span id="cb32-17"><a href="advanced-r.html#cb32-17"></a><span class="co"># change tzone attribute to EDT, CDT, JST; notice midnight does not print a time</span></span>
<span id="cb32-18"><a href="advanced-r.html#cb32-18"></a><span class="kw">attr</span>(ct, <span class="dt">which =</span> <span class="st">&#39;tzone&#39;</span>) &lt;-<span class="st"> &#39;America/New_York&#39;</span>; ct;</span>
<span id="cb32-19"><a href="advanced-r.html#cb32-19"></a><span class="co">## [1] &quot;2020-04-28 01:00:00 EDT&quot;</span></span>
<span id="cb32-20"><a href="advanced-r.html#cb32-20"></a><span class="kw">attr</span>(ct, <span class="dt">which =</span> <span class="st">&#39;tzone&#39;</span>) &lt;-<span class="st"> &#39;America/Chicago&#39;</span>; ct</span>
<span id="cb32-21"><a href="advanced-r.html#cb32-21"></a><span class="co">## [1] &quot;2020-04-28 CDT&quot;</span></span>
<span id="cb32-22"><a href="advanced-r.html#cb32-22"></a><span class="kw">attr</span>(ct, <span class="dt">which =</span> <span class="st">&#39;tzone&#39;</span>) &lt;-<span class="st"> &#39;Asia/Tokyo&#39;</span>; ct</span>
<span id="cb32-23"><a href="advanced-r.html#cb32-23"></a><span class="co">## [1] &quot;2020-04-28 14:00:00 JST&quot;</span></span>
<span id="cb32-24"><a href="advanced-r.html#cb32-24"></a></span>
<span id="cb32-25"><a href="advanced-r.html#cb32-25"></a><span class="co"># the underlying double type atomic vector</span></span>
<span id="cb32-26"><a href="advanced-r.html#cb32-26"></a><span class="kw">unclass</span>(ct)[<span class="dv">1</span>]</span>
<span id="cb32-27"><a href="advanced-r.html#cb32-27"></a><span class="co">## [1] 1588050000</span></span></code></pre></div>
</div>
<div id="difftimes" class="section level5" number="1.1.2.3.4">
<h5 number="1.1.2.3.4"><span class="header-section-number">1.1.2.3.4</span> Difftimes</h5>
<p>Difftimes are <code>doubles</code> which represent a duration of time (interpreted by attribute <code>units</code>) between
two dates/datetimes. <code>units</code> includes “secs”, “mins”, “hours”, “days”, and “weeks” and are <em>not</em>
sensitive to daylight savings time.</p>
<p>Limited math methods and arithmetic is available for difftime. See <code>?difftime</code>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="advanced-r.html#cb33-1"></a><span class="co"># create difftime directly</span></span>
<span id="cb33-2"><a href="advanced-r.html#cb33-2"></a>day &lt;-<span class="st"> </span><span class="kw">as.difftime</span>(<span class="dv">1</span>, <span class="dt">units =</span> <span class="st">&#39;days&#39;</span>)</span>
<span id="cb33-3"><a href="advanced-r.html#cb33-3"></a>day</span>
<span id="cb33-4"><a href="advanced-r.html#cb33-4"></a><span class="co">## Time difference of 1 days</span></span>
<span id="cb33-5"><a href="advanced-r.html#cb33-5"></a><span class="co"># create difftime by arithmetic</span></span>
<span id="cb33-6"><a href="advanced-r.html#cb33-6"></a>day_alt &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2020-04-28&quot;</span>) <span class="op">-</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2020-04-27&quot;</span>)</span>
<span id="cb33-7"><a href="advanced-r.html#cb33-7"></a>day_alt</span>
<span id="cb33-8"><a href="advanced-r.html#cb33-8"></a><span class="co">## Time difference of 1 days</span></span>
<span id="cb33-9"><a href="advanced-r.html#cb33-9"></a></span>
<span id="cb33-10"><a href="advanced-r.html#cb33-10"></a><span class="kw">typeof</span>(day)</span>
<span id="cb33-11"><a href="advanced-r.html#cb33-11"></a><span class="co">## [1] &quot;double&quot;</span></span>
<span id="cb33-12"><a href="advanced-r.html#cb33-12"></a><span class="kw">class</span>(day)</span>
<span id="cb33-13"><a href="advanced-r.html#cb33-13"></a><span class="co">## [1] &quot;difftime&quot;</span></span>
<span id="cb33-14"><a href="advanced-r.html#cb33-14"></a><span class="kw">attributes</span>(day)</span>
<span id="cb33-15"><a href="advanced-r.html#cb33-15"></a><span class="co">## $class</span></span>
<span id="cb33-16"><a href="advanced-r.html#cb33-16"></a><span class="co">## [1] &quot;difftime&quot;</span></span>
<span id="cb33-17"><a href="advanced-r.html#cb33-17"></a><span class="co">## </span></span>
<span id="cb33-18"><a href="advanced-r.html#cb33-18"></a><span class="co">## $units</span></span>
<span id="cb33-19"><a href="advanced-r.html#cb33-19"></a><span class="co">## [1] &quot;days&quot;</span></span>
<span id="cb33-20"><a href="advanced-r.html#cb33-20"></a><span class="co"># retrive/set units directly using units()</span></span>
<span id="cb33-21"><a href="advanced-r.html#cb33-21"></a><span class="kw">units</span>(day) &lt;-<span class="st"> &#39;hours&#39;</span></span>
<span id="cb33-22"><a href="advanced-r.html#cb33-22"></a><span class="co"># day is now a 24 hour timediff</span></span>
<span id="cb33-23"><a href="advanced-r.html#cb33-23"></a>day</span>
<span id="cb33-24"><a href="advanced-r.html#cb33-24"></a><span class="co">## Time difference of 24 hours</span></span>
<span id="cb33-25"><a href="advanced-r.html#cb33-25"></a></span>
<span id="cb33-26"><a href="advanced-r.html#cb33-26"></a><span class="co"># add difftime to Date to return Date</span></span>
<span id="cb33-27"><a href="advanced-r.html#cb33-27"></a><span class="kw">as.Date</span>(<span class="st">&quot;2020-04-28&quot;</span>) <span class="op">+</span><span class="st"> </span>(<span class="dv">2</span><span class="op">*</span>day)</span>
<span id="cb33-28"><a href="advanced-r.html#cb33-28"></a><span class="co">## [1] &quot;2020-04-30&quot;</span></span>
<span id="cb33-29"><a href="advanced-r.html#cb33-29"></a></span>
<span id="cb33-30"><a href="advanced-r.html#cb33-30"></a><span class="co"># add difftime to difftime to return difftime</span></span>
<span id="cb33-31"><a href="advanced-r.html#cb33-31"></a><span class="kw">as.difftime</span>(.<span class="dv">5</span>, <span class="dt">units=</span><span class="st">&#39;mins&#39;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&#39;2020-03-02 00:00:00&#39;</span>)</span>
<span id="cb33-32"><a href="advanced-r.html#cb33-32"></a><span class="co">## [1] &quot;2020-03-02 00:00:30 CST&quot;</span></span>
<span id="cb33-33"><a href="advanced-r.html#cb33-33"></a></span>
<span id="cb33-34"><a href="advanced-r.html#cb33-34"></a><span class="co"># transform difftime by numeric to return difftime</span></span>
<span id="cb33-35"><a href="advanced-r.html#cb33-35"></a>day<span class="op">/</span><span class="dv">2</span></span>
<span id="cb33-36"><a href="advanced-r.html#cb33-36"></a><span class="co">## Time difference of 12 hours</span></span>
<span id="cb33-37"><a href="advanced-r.html#cb33-37"></a></span>
<span id="cb33-38"><a href="advanced-r.html#cb33-38"></a><span class="co"># transform difftime by difftime to return difftime</span></span>
<span id="cb33-39"><a href="advanced-r.html#cb33-39"></a>day<span class="op">+</span>day</span>
<span id="cb33-40"><a href="advanced-r.html#cb33-40"></a><span class="co">## Time difference of 48 hours</span></span>
<span id="cb33-41"><a href="advanced-r.html#cb33-41"></a></span>
<span id="cb33-42"><a href="advanced-r.html#cb33-42"></a><span class="co"># math methods are to describe difftime vectors</span></span>
<span id="cb33-43"><a href="advanced-r.html#cb33-43"></a><span class="kw">mean</span>(<span class="kw">c</span>(<span class="kw">as.Date</span>(<span class="st">&quot;2020-04-28&quot;</span>) <span class="op">-</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2020-04-27&quot;</span>), </span>
<span id="cb33-44"><a href="advanced-r.html#cb33-44"></a>       <span class="kw">as.Date</span>(<span class="st">&quot;2020-04-28&quot;</span>) <span class="op">-</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2020-04-26&quot;</span>)))</span>
<span id="cb33-45"><a href="advanced-r.html#cb33-45"></a><span class="co">## Time difference of 1.5 days</span></span>
<span id="cb33-46"><a href="advanced-r.html#cb33-46"></a></span>
<span id="cb33-47"><a href="advanced-r.html#cb33-47"></a><span class="co"># round difftime etc.</span></span>
<span id="cb33-48"><a href="advanced-r.html#cb33-48"></a><span class="kw">round</span>(day, <span class="dv">-1</span>)</span>
<span id="cb33-49"><a href="advanced-r.html#cb33-49"></a><span class="co">## Time difference of 20 hours</span></span>
<span id="cb33-50"><a href="advanced-r.html#cb33-50"></a></span>
<span id="cb33-51"><a href="advanced-r.html#cb33-51"></a><span class="co"># the underlying double</span></span>
<span id="cb33-52"><a href="advanced-r.html#cb33-52"></a><span class="kw">unclass</span>(day)[<span class="dv">1</span>]</span>
<span id="cb33-53"><a href="advanced-r.html#cb33-53"></a><span class="co">## [1] 24</span></span></code></pre></div>
</div>
</div>
<div id="lists" class="section level4" number="1.1.2.4">
<h4 number="1.1.2.4"><span class="header-section-number">1.1.2.4</span> Lists</h4>
<p><a href="advanced-r.html#arlobjects">Earlier</a> we learned lists are just vectors of references to objects of any
type. They have only attribute <code>class</code> “list”.</p>
<p>Lists are created with <code>list()</code>. Notice they can contain references to other list, and so
are called <em>recursive</em> vectors:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="advanced-r.html#cb34-1"></a>l &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>,</span>
<span id="cb34-2"><a href="advanced-r.html#cb34-2"></a>          letters[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>], </span>
<span id="cb34-3"><a href="advanced-r.html#cb34-3"></a>          <span class="kw">c</span>(T,T,F,F), </span>
<span id="cb34-4"><a href="advanced-r.html#cb34-4"></a>          <span class="kw">list</span>(<span class="dv">1</span>))</span>
<span id="cb34-5"><a href="advanced-r.html#cb34-5"></a></span>
<span id="cb34-6"><a href="advanced-r.html#cb34-6"></a><span class="kw">str</span>(l)</span>
<span id="cb34-7"><a href="advanced-r.html#cb34-7"></a><span class="co">## List of 4</span></span>
<span id="cb34-8"><a href="advanced-r.html#cb34-8"></a><span class="co">##  $ : num 1</span></span>
<span id="cb34-9"><a href="advanced-r.html#cb34-9"></a><span class="co">##  $ : chr [1:10] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; ...</span></span>
<span id="cb34-10"><a href="advanced-r.html#cb34-10"></a><span class="co">##  $ : logi [1:4] TRUE TRUE FALSE FALSE</span></span>
<span id="cb34-11"><a href="advanced-r.html#cb34-11"></a><span class="co">##  $ :List of 1</span></span>
<span id="cb34-12"><a href="advanced-r.html#cb34-12"></a><span class="co">##   ..$ : num 1</span></span></code></pre></div>
<p><code>c()</code> will convert vectors into lists before combining them:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="advanced-r.html#cb35-1"></a><span class="kw">c</span>(<span class="kw">list</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]), <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</span>
<span id="cb35-2"><a href="advanced-r.html#cb35-2"></a><span class="co">## List of 4</span></span>
<span id="cb35-3"><a href="advanced-r.html#cb35-3"></a><span class="co">##  $ : chr [1:3] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></span>
<span id="cb35-4"><a href="advanced-r.html#cb35-4"></a><span class="co">##  $ : int 1</span></span>
<span id="cb35-5"><a href="advanced-r.html#cb35-5"></a><span class="co">##  $ : int 2</span></span>
<span id="cb35-6"><a href="advanced-r.html#cb35-6"></a><span class="co">##  $ : int 3</span></span></code></pre></div>
<div id="testing-and-coercing-lists" class="section level5" number="1.1.2.4.1">
<h5 number="1.1.2.4.1"><span class="header-section-number">1.1.2.4.1</span> Testing and coercing lists</h5>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="advanced-r.html#cb36-1"></a><span class="co"># test for list type</span></span>
<span id="cb36-2"><a href="advanced-r.html#cb36-2"></a><span class="kw">is.list</span>(l)</span>
<span id="cb36-3"><a href="advanced-r.html#cb36-3"></a><span class="co">## [1] TRUE</span></span>
<span id="cb36-4"><a href="advanced-r.html#cb36-4"></a><span class="kw">typeof</span>(l)</span>
<span id="cb36-5"><a href="advanced-r.html#cb36-5"></a><span class="co">## [1] &quot;list&quot;</span></span>
<span id="cb36-6"><a href="advanced-r.html#cb36-6"></a></span>
<span id="cb36-7"><a href="advanced-r.html#cb36-7"></a><span class="co"># already seen list(), but as.list() exists as well</span></span>
<span id="cb36-8"><a href="advanced-r.html#cb36-8"></a><span class="kw">as.list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</span>
<span id="cb36-9"><a href="advanced-r.html#cb36-9"></a><span class="co">## [[1]]</span></span>
<span id="cb36-10"><a href="advanced-r.html#cb36-10"></a><span class="co">## [1] 1</span></span>
<span id="cb36-11"><a href="advanced-r.html#cb36-11"></a><span class="co">## </span></span>
<span id="cb36-12"><a href="advanced-r.html#cb36-12"></a><span class="co">## [[2]]</span></span>
<span id="cb36-13"><a href="advanced-r.html#cb36-13"></a><span class="co">## [1] 2</span></span>
<span id="cb36-14"><a href="advanced-r.html#cb36-14"></a><span class="co">## </span></span>
<span id="cb36-15"><a href="advanced-r.html#cb36-15"></a><span class="co">## [[3]]</span></span>
<span id="cb36-16"><a href="advanced-r.html#cb36-16"></a><span class="co">## [1] 3</span></span>
<span id="cb36-17"><a href="advanced-r.html#cb36-17"></a><span class="co">## </span></span>
<span id="cb36-18"><a href="advanced-r.html#cb36-18"></a><span class="co">## [[4]]</span></span>
<span id="cb36-19"><a href="advanced-r.html#cb36-19"></a><span class="co">## [1] 4</span></span>
<span id="cb36-20"><a href="advanced-r.html#cb36-20"></a></span>
<span id="cb36-21"><a href="advanced-r.html#cb36-21"></a><span class="co"># to coerce list to vector</span></span>
<span id="cb36-22"><a href="advanced-r.html#cb36-22"></a><span class="kw">unlist</span>(l)</span>
<span id="cb36-23"><a href="advanced-r.html#cb36-23"></a><span class="co">##  [1] &quot;1&quot;     &quot;a&quot;     &quot;b&quot;     &quot;c&quot;     &quot;d&quot;     &quot;e&quot;     &quot;f&quot;     &quot;g&quot;    </span></span>
<span id="cb36-24"><a href="advanced-r.html#cb36-24"></a><span class="co">##  [9] &quot;h&quot;     &quot;i&quot;     &quot;j&quot;     &quot;TRUE&quot;  &quot;TRUE&quot;  &quot;FALSE&quot; &quot;FALSE&quot; &quot;1&quot;</span></span></code></pre></div>
</div>
</div>
<div id="data-frames-and-tibbles" class="section level4" number="1.1.2.5">
<h4 number="1.1.2.5"><span class="header-section-number">1.1.2.5</span> Data frames and tibbles</h4>
<p>Data frames are the most important data structure for data analysis in R. They are
built on top of lists with attributes <code>class</code> “data.frame”, “names” <em>(for columns)</em>,
and “row.names”; and, crucially, requires each element be a vector of equal length.</p>
<p>Tibbles are data frames that were later developed as part of the <a href="https://www.tidyverse.org/">Tidyverse</a>. They try and optimize the default
behavior of <code>class</code> data.frame in the following ways.</p>
<div id="creating-data.frame-or-tbl_df" class="section level5" number="1.1.2.5.1">
<h5 number="1.1.2.5.1"><span class="header-section-number">1.1.2.5.1</span> Creating data.frame or tbl_df</h5>
<p><code>data.frame()</code> creates a data frame object from … name = vector pairs:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="advanced-r.html#cb37-1"></a><span class="co"># create character vector and add names attribute &#39;Color&#39;</span></span>
<span id="cb37-2"><a href="advanced-r.html#cb37-2"></a>color &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&#39;red&#39;</span>,<span class="st">&#39;blue&#39;</span>,<span class="st">&#39;yellow&#39;</span>), <span class="dt">times =</span> <span class="dv">2</span>)</span>
<span id="cb37-3"><a href="advanced-r.html#cb37-3"></a><span class="kw">names</span>(color) &lt;-<span class="st"> &#39;Color&#39;</span></span>
<span id="cb37-4"><a href="advanced-r.html#cb37-4"></a></span>
<span id="cb37-5"><a href="advanced-r.html#cb37-5"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">sock_id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="co"># use name = vector pairs</span></span>
<span id="cb37-6"><a href="advanced-r.html#cb37-6"></a>                 color, <span class="co"># or vectors with attribute &quot;names&quot;</span></span>
<span id="cb37-7"><a href="advanced-r.html#cb37-7"></a>                 <span class="dv">6</span><span class="op">:</span><span class="dv">1</span>, <span class="co"># or let R use defaults</span></span>
<span id="cb37-8"><a href="advanced-r.html#cb37-8"></a>                 <span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span> <span class="co"># but non-syntactic names will be renamed without warning</span></span>
<span id="cb37-9"><a href="advanced-r.html#cb37-9"></a>                 ) </span>
<span id="cb37-10"><a href="advanced-r.html#cb37-10"></a></span>
<span id="cb37-11"><a href="advanced-r.html#cb37-11"></a><span class="kw">typeof</span>(df)</span>
<span id="cb37-12"><a href="advanced-r.html#cb37-12"></a><span class="co">## [1] &quot;list&quot;</span></span>
<span id="cb37-13"><a href="advanced-r.html#cb37-13"></a><span class="kw">str</span>(df)</span>
<span id="cb37-14"><a href="advanced-r.html#cb37-14"></a><span class="co">## &#39;data.frame&#39;:    6 obs. of  4 variables:</span></span>
<span id="cb37-15"><a href="advanced-r.html#cb37-15"></a><span class="co">##  $ sock_id: int  1 2 3 4 5 6</span></span>
<span id="cb37-16"><a href="advanced-r.html#cb37-16"></a><span class="co">##  $ color  : Factor w/ 3 levels &quot;blue&quot;,&quot;red&quot;,&quot;yellow&quot;: 2 1 3 2 1 3</span></span>
<span id="cb37-17"><a href="advanced-r.html#cb37-17"></a><span class="co">##  $ X6.1   : int  6 5 4 3 2 1</span></span>
<span id="cb37-18"><a href="advanced-r.html#cb37-18"></a><span class="co">##  $ X1     : num  1 1 1 1 1 1</span></span></code></pre></div>
<p>Notice data.frame automatically creates factors from <code>character</code> vectors. Inhibit
with <code>stringsAsFactors</code> arguement:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="advanced-r.html#cb38-1"></a><span class="kw">data.frame</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>],</span>
<span id="cb38-2"><a href="advanced-r.html#cb38-2"></a>           <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</span>
<span id="cb38-3"><a href="advanced-r.html#cb38-3"></a><span class="co">## &#39;data.frame&#39;:    3 obs. of  1 variable:</span></span>
<span id="cb38-4"><a href="advanced-r.html#cb38-4"></a><span class="co">##  $ letters.1.3.: chr  &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></span></code></pre></div>
<p>Like lists and matrices, data frames and tibbles have row and column names and dimensional length:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="advanced-r.html#cb39-1"></a><span class="co"># column names</span></span>
<span id="cb39-2"><a href="advanced-r.html#cb39-2"></a><span class="kw">names</span>(df); <span class="kw">colnames</span>(df)</span>
<span id="cb39-3"><a href="advanced-r.html#cb39-3"></a><span class="co">## [1] &quot;sock_id&quot; &quot;color&quot;   &quot;X6.1&quot;    &quot;X1&quot;</span></span>
<span id="cb39-4"><a href="advanced-r.html#cb39-4"></a><span class="co">## [1] &quot;sock_id&quot; &quot;color&quot;   &quot;X6.1&quot;    &quot;X1&quot;</span></span>
<span id="cb39-5"><a href="advanced-r.html#cb39-5"></a></span>
<span id="cb39-6"><a href="advanced-r.html#cb39-6"></a><span class="co"># column length</span></span>
<span id="cb39-7"><a href="advanced-r.html#cb39-7"></a><span class="kw">length</span>(df); <span class="kw">ncol</span>(df)</span>
<span id="cb39-8"><a href="advanced-r.html#cb39-8"></a><span class="co">## [1] 4</span></span>
<span id="cb39-9"><a href="advanced-r.html#cb39-9"></a><span class="co">## [1] 4</span></span>
<span id="cb39-10"><a href="advanced-r.html#cb39-10"></a></span>
<span id="cb39-11"><a href="advanced-r.html#cb39-11"></a><span class="co"># row names</span></span>
<span id="cb39-12"><a href="advanced-r.html#cb39-12"></a><span class="kw">rownames</span>(df)</span>
<span id="cb39-13"><a href="advanced-r.html#cb39-13"></a><span class="co">## [1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; &quot;6&quot;</span></span>
<span id="cb39-14"><a href="advanced-r.html#cb39-14"></a></span>
<span id="cb39-15"><a href="advanced-r.html#cb39-15"></a><span class="co"># row length</span></span>
<span id="cb39-16"><a href="advanced-r.html#cb39-16"></a><span class="kw">nrow</span>(df)</span>
<span id="cb39-17"><a href="advanced-r.html#cb39-17"></a><span class="co">## [1] 6</span></span>
<span id="cb39-18"><a href="advanced-r.html#cb39-18"></a></span>
<span id="cb39-19"><a href="advanced-r.html#cb39-19"></a><span class="co"># row and column dimensions</span></span>
<span id="cb39-20"><a href="advanced-r.html#cb39-20"></a><span class="kw">dim</span>(df)</span>
<span id="cb39-21"><a href="advanced-r.html#cb39-21"></a><span class="co">## [1] 6 4</span></span></code></pre></div>
<p>Tibbles have <code>class</code> “tbl_df” (as well as data.frame) which modifies their behavior. They
are created similarly to data frames:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="advanced-r.html#cb40-1"></a><span class="kw">library</span>(tibble)</span>
<span id="cb40-2"><a href="advanced-r.html#cb40-2"></a></span>
<span id="cb40-3"><a href="advanced-r.html#cb40-3"></a>tbl &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">sock_id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="co"># use name = vector pairs</span></span>
<span id="cb40-4"><a href="advanced-r.html#cb40-4"></a>                 color, <span class="co"># or vectors with attribute &quot;names&quot;</span></span>
<span id="cb40-5"><a href="advanced-r.html#cb40-5"></a>                 <span class="dv">6</span><span class="op">:</span><span class="dv">1</span>, <span class="co"># or let R use defaults</span></span>
<span id="cb40-6"><a href="advanced-r.html#cb40-6"></a>                 <span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span>, <span class="co"># allows non-syntactic names</span></span>
<span id="cb40-7"><a href="advanced-r.html#cb40-7"></a>                 <span class="st">`</span><span class="dt">1*2</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">1</span><span class="st">`</span> <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="co"># allows reference to new variables</span></span>
<span id="cb40-8"><a href="advanced-r.html#cb40-8"></a>              )</span>
<span id="cb40-9"><a href="advanced-r.html#cb40-9"></a></span>
<span id="cb40-10"><a href="advanced-r.html#cb40-10"></a><span class="kw">typeof</span>(tbl)</span>
<span id="cb40-11"><a href="advanced-r.html#cb40-11"></a><span class="co">## [1] &quot;list&quot;</span></span>
<span id="cb40-12"><a href="advanced-r.html#cb40-12"></a><span class="kw">str</span>(tbl)</span>
<span id="cb40-13"><a href="advanced-r.html#cb40-13"></a><span class="co">## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    6 obs. of  5 variables:</span></span>
<span id="cb40-14"><a href="advanced-r.html#cb40-14"></a><span class="co">##  $ sock_id: int  1 2 3 4 5 6</span></span>
<span id="cb40-15"><a href="advanced-r.html#cb40-15"></a><span class="co">##  $ color  : chr  &quot;red&quot; &quot;blue&quot; &quot;yellow&quot; &quot;red&quot; ...</span></span>
<span id="cb40-16"><a href="advanced-r.html#cb40-16"></a><span class="co">##  $ 6:1    : int  6 5 4 3 2 1</span></span>
<span id="cb40-17"><a href="advanced-r.html#cb40-17"></a><span class="co">##  $ 1      : num  1 1 1 1 1 1</span></span>
<span id="cb40-18"><a href="advanced-r.html#cb40-18"></a><span class="co">##  $ 1*2    : num  2 2 2 2 2 2</span></span></code></pre></div>
<p>Tibbles can use the same methods as data tables, for example names and dimensional length:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="advanced-r.html#cb41-1"></a><span class="kw">colnames</span>(tbl); <span class="kw">ncol</span>(tbl)</span>
<span id="cb41-2"><a href="advanced-r.html#cb41-2"></a><span class="co">## [1] &quot;sock_id&quot; &quot;color&quot;   &quot;6:1&quot;     &quot;1&quot;       &quot;1*2&quot;</span></span>
<span id="cb41-3"><a href="advanced-r.html#cb41-3"></a><span class="co">## [1] 5</span></span>
<span id="cb41-4"><a href="advanced-r.html#cb41-4"></a><span class="kw">rownames</span>(tbl); <span class="kw">nrow</span>(tbl)</span>
<span id="cb41-5"><a href="advanced-r.html#cb41-5"></a><span class="co">## [1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; &quot;6&quot;</span></span>
<span id="cb41-6"><a href="advanced-r.html#cb41-6"></a><span class="co">## [1] 6</span></span></code></pre></div>
<p>Notice <code>tibble()</code> did not coerce factors by default, allowed non-syntactic names
(enclosed in ````), and let you reference new columns as they are created.</p>
<p>Both data frames and tibbles require equal length vector columns and will recycle
values if the vector length is smaller than the max column length; however, data
frames will recyle any vector that is an integer multiple of the longest column, while
tibbles will only recyle scalar values.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="advanced-r.html#cb42-1"></a></span>
<span id="cb42-2"><a href="advanced-r.html#cb42-2"></a><span class="kw">data.frame</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="co"># the longest column vector of length 4</span></span>
<span id="cb42-3"><a href="advanced-r.html#cb42-3"></a>           <span class="dv">1</span>, <span class="co"># a scalar recyled 4 times</span></span>
<span id="cb42-4"><a href="advanced-r.html#cb42-4"></a>           <span class="dv">1</span><span class="op">:</span><span class="dv">2</span> <span class="co"># a length 2 vector recyled 2 times</span></span>
<span id="cb42-5"><a href="advanced-r.html#cb42-5"></a>           )</span>
<span id="cb42-6"><a href="advanced-r.html#cb42-6"></a><span class="co">##   X1.4 X1 X1.2</span></span>
<span id="cb42-7"><a href="advanced-r.html#cb42-7"></a><span class="co">## 1    1  1    1</span></span>
<span id="cb42-8"><a href="advanced-r.html#cb42-8"></a><span class="co">## 2    2  1    2</span></span>
<span id="cb42-9"><a href="advanced-r.html#cb42-9"></a><span class="co">## 3    3  1    1</span></span>
<span id="cb42-10"><a href="advanced-r.html#cb42-10"></a><span class="co">## 4    4  1    2</span></span>
<span id="cb42-11"><a href="advanced-r.html#cb42-11"></a></span>
<span id="cb42-12"><a href="advanced-r.html#cb42-12"></a><span class="kw">tibble</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="co"># the longest column vector of length 4</span></span>
<span id="cb42-13"><a href="advanced-r.html#cb42-13"></a>           <span class="dv">1</span>, <span class="co"># a scalar recyled 4 times</span></span>
<span id="cb42-14"><a href="advanced-r.html#cb42-14"></a>           <span class="dv">1</span><span class="op">:</span><span class="dv">2</span> <span class="co"># a length 2 vector recyled 2 times</span></span>
<span id="cb42-15"><a href="advanced-r.html#cb42-15"></a>           )</span>
<span id="cb42-16"><a href="advanced-r.html#cb42-16"></a><span class="co">## Error: Tibble columns must have consistent lengths, only values of length one are recycled:</span></span>
<span id="cb42-17"><a href="advanced-r.html#cb42-17"></a><span class="co">## * Length 2: Column `1:2`</span></span>
<span id="cb42-18"><a href="advanced-r.html#cb42-18"></a><span class="co">## * Length 4: Column `1:4`</span></span></code></pre></div>
</div>
<div id="row-names" class="section level5" number="1.1.2.5.2">
<h5 number="1.1.2.5.2"><span class="header-section-number">1.1.2.5.2</span> Row Names</h5>
<p>Row names, a unique vector of <code>character</code>, can be assigned to Data frames. This idea
probably arose due to data frame’s close association to <code>numerical</code> matrices, where
storing <code>character</code> data along with the matrix is useful. Get and set row names with <code>rownames()</code>, or argument <code>row.names</code> on creation:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="advanced-r.html#cb43-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">idx =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,</span>
<span id="cb43-2"><a href="advanced-r.html#cb43-2"></a>                 <span class="dt">row.names =</span> <span class="kw">c</span>(<span class="st">&#39;Spider Man&#39;</span>,<span class="st">&#39;Batman&#39;</span>,<span class="st">&#39;Red Robin&#39;</span>))</span>
<span id="cb43-3"><a href="advanced-r.html#cb43-3"></a>df</span>
<span id="cb43-4"><a href="advanced-r.html#cb43-4"></a><span class="co">##            idx</span></span>
<span id="cb43-5"><a href="advanced-r.html#cb43-5"></a><span class="co">## Spider Man   1</span></span>
<span id="cb43-6"><a href="advanced-r.html#cb43-6"></a><span class="co">## Batman       2</span></span>
<span id="cb43-7"><a href="advanced-r.html#cb43-7"></a><span class="co">## Red Robin    3</span></span></code></pre></div>
<p>Row names can be used to subset data frames:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="advanced-r.html#cb44-1"></a>df[<span class="st">&quot;Batman&quot;</span>,]</span>
<span id="cb44-2"><a href="advanced-r.html#cb44-2"></a><span class="co">## [1] 2</span></span></code></pre></div>
<p>Tibbles do not store row names for reasons you can read <a href="https://adv-r.hadley.nz/vectors-chap.html#rownames">here</a>. Rather, they treat
rownames as another feature of the data. The <code>rownames</code> argument in <code>as_tibble()</code>
or <code>rownames_to_column()</code> can transform row names to a column vector.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="advanced-r.html#cb45-1"></a><span class="kw">as_tibble</span>(df,</span>
<span id="cb45-2"><a href="advanced-r.html#cb45-2"></a>          <span class="dt">rownames =</span> <span class="st">&quot;Super Hero&quot;</span>)</span>
<span id="cb45-3"><a href="advanced-r.html#cb45-3"></a><span class="co">## # A tibble: 3 x 2</span></span>
<span id="cb45-4"><a href="advanced-r.html#cb45-4"></a><span class="co">##   `Super Hero`   idx</span></span>
<span id="cb45-5"><a href="advanced-r.html#cb45-5"></a><span class="co">##   &lt;chr&gt;        &lt;int&gt;</span></span>
<span id="cb45-6"><a href="advanced-r.html#cb45-6"></a><span class="co">## 1 Spider Man       1</span></span>
<span id="cb45-7"><a href="advanced-r.html#cb45-7"></a><span class="co">## 2 Batman           2</span></span>
<span id="cb45-8"><a href="advanced-r.html#cb45-8"></a><span class="co">## 3 Red Robin        3</span></span></code></pre></div>
</div>
<div id="subsetting" class="section level5" number="1.1.2.5.3">
<h5 number="1.1.2.5.3"><span class="header-section-number">1.1.2.5.3</span> Subsetting</h5>
<p>Data frames can be subset either one dimensionaly, like a list, or two dimensionally,
like a matrix.</p>
<p>Data frame subsetting syntax can behave unexpectedly:</p>
<ol style="list-style-type: decimal">
<li><p><code>data.frame()[,vars]</code> will return a data frame unless vars selects only one column; it returns a vector.</p></li>
<li><p>selecting a single column with <code>data.frame$var</code> will return a column starting with <code>\$var</code> if <code>$var</code> doesn’t exist.</p></li>
</ol>
<p>Tibbles always return tibbles, and vectors can be returned when desired with <code>tibble[[var]]</code>. If
a column is not found it returns an error.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="advanced-r.html#cb46-1"></a><span class="co"># data frame will select columns starting with cotton when $cotton not found</span></span>
<span id="cb46-2"><a href="advanced-r.html#cb46-2"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">cotton_candy =</span> <span class="st">&#39;Yum&#39;</span>)</span>
<span id="cb46-3"><a href="advanced-r.html#cb46-3"></a>df<span class="op">$</span>cotton</span>
<span id="cb46-4"><a href="advanced-r.html#cb46-4"></a><span class="co">## [1] Yum</span></span>
<span id="cb46-5"><a href="advanced-r.html#cb46-5"></a><span class="co">## Levels: Yum</span></span>
<span id="cb46-6"><a href="advanced-r.html#cb46-6"></a></span>
<span id="cb46-7"><a href="advanced-r.html#cb46-7"></a><span class="co"># tibbles do not match columns starting with cotton</span></span>
<span id="cb46-8"><a href="advanced-r.html#cb46-8"></a><span class="kw">as_tibble</span>(df)<span class="op">$</span>cotton</span>
<span id="cb46-9"><a href="advanced-r.html#cb46-9"></a><span class="co">## Warning: Unknown or uninitialised column: &#39;cotton&#39;.</span></span>
<span id="cb46-10"><a href="advanced-r.html#cb46-10"></a><span class="co">## NULL</span></span></code></pre></div>
</div>
<div id="testing-and-coercion" class="section level5" number="1.1.2.5.4">
<h5 number="1.1.2.5.4"><span class="header-section-number">1.1.2.5.4</span> Testing and coercion</h5>
<table>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Testing</th>
<th align="left">Coercion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">data frame</td>
<td align="left"><code>is.data.frame()</code></td>
<td align="left"><code>as.data.frame()</code></td>
</tr>
<tr class="even">
<td align="left">tibble</td>
<td align="left"><code>is_tibble()</code></td>
<td align="left"><code>as_tibble()</code></td>
</tr>
</tbody>
</table>
<p>Note that <code>is.data.frame()</code> will return true for tibbles as well, since tibbles
are <code>class</code> data.frame.</p>
</div>
<div id="list-columns" class="section level5" number="1.1.2.5.5">
<h5 number="1.1.2.5.5"><span class="header-section-number">1.1.2.5.5</span> List Columns</h5>
<p>Because data frames are built on lists, they themsevles can contain lists. So it
is possible in R to have a data frame containing data frames, making it easy
to organize related datasets:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="advanced-r.html#cb47-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span>)</span>
<span id="cb47-2"><a href="advanced-r.html#cb47-2"></a>df<span class="op">$</span>nested &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">data.frame</span>(<span class="dt">cool =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>))</span>
<span id="cb47-3"><a href="advanced-r.html#cb47-3"></a></span>
<span id="cb47-4"><a href="advanced-r.html#cb47-4"></a><span class="kw">class</span>(df<span class="op">$</span>nested[[<span class="dv">1</span>]])</span>
<span id="cb47-5"><a href="advanced-r.html#cb47-5"></a><span class="co">## [1] &quot;data.frame&quot;</span></span>
<span id="cb47-6"><a href="advanced-r.html#cb47-6"></a>df<span class="op">$</span>nested[[<span class="dv">1</span>]]</span>
<span id="cb47-7"><a href="advanced-r.html#cb47-7"></a><span class="co">##   cool</span></span>
<span id="cb47-8"><a href="advanced-r.html#cb47-8"></a><span class="co">## 1    1</span></span>
<span id="cb47-9"><a href="advanced-r.html#cb47-9"></a><span class="co">## 2    2</span></span>
<span id="cb47-10"><a href="advanced-r.html#cb47-10"></a><span class="co">## 3    3</span></span></code></pre></div>
<p>To include lists on creation use <code>I()</code>, which inhibits interpetation/conversion of objects
by setting the <code>class</code> to “as is”:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="advanced-r.html#cb48-1"></a><span class="kw">data.frame</span>(<span class="dt">x=</span> <span class="dv">1</span>,</span>
<span id="cb48-2"><a href="advanced-r.html#cb48-2"></a>           <span class="kw">I</span>(<span class="kw">list</span>(<span class="kw">data.frame</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>))))</span>
<span id="cb48-3"><a href="advanced-r.html#cb48-3"></a><span class="co">##   x list.data.frame.1.3..</span></span>
<span id="cb48-4"><a href="advanced-r.html#cb48-4"></a><span class="co">## 1 1                   1:3</span></span></code></pre></div>
<p>Or use tibbles which can handle lists on creation without <code>I()</code>:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="advanced-r.html#cb49-1"></a><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span>,</span>
<span id="cb49-2"><a href="advanced-r.html#cb49-2"></a>       <span class="dt">dfs =</span> <span class="kw">list</span>(<span class="kw">tibble</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)))</span>
<span id="cb49-3"><a href="advanced-r.html#cb49-3"></a><span class="co">## # A tibble: 1 x 2</span></span>
<span id="cb49-4"><a href="advanced-r.html#cb49-4"></a><span class="co">##       x dfs             </span></span>
<span id="cb49-5"><a href="advanced-r.html#cb49-5"></a><span class="co">##   &lt;dbl&gt; &lt;list&gt;          </span></span>
<span id="cb49-6"><a href="advanced-r.html#cb49-6"></a><span class="co">## 1     1 &lt;tibble [3 x 1]&gt;</span></span></code></pre></div>
</div>
</div>
<div id="null" class="section level4" number="1.1.2.6">
<h4 number="1.1.2.6"><span class="header-section-number">1.1.2.6</span> NULL</h4>
<p><code>NULL</code> is a special type in R. It has no attributes and is always zero length. It
is primarily used for two things:</p>
<ol style="list-style-type: decimal">
<li>represent an empty vector</li>
</ol>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="advanced-r.html#cb50-1"></a><span class="kw">c</span>()</span>
<span id="cb50-2"><a href="advanced-r.html#cb50-2"></a><span class="co">## NULL</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>represent a missing vector (e.g. often default function arguments are <code>NULL</code>). This is different
than <code>NULL</code> in SQL, which is more like <code>NA</code>, because SQL <code>NULL</code> and R <code>NA</code> represent missing
<em>elements</em> of a vector, rather than the vector itself.</li>
</ol>
<p>Test for NULL with <code>is.null()</code>:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="advanced-r.html#cb51-1"></a><span class="kw">is.null</span>(<span class="ot">NULL</span>)</span>
<span id="cb51-2"><a href="advanced-r.html#cb51-2"></a><span class="co">## [1] TRUE</span></span></code></pre></div>

</div>
</div>
<div id="arsub" class="section level3" number="1.1.3">
<h3 number="1.1.3"><span class="header-section-number">1.1.3</span> Subsetting</h3>
<div id="selecting-multiple-elements" class="section level4" number="1.1.3.1">
<h4 number="1.1.3.1"><span class="header-section-number">1.1.3.1</span> Selecting multiple elements</h4>
<p>To select any number of elements from a vector use <code>[</code> <em>(see <code>?`[`</code> for help)</em>.</p>
<div id="atomic-vectors-1" class="section level5" number="1.1.3.1.1">
<h5 number="1.1.3.1.1"><span class="header-section-number">1.1.3.1.1</span> Atomic Vectors</h5>
<p>Atomic vectors can be subset in six ways:</p>
<ol style="list-style-type: decimal">
<li><em>Positive integers</em> return elements at that position</li>
</ol>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="advanced-r.html#cb52-1"></a>x &lt;-<span class="st"> </span><span class="dv">11</span><span class="op">:</span><span class="dv">20</span></span>
<span id="cb52-2"><a href="advanced-r.html#cb52-2"></a></span>
<span id="cb52-3"><a href="advanced-r.html#cb52-3"></a>x[<span class="dv">1</span>]</span>
<span id="cb52-4"><a href="advanced-r.html#cb52-4"></a><span class="co">## [1] 11</span></span>
<span id="cb52-5"><a href="advanced-r.html#cb52-5"></a>x[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</span>
<span id="cb52-6"><a href="advanced-r.html#cb52-6"></a><span class="co">## [1] 11 12 13</span></span>
<span id="cb52-7"><a href="advanced-r.html#cb52-7"></a></span>
<span id="cb52-8"><a href="advanced-r.html#cb52-8"></a><span class="co"># repeating element positions returns multiple elements</span></span>
<span id="cb52-9"><a href="advanced-r.html#cb52-9"></a>x[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">10</span>)]</span>
<span id="cb52-10"><a href="advanced-r.html#cb52-10"></a><span class="co">## [1] 11 11 20 20</span></span>
<span id="cb52-11"><a href="advanced-r.html#cb52-11"></a><span class="co"># real numbers are converted to integer</span></span>
<span id="cb52-12"><a href="advanced-r.html#cb52-12"></a>x[<span class="kw">c</span>(<span class="fl">1.1</span>,<span class="fl">2.2</span>,<span class="fl">3.3</span>)]</span>
<span id="cb52-13"><a href="advanced-r.html#cb52-13"></a><span class="co">## [1] 11 12 13</span></span>
<span id="cb52-14"><a href="advanced-r.html#cb52-14"></a></span>
<span id="cb52-15"><a href="advanced-r.html#cb52-15"></a><span class="co"># order() returns integers for elements of vector x arranged in ascending or decending order</span></span>
<span id="cb52-16"><a href="advanced-r.html#cb52-16"></a><span class="kw">order</span>(x, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)</span>
<span id="cb52-17"><a href="advanced-r.html#cb52-17"></a><span class="co">##  [1] 10  9  8  7  6  5  4  3  2  1</span></span>
<span id="cb52-18"><a href="advanced-r.html#cb52-18"></a><span class="co"># pass that integer vector into `[` to select the reordered elements of x</span></span>
<span id="cb52-19"><a href="advanced-r.html#cb52-19"></a>x[<span class="kw">order</span>(x, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)]</span>
<span id="cb52-20"><a href="advanced-r.html#cb52-20"></a><span class="co">##  [1] 20 19 18 17 16 15 14 13 12 11</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><em>Negative integers</em> exclude elements at that position</li>
</ol>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="advanced-r.html#cb53-1"></a>x[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>)]</span>
<span id="cb53-2"><a href="advanced-r.html#cb53-2"></a><span class="co">## [1] 12 14 16 18 20</span></span>
<span id="cb53-3"><a href="advanced-r.html#cb53-3"></a></span>
<span id="cb53-4"><a href="advanced-r.html#cb53-4"></a><span class="co"># you can&#39;t mix positive and negative integers</span></span>
<span id="cb53-5"><a href="advanced-r.html#cb53-5"></a>x[<span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="dv">2</span>)]</span>
<span id="cb53-6"><a href="advanced-r.html#cb53-6"></a><span class="co">## Error in x[c(1, -2)]: only 0&#39;s may be mixed with negative subscripts</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><em>Logical vectors</em> include or excluded elements based on values <code>TRUE</code>/<code>FALSE</code>. This allows
you to pass a logical test into <code>[</code>:</li>
</ol>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="advanced-r.html#cb54-1"></a><span class="co"># a logical test produces a logical vector</span></span>
<span id="cb54-2"><a href="advanced-r.html#cb54-2"></a>x <span class="op">&lt;</span><span class="st"> </span><span class="dv">15</span></span>
<span id="cb54-3"><a href="advanced-r.html#cb54-3"></a><span class="co">##  [1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE</span></span>
<span id="cb54-4"><a href="advanced-r.html#cb54-4"></a></span>
<span id="cb54-5"><a href="advanced-r.html#cb54-5"></a><span class="co"># this logical vector can subset elements based on TRUE/FALSE</span></span>
<span id="cb54-6"><a href="advanced-r.html#cb54-6"></a>x[x<span class="op">&lt;</span><span class="dv">15</span>]</span>
<span id="cb54-7"><a href="advanced-r.html#cb54-7"></a><span class="co">## [1] 11 12 13 14</span></span>
<span id="cb54-8"><a href="advanced-r.html#cb54-8"></a></span>
<span id="cb54-9"><a href="advanced-r.html#cb54-9"></a><span class="co"># recylcing rules apply if the vector is an integer multiple of length(x)</span></span>
<span id="cb54-10"><a href="advanced-r.html#cb54-10"></a>x[<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>)]</span>
<span id="cb54-11"><a href="advanced-r.html#cb54-11"></a><span class="co">## [1] 11 13 15 17 19</span></span>
<span id="cb54-12"><a href="advanced-r.html#cb54-12"></a></span>
<span id="cb54-13"><a href="advanced-r.html#cb54-13"></a><span class="co"># NA will always return NA in the results</span></span>
<span id="cb54-14"><a href="advanced-r.html#cb54-14"></a>x[<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">NA</span>)]</span>
<span id="cb54-15"><a href="advanced-r.html#cb54-15"></a><span class="co">##  [1] 11 NA 13 NA 15 NA 17 NA 19 NA</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li><em>Nothing</em> returns the vector as is. This is more useful for 2d structures and multi-dim arrays.</li>
</ol>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="advanced-r.html#cb55-1"></a>x[]</span>
<span id="cb55-2"><a href="advanced-r.html#cb55-2"></a><span class="co">##  [1] 11 12 13 14 15 16 17 18 19 20</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li><em>Zero</em> returns a zero-length vector.</li>
</ol>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="advanced-r.html#cb56-1"></a>x[<span class="dv">0</span>]</span>
<span id="cb56-2"><a href="advanced-r.html#cb56-2"></a><span class="co">## integer(0)</span></span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li><em>Character vectors</em> can be used to select vectors with attribute <code>names</code>. This does <strong>not</strong> work to factors and only
selects exact matches.</li>
</ol>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="advanced-r.html#cb57-1"></a>x &lt;-<span class="st"> </span><span class="kw">setNames</span>(x, <span class="kw">c</span>(letters[<span class="dv">11</span><span class="op">:</span><span class="dv">20</span>]))</span>
<span id="cb57-2"><a href="advanced-r.html#cb57-2"></a></span>
<span id="cb57-3"><a href="advanced-r.html#cb57-3"></a>x[<span class="kw">c</span>(<span class="st">&#39;m&#39;</span>,<span class="st">&#39;o&#39;</span>,<span class="st">&#39;o&#39;</span>,<span class="st">&#39;n&#39;</span>)]</span>
<span id="cb57-4"><a href="advanced-r.html#cb57-4"></a><span class="co">##  m  o  o  n </span></span>
<span id="cb57-5"><a href="advanced-r.html#cb57-5"></a><span class="co">## 13 15 15 14</span></span></code></pre></div>
</div>
<div id="lists-1" class="section level5" number="1.1.3.1.2">
<h5 number="1.1.3.1.2"><span class="header-section-number">1.1.3.1.2</span> Lists</h5>
<p>Use <code>[</code> to subset lists exactly as atomic vectors, only <code>[</code> will ever return a list. To
extract elements out of a list you need <code>[[</code> or <code>$</code> per below.</p>
</div>
<div id="matrices-and-arrays" class="section level5" number="1.1.3.1.3">
<h5 number="1.1.3.1.3"><span class="header-section-number">1.1.3.1.3</span> Matrices and arrays</h5>
<p>Subsetting 2d matrices and &gt;2d arrays with <code>[</code> can be done with:</p>
<ol style="list-style-type: decimal">
<li>multiple vectors <em>(delimited with <code>,</code>)</em></li>
</ol>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="advanced-r.html#cb58-1"></a>m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">data =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>, <span class="dt">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb58-2"><a href="advanced-r.html#cb58-2"></a>m</span>
<span id="cb58-3"><a href="advanced-r.html#cb58-3"></a><span class="co">##      [,1] [,2] [,3]</span></span>
<span id="cb58-4"><a href="advanced-r.html#cb58-4"></a><span class="co">## [1,]    1    4    7</span></span>
<span id="cb58-5"><a href="advanced-r.html#cb58-5"></a><span class="co">## [2,]    2    5    8</span></span>
<span id="cb58-6"><a href="advanced-r.html#cb58-6"></a><span class="co">## [3,]    3    6    9</span></span>
<span id="cb58-7"><a href="advanced-r.html#cb58-7"></a></span>
<span id="cb58-8"><a href="advanced-r.html#cb58-8"></a><span class="co"># pass a vector for each dimension, the first two rows and not the third column</span></span>
<span id="cb58-9"><a href="advanced-r.html#cb58-9"></a>m[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>),<span class="op">-</span><span class="dv">3</span>]</span>
<span id="cb58-10"><a href="advanced-r.html#cb58-10"></a><span class="co">##      [,1] [,2]</span></span>
<span id="cb58-11"><a href="advanced-r.html#cb58-11"></a><span class="co">## [1,]    1    4</span></span>
<span id="cb58-12"><a href="advanced-r.html#cb58-12"></a><span class="co">## [2,]    2    5</span></span>
<span id="cb58-13"><a href="advanced-r.html#cb58-13"></a></span>
<span id="cb58-14"><a href="advanced-r.html#cb58-14"></a><span class="co"># empty vectors are useful now to select all elements of a dimension</span></span>
<span id="cb58-15"><a href="advanced-r.html#cb58-15"></a><span class="co"># select all rows and not the third column</span></span>
<span id="cb58-16"><a href="advanced-r.html#cb58-16"></a>m[, <span class="dv">-3</span>]</span>
<span id="cb58-17"><a href="advanced-r.html#cb58-17"></a><span class="co">##      [,1] [,2]</span></span>
<span id="cb58-18"><a href="advanced-r.html#cb58-18"></a><span class="co">## [1,]    1    4</span></span>
<span id="cb58-19"><a href="advanced-r.html#cb58-19"></a><span class="co">## [2,]    2    5</span></span>
<span id="cb58-20"><a href="advanced-r.html#cb58-20"></a><span class="co">## [3,]    3    6</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>single vectors <em>(not delimited with <code>,</code>)</em></li>
</ol>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="advanced-r.html#cb59-1"></a><span class="co"># matrices and arrays are just vectors with class &quot;dim&quot;, so passing single vectors is valid</span></span>
<span id="cb59-2"><a href="advanced-r.html#cb59-2"></a>m[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</span>
<span id="cb59-3"><a href="advanced-r.html#cb59-3"></a><span class="co">## [1] 1 2 3</span></span>
<span id="cb59-4"><a href="advanced-r.html#cb59-4"></a></span>
<span id="cb59-5"><a href="advanced-r.html#cb59-5"></a>m[<span class="kw">c</span>(T,T,T,F,F,F,T,T,T)]</span>
<span id="cb59-6"><a href="advanced-r.html#cb59-6"></a><span class="co">## [1] 1 2 3 7 8 9</span></span></code></pre></div>
<p>R will simplify to the lowest dimensionality possible, so passing a vector returns a vector. Passing
two dimensions returns a matrix etc.</p>
<ol start="3" style="list-style-type: decimal">
<li>matrix</li>
</ol>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="advanced-r.html#cb60-1"></a><span class="co"># a matrix of (row, col) dimensions to select the diagonal in matrix m</span></span>
<span id="cb60-2"><a href="advanced-r.html#cb60-2"></a>m_select &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">data =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>), <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> T)</span>
<span id="cb60-3"><a href="advanced-r.html#cb60-3"></a>m_select</span>
<span id="cb60-4"><a href="advanced-r.html#cb60-4"></a><span class="co">##      [,1] [,2]</span></span>
<span id="cb60-5"><a href="advanced-r.html#cb60-5"></a><span class="co">## [1,]    1    1</span></span>
<span id="cb60-6"><a href="advanced-r.html#cb60-6"></a><span class="co">## [2,]    2    2</span></span>
<span id="cb60-7"><a href="advanced-r.html#cb60-7"></a><span class="co">## [3,]    3    3</span></span>
<span id="cb60-8"><a href="advanced-r.html#cb60-8"></a></span>
<span id="cb60-9"><a href="advanced-r.html#cb60-9"></a><span class="co"># matrix m </span></span>
<span id="cb60-10"><a href="advanced-r.html#cb60-10"></a>m</span>
<span id="cb60-11"><a href="advanced-r.html#cb60-11"></a><span class="co">##      [,1] [,2] [,3]</span></span>
<span id="cb60-12"><a href="advanced-r.html#cb60-12"></a><span class="co">## [1,]    1    4    7</span></span>
<span id="cb60-13"><a href="advanced-r.html#cb60-13"></a><span class="co">## [2,]    2    5    8</span></span>
<span id="cb60-14"><a href="advanced-r.html#cb60-14"></a><span class="co">## [3,]    3    6    9</span></span>
<span id="cb60-15"><a href="advanced-r.html#cb60-15"></a><span class="co"># pass the matrix to subset the diagonal of m </span></span>
<span id="cb60-16"><a href="advanced-r.html#cb60-16"></a>m[m_select]</span>
<span id="cb60-17"><a href="advanced-r.html#cb60-17"></a><span class="co">## [1] 1 5 9</span></span></code></pre></div>
</div>
<div id="data-frames-and-tibbles-1" class="section level5" number="1.1.3.1.4">
<h5 number="1.1.3.1.4"><span class="header-section-number">1.1.3.1.4</span> Data frames and tibbles</h5>
<p>Data frames can be subset with <code>[</code> also, but they behave like lists when passing
a vector, and like a matrix when passing multiple vectors with <code>,</code>.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="advanced-r.html#cb61-1"></a><span class="co"># a data frame</span></span>
<span id="cb61-2"><a href="advanced-r.html#cb61-2"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">y =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], <span class="dt">z =</span> LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>],</span>
<span id="cb61-3"><a href="advanced-r.html#cb61-3"></a>                 <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb61-4"><a href="advanced-r.html#cb61-4"></a>df</span>
<span id="cb61-5"><a href="advanced-r.html#cb61-5"></a><span class="co">##   x y z</span></span>
<span id="cb61-6"><a href="advanced-r.html#cb61-6"></a><span class="co">## 1 1 a A</span></span>
<span id="cb61-7"><a href="advanced-r.html#cb61-7"></a><span class="co">## 2 2 b B</span></span>
<span id="cb61-8"><a href="advanced-r.html#cb61-8"></a><span class="co">## 3 3 c C</span></span>
<span id="cb61-9"><a href="advanced-r.html#cb61-9"></a><span class="co">## 4 4 d D</span></span>
<span id="cb61-10"><a href="advanced-r.html#cb61-10"></a><span class="co">## 5 5 e E</span></span>
<span id="cb61-11"><a href="advanced-r.html#cb61-11"></a></span>
<span id="cb61-12"><a href="advanced-r.html#cb61-12"></a><span class="co"># passing a vector returns whole columns</span></span>
<span id="cb61-13"><a href="advanced-r.html#cb61-13"></a>df[<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>)]</span>
<span id="cb61-14"><a href="advanced-r.html#cb61-14"></a><span class="co">##   x x.1 z</span></span>
<span id="cb61-15"><a href="advanced-r.html#cb61-15"></a><span class="co">## 1 1   1 A</span></span>
<span id="cb61-16"><a href="advanced-r.html#cb61-16"></a><span class="co">## 2 2   2 B</span></span>
<span id="cb61-17"><a href="advanced-r.html#cb61-17"></a><span class="co">## 3 3   3 C</span></span>
<span id="cb61-18"><a href="advanced-r.html#cb61-18"></a><span class="co">## 4 4   4 D</span></span>
<span id="cb61-19"><a href="advanced-r.html#cb61-19"></a><span class="co">## 5 5   5 E</span></span>
<span id="cb61-20"><a href="advanced-r.html#cb61-20"></a></span>
<span id="cb61-21"><a href="advanced-r.html#cb61-21"></a><span class="co"># passing vector pairs for each dimension subsets like a matrix</span></span>
<span id="cb61-22"><a href="advanced-r.html#cb61-22"></a>df[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">5</span>), ]</span>
<span id="cb61-23"><a href="advanced-r.html#cb61-23"></a><span class="co">##   x y z</span></span>
<span id="cb61-24"><a href="advanced-r.html#cb61-24"></a><span class="co">## 1 1 a A</span></span>
<span id="cb61-25"><a href="advanced-r.html#cb61-25"></a><span class="co">## 5 5 e E</span></span></code></pre></div>
<p>We saw earlier that matrix subsetting will try and simplify vectors when possible. This has
consequences for data frames when subsetting single columns like a matrix:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="advanced-r.html#cb62-1"></a><span class="co"># passing vector pairs may try and simplify vectors (in this case to an integer vector)</span></span>
<span id="cb62-2"><a href="advanced-r.html#cb62-2"></a><span class="kw">str</span>(df[,<span class="st">&quot;x&quot;</span>])</span>
<span id="cb62-3"><a href="advanced-r.html#cb62-3"></a><span class="co">##  int [1:5] 1 2 3 4 5</span></span></code></pre></div>
<p>To preserve dimensionality use <code>drop = FALSE</code>:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="advanced-r.html#cb63-1"></a><span class="kw">str</span>(df[,<span class="st">&quot;x&quot;</span>, <span class="dt">drop =</span> <span class="ot">FALSE</span>])</span>
<span id="cb63-2"><a href="advanced-r.html#cb63-2"></a><span class="co">## &#39;data.frame&#39;:    5 obs. of  1 variable:</span></span>
<span id="cb63-3"><a href="advanced-r.html#cb63-3"></a><span class="co">##  $ x: int  1 2 3 4 5</span></span></code></pre></div>
<p>Tibbles will always return tibbles:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="advanced-r.html#cb64-1"></a><span class="kw">str</span>(tibble<span class="op">::</span><span class="kw">as_tibble</span>(df)[,<span class="st">&quot;x&quot;</span>])</span>
<span id="cb64-2"><a href="advanced-r.html#cb64-2"></a><span class="co">## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    5 obs. of  1 variable:</span></span>
<span id="cb64-3"><a href="advanced-r.html#cb64-3"></a><span class="co">##  $ x: int  1 2 3 4 5</span></span></code></pre></div>
</div>
</div>
<div id="selecting-a-single-element" class="section level4" number="1.1.3.2">
<h4 number="1.1.3.2"><span class="header-section-number">1.1.3.2</span> Selecting a single element</h4>
<p><code>[[</code> can be used for subsetting single elements, while <code>x$y</code> can be used similar to <code>x[["y"]]</code>.</p>
<div id="section" class="section level5" number="1.1.3.2.1">
<h5 number="1.1.3.2.1"><span class="header-section-number">1.1.3.2.1</span> [[</h5>
<p>Recall <code>[</code> returns a list element as a list. So to access the value within that list you write <code>[[</code>:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="advanced-r.html#cb65-1"></a>l &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>, <span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>,<span class="dv">3</span>), <span class="kw">c</span>(<span class="ot">TRUE</span>,<span class="ot">FALSE</span>,<span class="ot">TRUE</span>))</span>
<span id="cb65-2"><a href="advanced-r.html#cb65-2"></a></span>
<span id="cb65-3"><a href="advanced-r.html#cb65-3"></a><span class="co"># [ returns a list</span></span>
<span id="cb65-4"><a href="advanced-r.html#cb65-4"></a><span class="kw">str</span>(l[<span class="dv">3</span>])</span>
<span id="cb65-5"><a href="advanced-r.html#cb65-5"></a><span class="co">## List of 1</span></span>
<span id="cb65-6"><a href="advanced-r.html#cb65-6"></a><span class="co">##  $ : logi [1:3] TRUE FALSE TRUE</span></span>
<span id="cb65-7"><a href="advanced-r.html#cb65-7"></a><span class="co"># [[ returns the object in that list</span></span>
<span id="cb65-8"><a href="advanced-r.html#cb65-8"></a>l[[<span class="dv">3</span>]]</span>
<span id="cb65-9"><a href="advanced-r.html#cb65-9"></a><span class="co">## [1]  TRUE FALSE  TRUE</span></span></code></pre></div>
</div>
<div id="section-1" class="section level5" number="1.1.3.2.2">
<h5 number="1.1.3.2.2"><span class="header-section-number">1.1.3.2.2</span> $</h5>
<p><code>$</code> is a shortcut for something similar to <code>x$y</code> == <code>x[["y"]]</code> and is often used
to extract columns of data frames:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="advanced-r.html#cb66-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">yolk=</span>letters[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], <span class="dt">zoo =</span> LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>])</span>
<span id="cb66-2"><a href="advanced-r.html#cb66-2"></a>df<span class="op">$</span>x</span>
<span id="cb66-3"><a href="advanced-r.html#cb66-3"></a><span class="co">## [1] 1 2 3 4 5</span></span></code></pre></div>
<p>However, there is a common misuse: $ does partial matching from left-to-right.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="advanced-r.html#cb67-1"></a>df<span class="op">$</span>y <span class="co"># returns column name &quot;yolk&quot;</span></span>
<span id="cb67-2"><a href="advanced-r.html#cb67-2"></a><span class="co">## [1] a b c d e</span></span>
<span id="cb67-3"><a href="advanced-r.html#cb67-3"></a><span class="co">## Levels: a b c d e</span></span></code></pre></div>
<p>You can use <code>options(warnPartialMatchDollar = TRUE)</code> to warn you when it happens:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="advanced-r.html#cb68-1"></a><span class="kw">options</span>(<span class="dt">warnPartialMatchDollar=</span><span class="ot">TRUE</span>)</span>
<span id="cb68-2"><a href="advanced-r.html#cb68-2"></a></span>
<span id="cb68-3"><a href="advanced-r.html#cb68-3"></a>df<span class="op">$</span>y</span>
<span id="cb68-4"><a href="advanced-r.html#cb68-4"></a><span class="co">## Warning in df$y: partial match of &#39;y&#39; to &#39;yolk&#39;</span></span>
<span id="cb68-5"><a href="advanced-r.html#cb68-5"></a><span class="co">## [1] a b c d e</span></span>
<span id="cb68-6"><a href="advanced-r.html#cb68-6"></a><span class="co">## Levels: a b c d e</span></span></code></pre></div>
<p>Tibbles never do partial matching.</p>
</div>
</div>
<div id="subassignment" class="section level4" number="1.1.3.3">
<h4 number="1.1.3.3"><span class="header-section-number">1.1.3.3</span> Subassignment</h4>
<p>Subsetting can be combined with assignment to update values at those indices. This
is called subassignment and takes the general form <code>x[i] &lt;- value</code>.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="advanced-r.html#cb69-1"></a>x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb69-2"><a href="advanced-r.html#cb69-2"></a></span>
<span id="cb69-3"><a href="advanced-r.html#cb69-3"></a><span class="co"># update elements 1:5 and flip their sign</span></span>
<span id="cb69-4"><a href="advanced-r.html#cb69-4"></a>x[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)<span class="op">*-</span><span class="dv">1</span></span>
<span id="cb69-5"><a href="advanced-r.html#cb69-5"></a>x</span>
<span id="cb69-6"><a href="advanced-r.html#cb69-6"></a><span class="co">##  [1] -1 -2 -3 -4 -5  6  7  8  9 10</span></span></code></pre></div>
<p><strong>R will recycle subassignments</strong> if the subset and assgnment vectors are different lengths, so be
sure of both <em>length</em> and <em>duplicate values</em>.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="advanced-r.html#cb70-1"></a><span class="co"># R recyles the scalar to both the first and last elements</span></span>
<span id="cb70-2"><a href="advanced-r.html#cb70-2"></a>x[<span class="kw">c</span>(<span class="dv">1</span>,<span class="kw">length</span>(x))] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb70-3"><a href="advanced-r.html#cb70-3"></a>x</span>
<span id="cb70-4"><a href="advanced-r.html#cb70-4"></a><span class="co">##  [1]  0 -2 -3 -4 -5  6  7  8  9  0</span></span></code></pre></div>
<p>List elements can be removed with NULL subassignment:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="advanced-r.html#cb71-1"></a><span class="kw">rm</span>(l)</span>
<span id="cb71-2"><a href="advanced-r.html#cb71-2"></a></span>
<span id="cb71-3"><a href="advanced-r.html#cb71-3"></a><span class="co"># Create list l where element 3 is a data frame</span></span>
<span id="cb71-4"><a href="advanced-r.html#cb71-4"></a>l &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">1</span>, <span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>))</span>
<span id="cb71-5"><a href="advanced-r.html#cb71-5"></a><span class="co"># subassign the 3rd element to NULL</span></span>
<span id="cb71-6"><a href="advanced-r.html#cb71-6"></a>l[[<span class="dv">3</span>]] &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb71-7"><a href="advanced-r.html#cb71-7"></a></span>
<span id="cb71-8"><a href="advanced-r.html#cb71-8"></a><span class="co"># the data frame is removed from list l</span></span>
<span id="cb71-9"><a href="advanced-r.html#cb71-9"></a><span class="kw">str</span>(l)</span>
<span id="cb71-10"><a href="advanced-r.html#cb71-10"></a><span class="co">## List of 2</span></span>
<span id="cb71-11"><a href="advanced-r.html#cb71-11"></a><span class="co">##  $ : int [1:3] 1 2 3</span></span>
<span id="cb71-12"><a href="advanced-r.html#cb71-12"></a><span class="co">##  $ : num 1</span></span></code></pre></div>
<p>Empty subsets can be useful to preserve the original object class:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="advanced-r.html#cb72-1"></a><span class="kw">rm</span>(df)</span>
<span id="cb72-2"><a href="advanced-r.html#cb72-2"></a></span>
<span id="cb72-3"><a href="advanced-r.html#cb72-3"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb72-4"><a href="advanced-r.html#cb72-4"></a></span>
<span id="cb72-5"><a href="advanced-r.html#cb72-5"></a><span class="co"># modify the empty subset of the data frame rather than the data frame object</span></span>
<span id="cb72-6"><a href="advanced-r.html#cb72-6"></a><span class="co"># i.e. modify the contents rather than the object</span></span>
<span id="cb72-7"><a href="advanced-r.html#cb72-7"></a>df[] &lt;-<span class="st"> </span><span class="kw">lapply</span>(df, as.logical)</span>
<span id="cb72-8"><a href="advanced-r.html#cb72-8"></a></span>
<span id="cb72-9"><a href="advanced-r.html#cb72-9"></a><span class="co"># df retains data.frame class</span></span>
<span id="cb72-10"><a href="advanced-r.html#cb72-10"></a><span class="kw">str</span>(df)</span>
<span id="cb72-11"><a href="advanced-r.html#cb72-11"></a><span class="co">## &#39;data.frame&#39;:    4 obs. of  1 variable:</span></span>
<span id="cb72-12"><a href="advanced-r.html#cb72-12"></a><span class="co">##  $ x: logi  TRUE TRUE FALSE FALSE</span></span>
<span id="cb72-13"><a href="advanced-r.html#cb72-13"></a></span>
<span id="cb72-14"><a href="advanced-r.html#cb72-14"></a><span class="co"># whereas list apply updates df object to class list</span></span>
<span id="cb72-15"><a href="advanced-r.html#cb72-15"></a>df &lt;-<span class="st"> </span><span class="kw">lapply</span>(df, as.integer)</span>
<span id="cb72-16"><a href="advanced-r.html#cb72-16"></a><span class="kw">str</span>(df)</span>
<span id="cb72-17"><a href="advanced-r.html#cb72-17"></a><span class="co">## List of 1</span></span>
<span id="cb72-18"><a href="advanced-r.html#cb72-18"></a><span class="co">##  $ x: int [1:4] 1 1 0 0</span></span></code></pre></div>
</div>
<div id="applications" class="section level4" number="1.1.3.4">
<h4 number="1.1.3.4"><span class="header-section-number">1.1.3.4</span> Applications</h4>
<div id="lookup-tables" class="section level5" number="1.1.3.4.1">
<h5 number="1.1.3.4.1"><span class="header-section-number">1.1.3.4.1</span> Lookup tables</h5>
<p>Translating lookup values using subsetting:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="advanced-r.html#cb73-1"></a><span class="co"># a character vector of test scores</span></span>
<span id="cb73-2"><a href="advanced-r.html#cb73-2"></a>scores &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;l&#39;</span>,<span class="st">&#39;l&#39;</span>,<span class="st">&#39;h&#39;</span>,<span class="st">&#39;m&#39;</span>,<span class="st">&#39;h&#39;</span>,<span class="st">&#39;m&#39;</span>,<span class="st">&#39;l&#39;</span>)</span>
<span id="cb73-3"><a href="advanced-r.html#cb73-3"></a></span>
<span id="cb73-4"><a href="advanced-r.html#cb73-4"></a><span class="co"># a lookup vector of descriptors for named scores</span></span>
<span id="cb73-5"><a href="advanced-r.html#cb73-5"></a>xlat_scores &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">l =</span> <span class="st">&#39;low&#39;</span>,<span class="dt">m =</span> <span class="st">&#39;medium&#39;</span>, <span class="dt">h=</span><span class="st">&#39;high&#39;</span>)</span>
<span id="cb73-6"><a href="advanced-r.html#cb73-6"></a></span>
<span id="cb73-7"><a href="advanced-r.html#cb73-7"></a><span class="co"># subset xlat_scores with the observed scores</span></span>
<span id="cb73-8"><a href="advanced-r.html#cb73-8"></a>xlat_scores[scores]</span>
<span id="cb73-9"><a href="advanced-r.html#cb73-9"></a><span class="co">##        l        l        h        m        h        m        l </span></span>
<span id="cb73-10"><a href="advanced-r.html#cb73-10"></a><span class="co">##    &quot;low&quot;    &quot;low&quot;   &quot;high&quot; &quot;medium&quot;   &quot;high&quot; &quot;medium&quot;    &quot;low&quot;</span></span>
<span id="cb73-11"><a href="advanced-r.html#cb73-11"></a></span>
<span id="cb73-12"><a href="advanced-r.html#cb73-12"></a><span class="co"># or unname() to remove attribute &quot;names&quot;</span></span>
<span id="cb73-13"><a href="advanced-r.html#cb73-13"></a><span class="kw">unname</span>(xlat_scores[scores])</span>
<span id="cb73-14"><a href="advanced-r.html#cb73-14"></a><span class="co">## [1] &quot;low&quot;    &quot;low&quot;    &quot;high&quot;   &quot;medium&quot; &quot;high&quot;   &quot;medium&quot; &quot;low&quot;</span></span></code></pre></div>
</div>
<div id="matching-and-merging-by-integer-subsetting" class="section level5" number="1.1.3.4.2">
<h5 number="1.1.3.4.2"><span class="header-section-number">1.1.3.4.2</span> Matching and merging by integer subsetting</h5>
<p>To merge multiple columns from a lookup table manually you can use <code>match()</code>,
which matches elements of <code>x</code> in <code>table</code> (see <code>?match()</code>) and returns the integer
position in <code>table</code>:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="advanced-r.html#cb74-1"></a>pets &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>)</span>
<span id="cb74-2"><a href="advanced-r.html#cb74-2"></a></span>
<span id="cb74-3"><a href="advanced-r.html#cb74-3"></a>pet_xlat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">petid =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>), </span>
<span id="cb74-4"><a href="advanced-r.html#cb74-4"></a>                       <span class="dt">pet.type =</span> <span class="kw">c</span>(<span class="st">&#39;cat&#39;</span>,<span class="st">&#39;dog&#39;</span>,<span class="st">&#39;bird&#39;</span>), </span>
<span id="cb74-5"><a href="advanced-r.html#cb74-5"></a>                       <span class="dt">pet.aka =</span> <span class="kw">c</span>(<span class="st">&#39;kitty&#39;</span>,<span class="st">&#39;doggie&#39;</span>,<span class="st">&#39;birdie&#39;</span>))</span>
<span id="cb74-6"><a href="advanced-r.html#cb74-6"></a></span>
<span id="cb74-7"><a href="advanced-r.html#cb74-7"></a>pet_match &lt;-<span class="st"> </span><span class="kw">match</span>(<span class="dt">x =</span> pets,</span>
<span id="cb74-8"><a href="advanced-r.html#cb74-8"></a>                   <span class="dt">table =</span> pet_xlat<span class="op">$</span>petid)</span>
<span id="cb74-9"><a href="advanced-r.html#cb74-9"></a></span>
<span id="cb74-10"><a href="advanced-r.html#cb74-10"></a><span class="co"># the matching integer position of pets in pet_xlat</span></span>
<span id="cb74-11"><a href="advanced-r.html#cb74-11"></a>pet_match</span>
<span id="cb74-12"><a href="advanced-r.html#cb74-12"></a><span class="co">## [1] 3 2 3 1</span></span>
<span id="cb74-13"><a href="advanced-r.html#cb74-13"></a></span>
<span id="cb74-14"><a href="advanced-r.html#cb74-14"></a><span class="co"># subset the rows matched by pet_match</span></span>
<span id="cb74-15"><a href="advanced-r.html#cb74-15"></a>pet_xlat[pet_match,]</span>
<span id="cb74-16"><a href="advanced-r.html#cb74-16"></a><span class="co">##     petid pet.type pet.aka</span></span>
<span id="cb74-17"><a href="advanced-r.html#cb74-17"></a><span class="co">## 3       1     bird  birdie</span></span>
<span id="cb74-18"><a href="advanced-r.html#cb74-18"></a><span class="co">## 2       2      dog  doggie</span></span>
<span id="cb74-19"><a href="advanced-r.html#cb74-19"></a><span class="co">## 3.1     1     bird  birdie</span></span>
<span id="cb74-20"><a href="advanced-r.html#cb74-20"></a><span class="co">## 1       3      cat   kitty</span></span>
<span id="cb74-21"><a href="advanced-r.html#cb74-21"></a></span>
<span id="cb74-22"><a href="advanced-r.html#cb74-22"></a><span class="kw">rm</span>(pets)</span>
<span id="cb74-23"><a href="advanced-r.html#cb74-23"></a><span class="kw">rm</span>(pet_xlat)</span>
<span id="cb74-24"><a href="advanced-r.html#cb74-24"></a><span class="kw">rm</span>(pet_match)</span></code></pre></div>
<p>To merge on more than one column you would typically use <code>interaction()</code> to collapse
into one and perform a similar operation. However, you should probably look to custom
built merge functions like <code>merge()</code> or <code>dplyr::left_join()</code> to ease the process.</p>
</div>
<div id="random-and-bootstrap-sampling" class="section level5" number="1.1.3.4.3">
<h5 number="1.1.3.4.3"><span class="header-section-number">1.1.3.4.3</span> Random and Bootstrap sampling</h5>
<p>Data frame subsetting makes it easy to create random samples and bootstrap samples in R. <code>sample()</code> returns elements of a vector (or creates an integer vector 1:<code>n</code> if given a scalar) with arguments for <code>size=</code> and
<code>replace=</code>.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="advanced-r.html#cb75-1"></a><span class="kw">rm</span>(df)</span>
<span id="cb75-2"><a href="advanced-r.html#cb75-2"></a></span>
<span id="cb75-3"><a href="advanced-r.html#cb75-3"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">y =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], <span class="dt">z =</span> LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>],</span>
<span id="cb75-4"><a href="advanced-r.html#cb75-4"></a>                 <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb75-5"><a href="advanced-r.html#cb75-5"></a></span>
<span id="cb75-6"><a href="advanced-r.html#cb75-6"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb75-7"><a href="advanced-r.html#cb75-7"></a><span class="co"># use integer indices from sample to return two randomly sampled rows from df without replacement</span></span>
<span id="cb75-8"><a href="advanced-r.html#cb75-8"></a>df[<span class="kw">sample</span>(<span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">2</span>),]</span>
<span id="cb75-9"><a href="advanced-r.html#cb75-9"></a><span class="co">##   x y z</span></span>
<span id="cb75-10"><a href="advanced-r.html#cb75-10"></a><span class="co">## 1 1 a A</span></span>
<span id="cb75-11"><a href="advanced-r.html#cb75-11"></a><span class="co">## 4 4 d D</span></span>
<span id="cb75-12"><a href="advanced-r.html#cb75-12"></a></span>
<span id="cb75-13"><a href="advanced-r.html#cb75-13"></a><span class="co"># use sample() to randomly sample an integer vector 1:length(df) with replacement 5 times </span></span>
<span id="cb75-14"><a href="advanced-r.html#cb75-14"></a><span class="co"># and subset the corresponding rows of df</span></span>
<span id="cb75-15"><a href="advanced-r.html#cb75-15"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb75-16"><a href="advanced-r.html#cb75-16"></a>df[<span class="kw">sample</span>(<span class="dt">x =</span> <span class="kw">length</span>(df), <span class="dt">size =</span> <span class="dv">5</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>), ]</span>
<span id="cb75-17"><a href="advanced-r.html#cb75-17"></a><span class="co">##     x y z</span></span>
<span id="cb75-18"><a href="advanced-r.html#cb75-18"></a><span class="co">## 1   1 a A</span></span>
<span id="cb75-19"><a href="advanced-r.html#cb75-19"></a><span class="co">## 3   3 c C</span></span>
<span id="cb75-20"><a href="advanced-r.html#cb75-20"></a><span class="co">## 1.1 1 a A</span></span>
<span id="cb75-21"><a href="advanced-r.html#cb75-21"></a><span class="co">## 2   2 b B</span></span>
<span id="cb75-22"><a href="advanced-r.html#cb75-22"></a><span class="co">## 1.2 1 a A</span></span>
<span id="cb75-23"><a href="advanced-r.html#cb75-23"></a><span class="co"># row 1 was selected three times (rownames: 1, 1.1, 1.2), and rows 2 &amp; 3 only once in a bootstrap sample</span></span>
<span id="cb75-24"><a href="advanced-r.html#cb75-24"></a></span>
<span id="cb75-25"><a href="advanced-r.html#cb75-25"></a><span class="kw">rm</span>(df)</span></code></pre></div>
</div>
<div id="arordering" class="section level5" number="1.1.3.4.4">
<h5 number="1.1.3.4.4"><span class="header-section-number">1.1.3.4.4</span> Ordering</h5>
<p>Use <code>order()</code> to return an <code>integer</code> vector describing the sorted elements of <code>x</code> or <code>...</code>, which
can be used to subset vectors in a new order:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="advanced-r.html#cb76-1"></a>x &lt;-<span class="st"> </span>letters[<span class="dv">10</span><span class="op">:</span><span class="dv">1</span>]</span>
<span id="cb76-2"><a href="advanced-r.html#cb76-2"></a>x</span>
<span id="cb76-3"><a href="advanced-r.html#cb76-3"></a><span class="co">##  [1] &quot;j&quot; &quot;i&quot; &quot;h&quot; &quot;g&quot; &quot;f&quot; &quot;e&quot; &quot;d&quot; &quot;c&quot; &quot;b&quot; &quot;a&quot;</span></span>
<span id="cb76-4"><a href="advanced-r.html#cb76-4"></a></span>
<span id="cb76-5"><a href="advanced-r.html#cb76-5"></a><span class="co"># order() returns the integer positions of x sorted ascending by default</span></span>
<span id="cb76-6"><a href="advanced-r.html#cb76-6"></a><span class="kw">order</span>(x)</span>
<span id="cb76-7"><a href="advanced-r.html#cb76-7"></a><span class="co">##  [1] 10  9  8  7  6  5  4  3  2  1</span></span>
<span id="cb76-8"><a href="advanced-r.html#cb76-8"></a></span>
<span id="cb76-9"><a href="advanced-r.html#cb76-9"></a><span class="co"># use this new vector to reorder the original vector</span></span>
<span id="cb76-10"><a href="advanced-r.html#cb76-10"></a>x[<span class="kw">order</span>(x)]</span>
<span id="cb76-11"><a href="advanced-r.html#cb76-11"></a><span class="co">##  [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot; &quot;g&quot; &quot;h&quot; &quot;i&quot; &quot;j&quot;</span></span>
<span id="cb76-12"><a href="advanced-r.html#cb76-12"></a></span>
<span id="cb76-13"><a href="advanced-r.html#cb76-13"></a><span class="kw">rm</span>(x)</span></code></pre></div>
<p>There are additional arguments to <code>order()</code> such as <code>decreasing</code> and <code>na.last</code> that
allow you to sort descending or <code>NA</code> values first, last, or ommit them.</p>
<p>For &gt;2d vectors, <code>order()</code> can be passed to each dimension allowing you to sort columns and
rows independently:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="advanced-r.html#cb77-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Alpha =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">Bravo =</span> <span class="ot">TRUE</span>, <span class="dt">Charlie =</span> <span class="kw">c</span>(<span class="st">&#39;red&#39;</span>,<span class="st">&#39;blue&#39;</span>,<span class="ot">NA</span>))</span>
<span id="cb77-2"><a href="advanced-r.html#cb77-2"></a>df</span>
<span id="cb77-3"><a href="advanced-r.html#cb77-3"></a><span class="co">##   Alpha Bravo Charlie</span></span>
<span id="cb77-4"><a href="advanced-r.html#cb77-4"></a><span class="co">## 1     1  TRUE     red</span></span>
<span id="cb77-5"><a href="advanced-r.html#cb77-5"></a><span class="co">## 2     2  TRUE    blue</span></span>
<span id="cb77-6"><a href="advanced-r.html#cb77-6"></a><span class="co">## 3     3  TRUE    &lt;NA&gt;</span></span>
<span id="cb77-7"><a href="advanced-r.html#cb77-7"></a><span class="co">## 4     4  TRUE     red</span></span>
<span id="cb77-8"><a href="advanced-r.html#cb77-8"></a><span class="co">## 5     5  TRUE    blue</span></span>
<span id="cb77-9"><a href="advanced-r.html#cb77-9"></a><span class="co">## 6     6  TRUE    &lt;NA&gt;</span></span>
<span id="cb77-10"><a href="advanced-r.html#cb77-10"></a></span>
<span id="cb77-11"><a href="advanced-r.html#cb77-11"></a><span class="co"># subset df by sorting rows by Charlie and removing NA; order columns descending by name</span></span>
<span id="cb77-12"><a href="advanced-r.html#cb77-12"></a>df[<span class="kw">order</span>(df<span class="op">$</span>Charlie, <span class="dt">na.last =</span> <span class="ot">NA</span>), <span class="kw">order</span>(<span class="kw">names</span>(df), <span class="dt">decreasing =</span> T)]</span>
<span id="cb77-13"><a href="advanced-r.html#cb77-13"></a><span class="co">##   Charlie Bravo Alpha</span></span>
<span id="cb77-14"><a href="advanced-r.html#cb77-14"></a><span class="co">## 2    blue  TRUE     2</span></span>
<span id="cb77-15"><a href="advanced-r.html#cb77-15"></a><span class="co">## 5    blue  TRUE     5</span></span>
<span id="cb77-16"><a href="advanced-r.html#cb77-16"></a><span class="co">## 1     red  TRUE     1</span></span>
<span id="cb77-17"><a href="advanced-r.html#cb77-17"></a><span class="co">## 4     red  TRUE     4</span></span></code></pre></div>
</div>
<div id="random-sort" class="section level5" number="1.1.3.4.5">
<h5 number="1.1.3.4.5"><span class="header-section-number">1.1.3.4.5</span> Random sort</h5>
<p>As an extension of <a href="advanced-r.html#arordering">ordering</a>, use <code>sample()</code> to randomly reorder rows
of a data frame:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="advanced-r.html#cb78-1"></a><span class="kw">set.seed</span>(<span class="dv">8</span>)</span>
<span id="cb78-2"><a href="advanced-r.html#cb78-2"></a><span class="co"># randomly sample integers from 1:&quot;rows in df&quot; &quot;rows in df&quot; times without replacement </span></span>
<span id="cb78-3"><a href="advanced-r.html#cb78-3"></a><span class="co"># and subset row dim</span></span>
<span id="cb78-4"><a href="advanced-r.html#cb78-4"></a>df[<span class="kw">sample</span>(<span class="kw">nrow</span>(df), <span class="kw">nrow</span>(df), <span class="dt">replace =</span> <span class="ot">FALSE</span>), ]</span>
<span id="cb78-5"><a href="advanced-r.html#cb78-5"></a><span class="co">##   Alpha Bravo Charlie</span></span>
<span id="cb78-6"><a href="advanced-r.html#cb78-6"></a><span class="co">## 4     4  TRUE     red</span></span>
<span id="cb78-7"><a href="advanced-r.html#cb78-7"></a><span class="co">## 2     2  TRUE    blue</span></span>
<span id="cb78-8"><a href="advanced-r.html#cb78-8"></a><span class="co">## 3     3  TRUE    &lt;NA&gt;</span></span>
<span id="cb78-9"><a href="advanced-r.html#cb78-9"></a><span class="co">## 6     6  TRUE    &lt;NA&gt;</span></span>
<span id="cb78-10"><a href="advanced-r.html#cb78-10"></a><span class="co">## 5     5  TRUE    blue</span></span>
<span id="cb78-11"><a href="advanced-r.html#cb78-11"></a><span class="co">## 1     1  TRUE     red</span></span>
<span id="cb78-12"><a href="advanced-r.html#cb78-12"></a></span>
<span id="cb78-13"><a href="advanced-r.html#cb78-13"></a><span class="kw">rm</span>(df)</span></code></pre></div>
</div>
<div id="expanding-aggregate-counts" class="section level5" number="1.1.3.4.6">
<h5 number="1.1.3.4.6"><span class="header-section-number">1.1.3.4.6</span> Expanding aggregate counts</h5>
<p><code>rep()</code> replicates elements of <code>x</code> a number of <code>times</code>, where <code>times</code> can be a vector
for each element, or a scalar to recyle the entire vector <code>x</code>.</p>
<p><code>rep()</code> also can accept argument <code>each</code> to repeat each element <code>each</code> number of times instead of
recycling the entire vector; or <code>length.out</code> to recyle the vector the desired length <em>(even if not an integer multiple)</em>.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="advanced-r.html#cb79-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">crayon_color =</span> <span class="kw">c</span>(<span class="st">&#39;red&#39;</span>,<span class="st">&#39;blue&#39;</span>,<span class="st">&#39;yellow&#39;</span>),</span>
<span id="cb79-2"><a href="advanced-r.html#cb79-2"></a>                 <span class="dt">count =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</span>
<span id="cb79-3"><a href="advanced-r.html#cb79-3"></a>df</span>
<span id="cb79-4"><a href="advanced-r.html#cb79-4"></a><span class="co">##   crayon_color count</span></span>
<span id="cb79-5"><a href="advanced-r.html#cb79-5"></a><span class="co">## 1          red     1</span></span>
<span id="cb79-6"><a href="advanced-r.html#cb79-6"></a><span class="co">## 2         blue     2</span></span>
<span id="cb79-7"><a href="advanced-r.html#cb79-7"></a><span class="co">## 3       yellow     3</span></span>
<span id="cb79-8"><a href="advanced-r.html#cb79-8"></a></span>
<span id="cb79-9"><a href="advanced-r.html#cb79-9"></a><span class="co"># rep() accepts an integer vector and vector `times` as the number to repeat each element</span></span>
<span id="cb79-10"><a href="advanced-r.html#cb79-10"></a><span class="kw">rep</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(df), <span class="dt">times =</span> df<span class="op">$</span>count)</span>
<span id="cb79-11"><a href="advanced-r.html#cb79-11"></a><span class="co">## [1] 1 2 2 3 3 3</span></span>
<span id="cb79-12"><a href="advanced-r.html#cb79-12"></a></span>
<span id="cb79-13"><a href="advanced-r.html#cb79-13"></a><span class="co"># used to subset rows in df expands the aggregate counts into observations</span></span>
<span id="cb79-14"><a href="advanced-r.html#cb79-14"></a>df[<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(df), df<span class="op">$</span>count),]</span>
<span id="cb79-15"><a href="advanced-r.html#cb79-15"></a><span class="co">##     crayon_color count</span></span>
<span id="cb79-16"><a href="advanced-r.html#cb79-16"></a><span class="co">## 1            red     1</span></span>
<span id="cb79-17"><a href="advanced-r.html#cb79-17"></a><span class="co">## 2           blue     2</span></span>
<span id="cb79-18"><a href="advanced-r.html#cb79-18"></a><span class="co">## 2.1         blue     2</span></span>
<span id="cb79-19"><a href="advanced-r.html#cb79-19"></a><span class="co">## 3         yellow     3</span></span>
<span id="cb79-20"><a href="advanced-r.html#cb79-20"></a><span class="co">## 3.1       yellow     3</span></span>
<span id="cb79-21"><a href="advanced-r.html#cb79-21"></a><span class="co">## 3.2       yellow     3</span></span>
<span id="cb79-22"><a href="advanced-r.html#cb79-22"></a></span>
<span id="cb79-23"><a href="advanced-r.html#cb79-23"></a><span class="kw">rm</span>(df)</span></code></pre></div>
</div>
<div id="removing-data-frame-columns" class="section level5" number="1.1.3.4.7">
<h5 number="1.1.3.4.7"><span class="header-section-number">1.1.3.4.7</span> Removing data frame columns</h5>
<p>Data frame columns can be removed in two ways, by setting the column to <code>NULL</code> or
by subsetting/subassigning the columns you do want:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="advanced-r.html#cb80-1"></a>df &lt;-<span class="st"> </span>mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</span>
<span id="cb80-2"><a href="advanced-r.html#cb80-2"></a></span>
<span id="cb80-3"><a href="advanced-r.html#cb80-3"></a>df<span class="op">$</span>mpg &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb80-4"><a href="advanced-r.html#cb80-4"></a><span class="kw">str</span>(df)</span>
<span id="cb80-5"><a href="advanced-r.html#cb80-5"></a><span class="co">## &#39;data.frame&#39;:    32 obs. of  3 variables:</span></span>
<span id="cb80-6"><a href="advanced-r.html#cb80-6"></a><span class="co">##  $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...</span></span>
<span id="cb80-7"><a href="advanced-r.html#cb80-7"></a><span class="co">##  $ disp: num  160 160 108 258 360 ...</span></span>
<span id="cb80-8"><a href="advanced-r.html#cb80-8"></a><span class="co">##  $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...</span></span>
<span id="cb80-9"><a href="advanced-r.html#cb80-9"></a></span>
<span id="cb80-10"><a href="advanced-r.html#cb80-10"></a>df &lt;-<span class="st"> </span>df[<span class="kw">c</span>(<span class="st">&#39;cyl&#39;</span>,<span class="st">&#39;hp&#39;</span>)]</span>
<span id="cb80-11"><a href="advanced-r.html#cb80-11"></a><span class="kw">str</span>(df)</span>
<span id="cb80-12"><a href="advanced-r.html#cb80-12"></a><span class="co">## &#39;data.frame&#39;:    32 obs. of  2 variables:</span></span>
<span id="cb80-13"><a href="advanced-r.html#cb80-13"></a><span class="co">##  $ cyl: num  6 6 4 6 8 6 8 4 4 6 ...</span></span>
<span id="cb80-14"><a href="advanced-r.html#cb80-14"></a><span class="co">##  $ hp : num  110 110 93 110 175 105 245 62 95 123 ...</span></span>
<span id="cb80-15"><a href="advanced-r.html#cb80-15"></a></span>
<span id="cb80-16"><a href="advanced-r.html#cb80-16"></a><span class="kw">rm</span>(df)</span></code></pre></div>
<p>You can use set operations to select all except the columns you don’t want:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="advanced-r.html#cb81-1"></a>df &lt;-<span class="st"> </span>mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</span>
<span id="cb81-2"><a href="advanced-r.html#cb81-2"></a></span>
<span id="cb81-3"><a href="advanced-r.html#cb81-3"></a>yuck &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;cyl&quot;</span>,<span class="st">&quot;disp&quot;</span>)</span>
<span id="cb81-4"><a href="advanced-r.html#cb81-4"></a></span>
<span id="cb81-5"><a href="advanced-r.html#cb81-5"></a><span class="co"># setdiff() returns the unique names found in names(df) and not contained in set yuck</span></span>
<span id="cb81-6"><a href="advanced-r.html#cb81-6"></a><span class="kw">head</span>(df[<span class="kw">setdiff</span>(<span class="kw">names</span>(df),yuck)])</span>
<span id="cb81-7"><a href="advanced-r.html#cb81-7"></a><span class="co">##                    mpg  hp</span></span>
<span id="cb81-8"><a href="advanced-r.html#cb81-8"></a><span class="co">## Mazda RX4         21.0 110</span></span>
<span id="cb81-9"><a href="advanced-r.html#cb81-9"></a><span class="co">## Mazda RX4 Wag     21.0 110</span></span>
<span id="cb81-10"><a href="advanced-r.html#cb81-10"></a><span class="co">## Datsun 710        22.8  93</span></span>
<span id="cb81-11"><a href="advanced-r.html#cb81-11"></a><span class="co">## Hornet 4 Drive    21.4 110</span></span>
<span id="cb81-12"><a href="advanced-r.html#cb81-12"></a><span class="co">## Hornet Sportabout 18.7 175</span></span>
<span id="cb81-13"><a href="advanced-r.html#cb81-13"></a><span class="co">## Valiant           18.1 105</span></span>
<span id="cb81-14"><a href="advanced-r.html#cb81-14"></a></span>
<span id="cb81-15"><a href="advanced-r.html#cb81-15"></a><span class="kw">rm</span>(df)</span></code></pre></div>
</div>
<div id="logical-subsetting" class="section level5" number="1.1.3.4.8">
<h5 number="1.1.3.4.8"><span class="header-section-number">1.1.3.4.8</span> Logical subsetting</h5>
<p>The most common subsetting action for data frames is passing a logical vector
to the row dimension of <code>[</code>. This allows for multiple conditions accross column vectors
using <code>(</code> grouping for clarity, and vector boolean operators <code>&amp;</code> (and), <code>|</code> (or),
<code>!</code> (not), <code>%in%</code> (in), etc.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="advanced-r.html#cb82-1"></a><span class="co"># select cars that get over 20 mpg, are not 4 cylinder, and are not the Honda Civic </span></span>
<span id="cb82-2"><a href="advanced-r.html#cb82-2"></a><span class="co"># or Hornet 4 Drive</span></span>
<span id="cb82-3"><a href="advanced-r.html#cb82-3"></a>mtcars[(mtcars<span class="op">$</span>mpg <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb82-4"><a href="advanced-r.html#cb82-4"></a><span class="st">         </span>(mtcars<span class="op">$</span>cyl <span class="op">!=</span><span class="st"> </span><span class="dv">4</span>) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb82-5"><a href="advanced-r.html#cb82-5"></a><span class="st">         </span><span class="op">!</span>(<span class="kw">rownames</span>(mtcars) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Honda Civic&#39;</span>,</span>
<span id="cb82-6"><a href="advanced-r.html#cb82-6"></a>                                   <span class="st">&#39;Hornet 4 Drive&#39;</span>)),]</span>
<span id="cb82-7"><a href="advanced-r.html#cb82-7"></a><span class="co">##               mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></span>
<span id="cb82-8"><a href="advanced-r.html#cb82-8"></a><span class="co">## Mazda RX4      21   6  160 110  3.9 2.620 16.46  0  1    4    4</span></span>
<span id="cb82-9"><a href="advanced-r.html#cb82-9"></a><span class="co">## Mazda RX4 Wag  21   6  160 110  3.9 2.875 17.02  0  1    4    4</span></span></code></pre></div>
</div>
<div id="boolean-algebra-and-sets" class="section level5" number="1.1.3.4.9">
<h5 number="1.1.3.4.9"><span class="header-section-number">1.1.3.4.9</span> Boolean algebra and sets</h5>
<p>Logical subsetting (boolean) and integer subsetting (sets) are naturally
equivocal. However, integer sets may have an advantage when you specifically need the location
of the first or last <code>TRUE</code> element of a set, if the logical set contains a high ratio
of <code>FALSE</code>:<code>TRUE</code> (you may save on memory), or if you specifically want the results to drop
<code>NA</code>s.</p>
<p>You can use <code>which()</code> to convert a logical set to an integer set:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="advanced-r.html#cb83-1"></a><span class="co"># a logical set</span></span>
<span id="cb83-2"><a href="advanced-r.html#cb83-2"></a>l &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">NA</span>)</span>
<span id="cb83-3"><a href="advanced-r.html#cb83-3"></a></span>
<span id="cb83-4"><a href="advanced-r.html#cb83-4"></a><span class="co"># an integer set--which() gives the TRUE indices of a logical vector and *drops all NA*</span></span>
<span id="cb83-5"><a href="advanced-r.html#cb83-5"></a>i &lt;-<span class="st"> </span><span class="kw">which</span>(l)</span>
<span id="cb83-6"><a href="advanced-r.html#cb83-6"></a>i</span>
<span id="cb83-7"><a href="advanced-r.html#cb83-7"></a><span class="co">## [1] 2 5 6 7</span></span></code></pre></div>
<p>You might convert a logical to an integer set to easily find the first or last <code>TRUE</code> elements:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="advanced-r.html#cb84-1"></a><span class="co"># first TRUE</span></span>
<span id="cb84-2"><a href="advanced-r.html#cb84-2"></a>i[<span class="dv">1</span>]</span>
<span id="cb84-3"><a href="advanced-r.html#cb84-3"></a><span class="co">## [1] 2</span></span>
<span id="cb84-4"><a href="advanced-r.html#cb84-4"></a><span class="co"># last TRUE</span></span>
<span id="cb84-5"><a href="advanced-r.html#cb84-5"></a>i[<span class="kw">length</span>(i)]</span>
<span id="cb84-6"><a href="advanced-r.html#cb84-6"></a><span class="co">## [1] 7</span></span>
<span id="cb84-7"><a href="advanced-r.html#cb84-7"></a></span>
<span id="cb84-8"><a href="advanced-r.html#cb84-8"></a><span class="kw">rm</span>(l); <span class="kw">rm</span>(i)</span></code></pre></div>
<p><strong>Boolean compared to set oprations</strong></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="advanced-r.html#cb85-1"></a><span class="co"># set x; create logical and integer versions</span></span>
<span id="cb85-2"><a href="advanced-r.html#cb85-2"></a>x1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>)</span>
<span id="cb85-3"><a href="advanced-r.html#cb85-3"></a>x2 &lt;-<span class="st"> </span><span class="kw">which</span>(x1); x2</span>
<span id="cb85-4"><a href="advanced-r.html#cb85-4"></a><span class="co">## [1] 1 3 5</span></span>
<span id="cb85-5"><a href="advanced-r.html#cb85-5"></a></span>
<span id="cb85-6"><a href="advanced-r.html#cb85-6"></a><span class="co"># set y; create logical and integer versions</span></span>
<span id="cb85-7"><a href="advanced-r.html#cb85-7"></a>y1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>)</span>
<span id="cb85-8"><a href="advanced-r.html#cb85-8"></a>y2 &lt;-<span class="st"> </span><span class="kw">which</span>(y1); y2</span>
<span id="cb85-9"><a href="advanced-r.html#cb85-9"></a><span class="co">## [1] 1 4</span></span></code></pre></div>
<p><em>Intersection:</em> <code>&amp;</code> <span class="math inline">\(\Leftrightarrow\)</span> <code>intersect()</code></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="advanced-r.html#cb86-1"></a><span class="co"># both must be TRUE</span></span>
<span id="cb86-2"><a href="advanced-r.html#cb86-2"></a>x1 <span class="op">&amp;</span><span class="st"> </span>y1</span>
<span id="cb86-3"><a href="advanced-r.html#cb86-3"></a><span class="co">## [1]  TRUE FALSE FALSE FALSE FALSE FALSE</span></span>
<span id="cb86-4"><a href="advanced-r.html#cb86-4"></a></span>
<span id="cb86-5"><a href="advanced-r.html#cb86-5"></a><span class="kw">intersect</span>(x2, y2)</span>
<span id="cb86-6"><a href="advanced-r.html#cb86-6"></a><span class="co">## [1] 1</span></span></code></pre></div>
<p><em>Union:</em> <code>|</code> <span class="math inline">\(\Leftrightarrow\)</span> <code>union()</code></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="advanced-r.html#cb87-1"></a><span class="co"># either can be TRUE</span></span>
<span id="cb87-2"><a href="advanced-r.html#cb87-2"></a>x1 <span class="op">|</span><span class="st"> </span>y1</span>
<span id="cb87-3"><a href="advanced-r.html#cb87-3"></a><span class="co">## [1]  TRUE FALSE  TRUE  TRUE  TRUE FALSE</span></span>
<span id="cb87-4"><a href="advanced-r.html#cb87-4"></a></span>
<span id="cb87-5"><a href="advanced-r.html#cb87-5"></a><span class="kw">union</span>(x2, y2)</span>
<span id="cb87-6"><a href="advanced-r.html#cb87-6"></a><span class="co">## [1] 1 3 5 4</span></span></code></pre></div>
<p><em>Complement:</em> <code>&amp; !</code> <span class="math inline">\(\Leftrightarrow\)</span> <code>setdiff()</code></p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="advanced-r.html#cb88-1"></a><span class="co"># exclusive TRUE in x1</span></span>
<span id="cb88-2"><a href="advanced-r.html#cb88-2"></a>x1 <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>y1</span>
<span id="cb88-3"><a href="advanced-r.html#cb88-3"></a><span class="co">## [1] FALSE FALSE  TRUE FALSE  TRUE FALSE</span></span>
<span id="cb88-4"><a href="advanced-r.html#cb88-4"></a></span>
<span id="cb88-5"><a href="advanced-r.html#cb88-5"></a><span class="kw">setdiff</span>(x2, y2)</span>
<span id="cb88-6"><a href="advanced-r.html#cb88-6"></a><span class="co">## [1] 3 5</span></span></code></pre></div>
<p><em>Symmetric difference:</em> <code>xor()</code> <span class="math inline">\(\Leftrightarrow\)</span> <code>setdiff(union(), intersect())</code></p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="advanced-r.html#cb89-1"></a><span class="co"># exclusive or (either is TRUE but only one)</span></span>
<span id="cb89-2"><a href="advanced-r.html#cb89-2"></a><span class="kw">xor</span>(x1, y1)</span>
<span id="cb89-3"><a href="advanced-r.html#cb89-3"></a><span class="co">## [1] FALSE FALSE  TRUE  TRUE  TRUE FALSE</span></span>
<span id="cb89-4"><a href="advanced-r.html#cb89-4"></a></span>
<span id="cb89-5"><a href="advanced-r.html#cb89-5"></a><span class="kw">setdiff</span>(<span class="kw">union</span>(x2, y2), <span class="kw">intersect</span>(x2, y2))</span>
<span id="cb89-6"><a href="advanced-r.html#cb89-6"></a><span class="co">## [1] 3 5 4</span></span></code></pre></div>

</div>
</div>
</div>
<div id="arconflow" class="section level3" number="1.1.4">
<h3 number="1.1.4"><span class="header-section-number">1.1.4</span> Control Flow</h3>
<p>Control flows in R can be split into <em>choices</em> and <em>loops</em>. Technically, <em>conditions</em> like messages,
warnings, and erros offer a non-local form a control flow (see <a href="https://adv-r.hadley.nz/conditions.html">conditions</a>).</p>
<div id="choices" class="section level4" number="1.1.4.1">
<h4 number="1.1.4.1"><span class="header-section-number">1.1.4.1</span> Choices</h4>
<p><code>if</code> takes the basic form of:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="advanced-r.html#cb90-1"></a><span class="cf">if</span> (condition) true_action</span>
<span id="cb90-2"><a href="advanced-r.html#cb90-2"></a><span class="cf">if</span> (condition) true_action <span class="cf">else</span> false_action</span></code></pre></div>
<p>It returns the value of true_action or false_action; and can be compounded within <code>{</code> to
peform multiple tests:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="advanced-r.html#cb91-1"></a>x &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb91-2"><a href="advanced-r.html#cb91-2"></a></span>
<span id="cb91-3"><a href="advanced-r.html#cb91-3"></a><span class="co"># if (condition) evaluates a scalar</span></span>
<span id="cb91-4"><a href="advanced-r.html#cb91-4"></a><span class="cf">if</span> (x <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="st">&quot;single&quot;</span> <span class="cf">else</span> <span class="st">&quot;multiple&quot;</span></span>
<span id="cb91-5"><a href="advanced-r.html#cb91-5"></a><span class="co">## [1] &quot;multiple&quot;</span></span>
<span id="cb91-6"><a href="advanced-r.html#cb91-6"></a></span>
<span id="cb91-7"><a href="advanced-r.html#cb91-7"></a><span class="co"># compound if statments takes the form:</span></span>
<span id="cb91-8"><a href="advanced-r.html#cb91-8"></a><span class="cf">if</span> (x <span class="op">==</span><span class="st"> </span><span class="dv">1</span>){</span>
<span id="cb91-9"><a href="advanced-r.html#cb91-9"></a>    <span class="st">&quot;single&quot;</span></span>
<span id="cb91-10"><a href="advanced-r.html#cb91-10"></a>  }<span class="cf">else</span> <span class="cf">if</span>(x <span class="op">==</span><span class="st"> </span><span class="dv">2</span>){</span>
<span id="cb91-11"><a href="advanced-r.html#cb91-11"></a>      <span class="st">&quot;double&quot;</span></span>
<span id="cb91-12"><a href="advanced-r.html#cb91-12"></a>  }<span class="cf">else</span>{</span>
<span id="cb91-13"><a href="advanced-r.html#cb91-13"></a>      <span class="st">&quot;multiple&quot;</span></span>
<span id="cb91-14"><a href="advanced-r.html#cb91-14"></a>  }</span>
<span id="cb91-15"><a href="advanced-r.html#cb91-15"></a><span class="co">## [1] &quot;double&quot;</span></span></code></pre></div>
<p><code>if</code> will silently return <code>NULL</code> when no else statement is given:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="advanced-r.html#cb92-1"></a>presence &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb92-2"><a href="advanced-r.html#cb92-2"></a></span>
<span id="cb92-3"><a href="advanced-r.html#cb92-3"></a><span class="cf">if</span> (<span class="op">!</span>presence) <span class="st">&quot;Elvis has left the building.&quot;</span></span></code></pre></div>
<div id="vectorized-if" class="section level5" number="1.1.4.1.1">
<h5 number="1.1.4.1.1"><span class="header-section-number">1.1.4.1.1</span> Vectorized <code>if</code></h5>
<p><code>if</code> only works with a single <code>TRUE</code>/<code>FALSE</code>. You can use <code>ifelse()</code> to vectorize <code>if</code>:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="advanced-r.html#cb93-1"></a>x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span></span>
<span id="cb93-2"><a href="advanced-r.html#cb93-2"></a></span>
<span id="cb93-3"><a href="advanced-r.html#cb93-3"></a><span class="kw">ifelse</span>(<span class="dt">test =</span> x <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">yes =</span> <span class="dv">0</span>, <span class="dt">no =</span> x)</span>
<span id="cb93-4"><a href="advanced-r.html#cb93-4"></a><span class="co">## [1] 0 0 3 4 5</span></span></code></pre></div>
<p>To vectorize compound <code>if</code> statements use <code>dplyr::case_when()</code> <em>(note the syntax change)</em>:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="advanced-r.html#cb94-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb94-2"><a href="advanced-r.html#cb94-2"></a>test_scores &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="dv">5</span>, <span class="dt">mean =</span> <span class="dv">82</span>, <span class="dt">sd =</span> <span class="dv">10</span>)</span>
<span id="cb94-3"><a href="advanced-r.html#cb94-3"></a></span>
<span id="cb94-4"><a href="advanced-r.html#cb94-4"></a><span class="co"># case_when() uses (conditional) ~ result syntax; TRUE ~ &quot;F&quot; is equivelant to else{}</span></span>
<span id="cb94-5"><a href="advanced-r.html#cb94-5"></a>dplyr<span class="op">::</span><span class="kw">case_when</span>(</span>
<span id="cb94-6"><a href="advanced-r.html#cb94-6"></a>  test_scores <span class="op">&gt;</span><span class="st"> </span><span class="dv">90</span> <span class="op">~</span><span class="st"> &quot;A&quot;</span>,</span>
<span id="cb94-7"><a href="advanced-r.html#cb94-7"></a>  test_scores <span class="op">&gt;</span><span class="st"> </span><span class="dv">80</span> <span class="op">~</span><span class="st"> &quot;B&quot;</span>,</span>
<span id="cb94-8"><a href="advanced-r.html#cb94-8"></a>  test_scores <span class="op">&gt;</span><span class="st"> </span><span class="dv">70</span> <span class="op">~</span><span class="st"> &quot;C&quot;</span>,</span>
<span id="cb94-9"><a href="advanced-r.html#cb94-9"></a>  test_scores <span class="op">&gt;</span><span class="st"> </span><span class="dv">60</span> <span class="op">~</span><span class="st"> &quot;D&quot;</span>,</span>
<span id="cb94-10"><a href="advanced-r.html#cb94-10"></a>  <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;F&quot;</span></span>
<span id="cb94-11"><a href="advanced-r.html#cb94-11"></a>)</span>
<span id="cb94-12"><a href="advanced-r.html#cb94-12"></a><span class="co">## [1] &quot;C&quot; &quot;B&quot; &quot;C&quot; &quot;A&quot; &quot;B&quot;</span></span></code></pre></div>
</div>
<div id="switch-statement" class="section level5" number="1.1.4.1.2">
<h5 number="1.1.4.1.2"><span class="header-section-number">1.1.4.1.2</span> <code>switch()</code> statement</h5>
<p><code>switch()</code> statements give you a more succint form of compound <code>if{}</code>
syntax:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="advanced-r.html#cb95-1"></a>greeting &lt;-<span class="st"> </span><span class="cf">function</span>(person){</span>
<span id="cb95-2"><a href="advanced-r.html#cb95-2"></a>  <span class="cf">switch</span>(person,</span>
<span id="cb95-3"><a href="advanced-r.html#cb95-3"></a>         <span class="dt">swab =</span> ,</span>
<span id="cb95-4"><a href="advanced-r.html#cb95-4"></a>         <span class="dt">captain =</span> ,</span>
<span id="cb95-5"><a href="advanced-r.html#cb95-5"></a>         <span class="dt">pirate =</span> ,</span>
<span id="cb95-6"><a href="advanced-r.html#cb95-6"></a>         <span class="dt">privateer =</span> ,</span>
<span id="cb95-7"><a href="advanced-r.html#cb95-7"></a>         <span class="dt">buccaneer =</span> ,</span>
<span id="cb95-8"><a href="advanced-r.html#cb95-8"></a>         <span class="dt">sailor =</span> <span class="st">&quot;Ahoy&quot;</span>,</span>
<span id="cb95-9"><a href="advanced-r.html#cb95-9"></a>         <span class="kw">stop</span>(<span class="st">&quot;It&#39;s mutiny!&quot;</span>)</span>
<span id="cb95-10"><a href="advanced-r.html#cb95-10"></a>         )</span>
<span id="cb95-11"><a href="advanced-r.html#cb95-11"></a>}</span>
<span id="cb95-12"><a href="advanced-r.html#cb95-12"></a></span>
<span id="cb95-13"><a href="advanced-r.html#cb95-13"></a><span class="kw">greeting</span>(<span class="dt">person =</span> <span class="st">&quot;privateer&quot;</span>)</span>
<span id="cb95-14"><a href="advanced-r.html#cb95-14"></a><span class="co">## [1] &quot;Ahoy&quot;</span></span>
<span id="cb95-15"><a href="advanced-r.html#cb95-15"></a><span class="kw">greeting</span>(<span class="dt">person =</span> <span class="st">&quot;taxidermist&quot;</span>)</span>
<span id="cb95-16"><a href="advanced-r.html#cb95-16"></a><span class="co">## Error in greeting(person = &quot;taxidermist&quot;): It&#39;s mutiny!</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p>when no value is defined <code>switch()</code> will “fall through” to the next defined
value (e.g. “Ahoy”)</p></li>
<li><p>the last argument uses <code>stop()</code> to throw an error; else <code>switch()</code> will return <code>NULL</code> and fail silently</p></li>
</ol>
<p><code>switch()</code> can throw undesirable errors when used with <code>numeric</code>, so it’s
advisable to only use it with type <code>character</code>.</p>
</div>
</div>
<div id="loops" class="section level4" number="1.1.4.2">
<h4 number="1.1.4.2"><span class="header-section-number">1.1.4.2</span> Loops</h4>
<p><em>note: loops are generally not needed for data anlysis tasks as there are functionals (e.g. <code>map()</code> and <code>apply()</code>) which vectorize them for you.</em></p>
<p><code>for</code> is an iterator which takes each element of a vector until either there are no
elements left, or <code>next</code>/<code>break</code> is encountered. It takes the form:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="advanced-r.html#cb96-1"></a><span class="cf">for</span> (item <span class="cf">in</span> vector) perform_action</span>
<span id="cb96-2"><a href="advanced-r.html#cb96-2"></a></span>
<span id="cb96-3"><a href="advanced-r.html#cb96-3"></a><span class="co"># or can be extended to compound statements similar to `if`:</span></span>
<span id="cb96-4"><a href="advanced-r.html#cb96-4"></a></span>
<span id="cb96-5"><a href="advanced-r.html#cb96-5"></a><span class="cf">for</span> (item <span class="cf">in</span> vector){</span>
<span id="cb96-6"><a href="advanced-r.html#cb96-6"></a>  action_<span class="dv">1</span></span>
<span id="cb96-7"><a href="advanced-r.html#cb96-7"></a>  action_<span class="dv">2</span></span>
<span id="cb96-8"><a href="advanced-r.html#cb96-8"></a>  etc.</span>
<span id="cb96-9"><a href="advanced-r.html#cb96-9"></a>}</span></code></pre></div>
<p><code>i</code> in this example is a binding within <code>{}</code> environment of the current vector element, and will
be overwritten each iteration:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="advanced-r.html#cb97-1"></a><span class="cf">for</span> (i <span class="cf">in</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]) <span class="kw">print</span>(i)</span>
<span id="cb97-2"><a href="advanced-r.html#cb97-2"></a><span class="co">## [1] &quot;a&quot;</span></span>
<span id="cb97-3"><a href="advanced-r.html#cb97-3"></a><span class="co">## [1] &quot;b&quot;</span></span>
<span id="cb97-4"><a href="advanced-r.html#cb97-4"></a><span class="co">## [1] &quot;c&quot;</span></span>
<span id="cb97-5"><a href="advanced-r.html#cb97-5"></a></span>
<span id="cb97-6"><a href="advanced-r.html#cb97-6"></a><span class="cf">for</span> (i <span class="cf">in</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]){</span>
<span id="cb97-7"><a href="advanced-r.html#cb97-7"></a>  <span class="cf">if</span> (i <span class="op">==</span><span class="st"> &quot;b&quot;</span>)</span>
<span id="cb97-8"><a href="advanced-r.html#cb97-8"></a>    <span class="cf">next</span></span>
<span id="cb97-9"><a href="advanced-r.html#cb97-9"></a>  </span>
<span id="cb97-10"><a href="advanced-r.html#cb97-10"></a>  <span class="cf">if</span> (i <span class="op">==</span><span class="st"> &quot;d&quot;</span>)</span>
<span id="cb97-11"><a href="advanced-r.html#cb97-11"></a>    <span class="cf">break</span></span>
<span id="cb97-12"><a href="advanced-r.html#cb97-12"></a>  </span>
<span id="cb97-13"><a href="advanced-r.html#cb97-13"></a>  <span class="kw">print</span>(i)</span>
<span id="cb97-14"><a href="advanced-r.html#cb97-14"></a>}</span>
<span id="cb97-15"><a href="advanced-r.html#cb97-15"></a><span class="co">## [1] &quot;a&quot;</span></span>
<span id="cb97-16"><a href="advanced-r.html#cb97-16"></a><span class="co">## [1] &quot;c&quot;</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li><em>Why your <code>for</code> loop is slow:</em></li>
</ol>
<p>Because of dynamic memory allocation, it is better in R to pre-allocate vector containers so
the program is not repeatedly asking for more and more memeory as the object grows.</p>
<p>It also minimizes the number of object copies required.</p>
<p><code>vector()</code> can be used to create the vector container of the right type and length:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="advanced-r.html#cb98-1"></a><span class="co"># create an integer vector the same length as our loop</span></span>
<span id="cb98-2"><a href="advanced-r.html#cb98-2"></a>v &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="dt">mode =</span> <span class="st">&quot;integer&quot;</span>, <span class="dt">length =</span> <span class="dv">10</span>)</span>
<span id="cb98-3"><a href="advanced-r.html#cb98-3"></a>v</span>
<span id="cb98-4"><a href="advanced-r.html#cb98-4"></a><span class="co">##  [1] 0 0 0 0 0 0 0 0 0 0</span></span>
<span id="cb98-5"><a href="advanced-r.html#cb98-5"></a></span>
<span id="cb98-6"><a href="advanced-r.html#cb98-6"></a><span class="co"># R has already allocated space for vector v, so updating each element with `for`</span></span>
<span id="cb98-7"><a href="advanced-r.html#cb98-7"></a><span class="co"># does </span></span>
<span id="cb98-8"><a href="advanced-r.html#cb98-8"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>){</span>
<span id="cb98-9"><a href="advanced-r.html#cb98-9"></a>  v[i] &lt;-<span class="st"> </span>i</span>
<span id="cb98-10"><a href="advanced-r.html#cb98-10"></a>}</span>
<span id="cb98-11"><a href="advanced-r.html#cb98-11"></a></span>
<span id="cb98-12"><a href="advanced-r.html#cb98-12"></a>v</span>
<span id="cb98-13"><a href="advanced-r.html#cb98-13"></a><span class="co">##  [1]  1  2  3  4  5  6  7  8  9 10</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><em><code>seq_along()</code> instead of <code>1:length()</code></em></li>
</ol>
<p>It is better to generate a regular sequence with <code>seq_along()</code> because it will always
generate a <code>numeric</code> sequence the same length as the input vector.</p>
<p><code>1:length(x)</code> can fail when vector length is 0 because <code>:</code> will actually create vector <code>[1] 1 0</code> (since
<code>:</code> creates descending vectors as well).</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="advanced-r.html#cb99-1"></a>v &lt;-<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb99-2"><a href="advanced-r.html#cb99-2"></a></span>
<span id="cb99-3"><a href="advanced-r.html#cb99-3"></a><span class="co"># error here when accessing vector position 0, which, in R, doesn&#39;t exist</span></span>
<span id="cb99-4"><a href="advanced-r.html#cb99-4"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(v)){</span>
<span id="cb99-5"><a href="advanced-r.html#cb99-5"></a>  v[[i]] &lt;-<span class="st"> </span>i</span>
<span id="cb99-6"><a href="advanced-r.html#cb99-6"></a>}</span>
<span id="cb99-7"><a href="advanced-r.html#cb99-7"></a><span class="co">## Error in v[[i]] &lt;- i: attempt to select less than one element in integerOneIndex</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><em>dropping S3 object attributes</em></li>
</ol>
<p>It is easy to drop object attributes when iterating, as <code>for</code> will loop the underlying, in this
case, <code>double</code> values:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="advanced-r.html#cb100-1"></a>v &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&#39;2020-04-01&#39;</span>,<span class="st">&#39;2020-04-02&#39;</span>))</span>
<span id="cb100-2"><a href="advanced-r.html#cb100-2"></a></span>
<span id="cb100-3"><a href="advanced-r.html#cb100-3"></a><span class="cf">for</span> (i <span class="cf">in</span> v){</span>
<span id="cb100-4"><a href="advanced-r.html#cb100-4"></a>  <span class="kw">print</span>(i)</span>
<span id="cb100-5"><a href="advanced-r.html#cb100-5"></a>}</span>
<span id="cb100-6"><a href="advanced-r.html#cb100-6"></a><span class="co">## [1] 18353</span></span>
<span id="cb100-7"><a href="advanced-r.html#cb100-7"></a><span class="co">## [1] 18354</span></span></code></pre></div>
<p>You can use <code>seq_along()</code> and access the element directly using <code>[[</code> to avoid droping attributes:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="advanced-r.html#cb101-1"></a>v &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&#39;2020-04-01&#39;</span>,<span class="st">&#39;2020-04-02&#39;</span>))</span>
<span id="cb101-2"><a href="advanced-r.html#cb101-2"></a></span>
<span id="cb101-3"><a href="advanced-r.html#cb101-3"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(v)){</span>
<span id="cb101-4"><a href="advanced-r.html#cb101-4"></a>  <span class="kw">print</span>(v[[i]])</span>
<span id="cb101-5"><a href="advanced-r.html#cb101-5"></a>}</span>
<span id="cb101-6"><a href="advanced-r.html#cb101-6"></a><span class="co">## [1] &quot;2020-04-01&quot;</span></span>
<span id="cb101-7"><a href="advanced-r.html#cb101-7"></a><span class="co">## [1] &quot;2020-04-02&quot;</span></span></code></pre></div>
<div id="other-loops" class="section level5" number="1.1.4.2.1">
<h5 number="1.1.4.2.1"><span class="header-section-number">1.1.4.2.1</span> Other loops</h5>
<p>Other loops in R:</p>
<ul>
<li><code>while (condition) do_action</code>: this is more flexible than loops because you don’t have to know the
length of the vector apriori.</li>
<li><code>repeat(do_action)</code>: where do_action repeats forever until it encounters <code>break</code></li>
</ul>

</div>
</div>
</div>
<div id="arfunc" class="section level3" number="1.1.5">
<h3 number="1.1.5"><span class="header-section-number">1.1.5</span> Functions</h3>
<p>Functions are first-class objects in R you create with <code>function()</code>. They can be bound to a name or
left anonymous; and have three components:</p>
<div id="function-components" class="section level4" number="1.1.5.1">
<h4 number="1.1.5.1"><span class="header-section-number">1.1.5.1</span> Function Components</h4>
<ol style="list-style-type: decimal">
<li>Arguments: <code>formals()</code> are arguments passed to the function that determine how it is called</li>
<li>Body: <code>body()</code> the code being called</li>
<li>Environment: <code>environment()</code> a data structure that determines how R finds bound values within the function</li>
</ol>
<p>Arguments and body are always specified explicitly in the function, and environment is implicitly specified based
on <em>where</em> you define the function.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="advanced-r.html#cb102-1"></a></span>
<span id="cb102-2"><a href="advanced-r.html#cb102-2"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, z){</span>
<span id="cb102-3"><a href="advanced-r.html#cb102-3"></a>  <span class="co"># comment within the function</span></span>
<span id="cb102-4"><a href="advanced-r.html#cb102-4"></a>  x <span class="op">+</span><span class="st"> </span>y <span class="op">+</span><span class="st"> </span>z</span>
<span id="cb102-5"><a href="advanced-r.html#cb102-5"></a>}</span>
<span id="cb102-6"><a href="advanced-r.html#cb102-6"></a></span>
<span id="cb102-7"><a href="advanced-r.html#cb102-7"></a><span class="co"># to see the arguments</span></span>
<span id="cb102-8"><a href="advanced-r.html#cb102-8"></a><span class="kw">formals</span>(f)</span>
<span id="cb102-9"><a href="advanced-r.html#cb102-9"></a><span class="co">## $x</span></span>
<span id="cb102-10"><a href="advanced-r.html#cb102-10"></a><span class="co">## </span></span>
<span id="cb102-11"><a href="advanced-r.html#cb102-11"></a><span class="co">## </span></span>
<span id="cb102-12"><a href="advanced-r.html#cb102-12"></a><span class="co">## $y</span></span>
<span id="cb102-13"><a href="advanced-r.html#cb102-13"></a><span class="co">## </span></span>
<span id="cb102-14"><a href="advanced-r.html#cb102-14"></a><span class="co">## </span></span>
<span id="cb102-15"><a href="advanced-r.html#cb102-15"></a><span class="co">## $z</span></span>
<span id="cb102-16"><a href="advanced-r.html#cb102-16"></a></span>
<span id="cb102-17"><a href="advanced-r.html#cb102-17"></a><span class="co"># to see the body</span></span>
<span id="cb102-18"><a href="advanced-r.html#cb102-18"></a><span class="kw">body</span>(f)</span>
<span id="cb102-19"><a href="advanced-r.html#cb102-19"></a><span class="co">## {</span></span>
<span id="cb102-20"><a href="advanced-r.html#cb102-20"></a><span class="co">##     x + y + z</span></span>
<span id="cb102-21"><a href="advanced-r.html#cb102-21"></a><span class="co">## }</span></span>
<span id="cb102-22"><a href="advanced-r.html#cb102-22"></a></span>
<span id="cb102-23"><a href="advanced-r.html#cb102-23"></a><span class="co"># to see the environment</span></span>
<span id="cb102-24"><a href="advanced-r.html#cb102-24"></a><span class="kw">environment</span>(f)</span>
<span id="cb102-25"><a href="advanced-r.html#cb102-25"></a><span class="co">## &lt;environment: R_GlobalEnv&gt;</span></span></code></pre></div>
<p>Because functions are objects, they can have attributes just like vectors. Base R functions have
attribute <code>srcref</code>, which points to the source code of the function. It is more compact for printing
and includes things like comments. Use <code>attr()</code>, or, simply, the name of the function, i.e. without calling the function using <code>(</code>:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="advanced-r.html#cb103-1"></a>{</span>
<span id="cb103-2"><a href="advanced-r.html#cb103-2"></a>  <span class="kw">attr</span>(f, <span class="dt">which =</span> <span class="st">&#39;srcref&#39;</span>)</span>
<span id="cb103-3"><a href="advanced-r.html#cb103-3"></a>  f</span>
<span id="cb103-4"><a href="advanced-r.html#cb103-4"></a>  }</span>
<span id="cb103-5"><a href="advanced-r.html#cb103-5"></a><span class="co">## function(x, y, z){</span></span>
<span id="cb103-6"><a href="advanced-r.html#cb103-6"></a><span class="co">##   # comment within the function</span></span>
<span id="cb103-7"><a href="advanced-r.html#cb103-7"></a><span class="co">##   x + y + z</span></span>
<span id="cb103-8"><a href="advanced-r.html#cb103-8"></a><span class="co">## }</span></span></code></pre></div>
</div>
<div id="primitives" class="section level4" number="1.1.5.2">
<h4 number="1.1.5.2"><span class="header-section-number">1.1.5.2</span> Primitives</h4>
<p>Some base R functions like <code>sum()</code>/<code>[</code> are “primitive functions”, meaning they are written in C for
speed:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="advanced-r.html#cb104-1"></a><span class="st">`</span><span class="dt">[</span><span class="st">`</span></span>
<span id="cb104-2"><a href="advanced-r.html#cb104-2"></a><span class="co">## .Primitive(&quot;[&quot;)</span></span>
<span id="cb104-3"><a href="advanced-r.html#cb104-3"></a></span>
<span id="cb104-4"><a href="advanced-r.html#cb104-4"></a>sum</span>
<span id="cb104-5"><a href="advanced-r.html#cb104-5"></a><span class="co">## function (..., na.rm = FALSE)  .Primitive(&quot;sum&quot;)</span></span></code></pre></div>
</div>
<div id="anonymous-functions-and-closures" class="section level4" number="1.1.5.3">
<h4 number="1.1.5.3"><span class="header-section-number">1.1.5.3</span> Anonymous functions and Closures</h4>
<p>Functions without binding names are called anonymous functions:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="advanced-r.html#cb105-1"></a><span class="co"># lapply calls a function on each element of a list. In this case each element is a </span></span>
<span id="cb105-2"><a href="advanced-r.html#cb105-2"></a><span class="co"># vector in a data frame. The anonymous function uses control flow to sum each vector</span></span>
<span id="cb105-3"><a href="advanced-r.html#cb105-3"></a><span class="co"># if it is numeric.</span></span>
<span id="cb105-4"><a href="advanced-r.html#cb105-4"></a><span class="kw">lapply</span>(iris, <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="kw">is.numeric</span>(x)) <span class="kw">sum</span>(x))</span>
<span id="cb105-5"><a href="advanced-r.html#cb105-5"></a><span class="co">## $Sepal.Length</span></span>
<span id="cb105-6"><a href="advanced-r.html#cb105-6"></a><span class="co">## [1] 876.5</span></span>
<span id="cb105-7"><a href="advanced-r.html#cb105-7"></a><span class="co">## </span></span>
<span id="cb105-8"><a href="advanced-r.html#cb105-8"></a><span class="co">## $Sepal.Width</span></span>
<span id="cb105-9"><a href="advanced-r.html#cb105-9"></a><span class="co">## [1] 458.6</span></span>
<span id="cb105-10"><a href="advanced-r.html#cb105-10"></a><span class="co">## </span></span>
<span id="cb105-11"><a href="advanced-r.html#cb105-11"></a><span class="co">## $Petal.Length</span></span>
<span id="cb105-12"><a href="advanced-r.html#cb105-12"></a><span class="co">## [1] 563.7</span></span>
<span id="cb105-13"><a href="advanced-r.html#cb105-13"></a><span class="co">## </span></span>
<span id="cb105-14"><a href="advanced-r.html#cb105-14"></a><span class="co">## $Petal.Width</span></span>
<span id="cb105-15"><a href="advanced-r.html#cb105-15"></a><span class="co">## [1] 179.9</span></span>
<span id="cb105-16"><a href="advanced-r.html#cb105-16"></a><span class="co">## </span></span>
<span id="cb105-17"><a href="advanced-r.html#cb105-17"></a><span class="co">## $Species</span></span>
<span id="cb105-18"><a href="advanced-r.html#cb105-18"></a><span class="co">## NULL</span></span></code></pre></div>
<p>In R you will often see functions referred to as <strong>closures</strong> because they enclose
their environment. e.g. a binding within the function environment is not available
globally.</p>
</div>
<div id="invoking-functions" class="section level4" number="1.1.5.4">
<h4 number="1.1.5.4"><span class="header-section-number">1.1.5.4</span> Invoking functions</h4>
<p>Functions are invoked by enclosing arguments withing <code>(</code> following the function
binding (e.g. <code>sum(x)</code>).</p>
<p>However, if you have the function arguments in a list you can envoke the function
using <code>do.call()</code>:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="advanced-r.html#cb106-1"></a><span class="kw">do.call</span>(<span class="dt">what =</span> rep, <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">each =</span> <span class="dv">2</span>))</span>
<span id="cb106-2"><a href="advanced-r.html#cb106-2"></a><span class="co">## [1] 1 1 2 2 3 3</span></span></code></pre></div>
</div>
<div id="function-composition" class="section level4" number="1.1.5.5">
<h4 number="1.1.5.5"><span class="header-section-number">1.1.5.5</span> Function Composition</h4>
<p>There are three ways to compose function transformations:</p>
<ol style="list-style-type: decimal">
<li>Nesting: <code>function_b(function_a(x, y), z)</code></li>
</ol>
<p>Functions are nested and the result of the inner function informs an
argument of the outer. This can be difficult to read, inside-out, right-to-left,
and can spread agruments away from the name being called.</p>
<ol start="2" style="list-style-type: decimal">
<li>Intermediate objects: <code>{result &lt;- function_a(x, y); result &lt;- function_b(result, z)}</code></li>
</ol>
<p>With intermediate objects the function results are saved to a common binding. This is more
verbose and a weakness when the results are truly temporary.</p>
<ol start="3" style="list-style-type: decimal">
<li>Pipes: <code>x %&gt;% function_a(y) %&gt;% function_b(z)</code></li>
</ol>
<p>Pipes are a way to pass objects into the first argument of a function. <code>x %&gt;% f()</code> is
equivelant to <code>f(x)</code>, so <code>x %&gt;% f(y)</code> is equivelant to <code>f(x, y)</code>. This is analogous
to treating an object as a noun and functions as verbs, allowing you to write linear
chains left-to-right, similar to F# and Haskell. Data analysis workflows are often
multiple linear transformations of the same object, e.g. a dataframe.</p>
</div>
<div id="lexical-scoping" class="section level4" number="1.1.5.6">
<h4 number="1.1.5.6"><span class="header-section-number">1.1.5.6</span> Lexical scoping</h4>
<p><strong>Scoping</strong> is how a program finds the value associated with a name. R uses
<em><em>lexical</em></em> scoping, which means the scoping rules are parse-time<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> rather than run-time.</p>
<p>Lexical scoping follows the following four rules:</p>
<div id="name-masking" class="section level5" number="1.1.5.6.1">
<h5 number="1.1.5.6.1"><span class="header-section-number">1.1.5.6.1</span> Name masking</h5>
<p>With lexical scoping names defined within a function mask values found outside of
that environment. R will look one level up to find the value if not defined in the
environment. One level up could mean an outer function, the global environment, or,
finally, any loaded packages.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="advanced-r.html#cb107-1"></a><span class="co"># bind x, y, z in the global environment</span></span>
<span id="cb107-2"><a href="advanced-r.html#cb107-2"></a>x &lt;-<span class="st"> </span><span class="dv">1</span>; y &lt;-<span class="st"> </span><span class="dv">2</span>; z &lt;-<span class="st"> </span><span class="dv">3</span></span>
<span id="cb107-3"><a href="advanced-r.html#cb107-3"></a></span>
<span id="cb107-4"><a href="advanced-r.html#cb107-4"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb107-5"><a href="advanced-r.html#cb107-5"></a>  <span class="co"># bind y, z within the environment for f</span></span>
<span id="cb107-6"><a href="advanced-r.html#cb107-6"></a>  y &lt;-<span class="st"> </span><span class="dv">20</span>; z &lt;-<span class="st"> </span></span>
<span id="cb107-7"><a href="advanced-r.html#cb107-7"></a><span class="st">    </span></span>
<span id="cb107-8"><a href="advanced-r.html#cb107-8"></a><span class="st">  </span>f2 &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb107-9"><a href="advanced-r.html#cb107-9"></a>    <span class="co"># bind z within the environment for f2</span></span>
<span id="cb107-10"><a href="advanced-r.html#cb107-10"></a>    z &lt;-<span class="st"> </span><span class="dv">300</span></span>
<span id="cb107-11"><a href="advanced-r.html#cb107-11"></a>    </span>
<span id="cb107-12"><a href="advanced-r.html#cb107-12"></a>    <span class="co"># return a vector containing each variable</span></span>
<span id="cb107-13"><a href="advanced-r.html#cb107-13"></a>    <span class="kw">c</span>(x, y, z)</span>
<span id="cb107-14"><a href="advanced-r.html#cb107-14"></a>  }</span>
<span id="cb107-15"><a href="advanced-r.html#cb107-15"></a>  </span>
<span id="cb107-16"><a href="advanced-r.html#cb107-16"></a>  <span class="co"># return f2</span></span>
<span id="cb107-17"><a href="advanced-r.html#cb107-17"></a>  <span class="kw">f2</span>()</span>
<span id="cb107-18"><a href="advanced-r.html#cb107-18"></a>}</span>
<span id="cb107-19"><a href="advanced-r.html#cb107-19"></a></span>
<span id="cb107-20"><a href="advanced-r.html#cb107-20"></a><span class="kw">f</span>()</span>
<span id="cb107-21"><a href="advanced-r.html#cb107-21"></a><span class="co">## [1]   1  20 300</span></span></code></pre></div>
</div>
<div id="functions-vs-variables" class="section level5" number="1.1.5.6.2">
<h5 number="1.1.5.6.2"><span class="header-section-number">1.1.5.6.2</span> Functions vs variables</h5>
<p>Just as with variables, functions can mask other functions:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="advanced-r.html#cb108-1"></a><span class="co"># bind f in the global environment</span></span>
<span id="cb108-2"><a href="advanced-r.html#cb108-2"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>() <span class="dv">1</span></span>
<span id="cb108-3"><a href="advanced-r.html#cb108-3"></a></span>
<span id="cb108-4"><a href="advanced-r.html#cb108-4"></a>f2 &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb108-5"><a href="advanced-r.html#cb108-5"></a>  <span class="co"># bind f in the funciton environment</span></span>
<span id="cb108-6"><a href="advanced-r.html#cb108-6"></a>  f &lt;-<span class="st"> </span><span class="cf">function</span>() <span class="dv">100</span></span>
<span id="cb108-7"><a href="advanced-r.html#cb108-7"></a>  </span>
<span id="cb108-8"><a href="advanced-r.html#cb108-8"></a>  <span class="co"># return f</span></span>
<span id="cb108-9"><a href="advanced-r.html#cb108-9"></a>  <span class="kw">f</span>()</span>
<span id="cb108-10"><a href="advanced-r.html#cb108-10"></a>}</span>
<span id="cb108-11"><a href="advanced-r.html#cb108-11"></a></span>
<span id="cb108-12"><a href="advanced-r.html#cb108-12"></a><span class="kw">f2</span>()</span>
<span id="cb108-13"><a href="advanced-r.html#cb108-13"></a><span class="co">## [1] 100</span></span></code></pre></div>
<p>It is possible, in two different environments, for a variable and function to share
the same name. How R scopes these values becomes more complex, because, in a function
call (e.g.<code>f()</code>) R will ignore non-function objects when scoping that name. So it is
possible for a name to represent more than one value. This is confusing and is best
avoided.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="advanced-r.html#cb109-1"></a><span class="co"># bind f a function in the global environment</span></span>
<span id="cb109-2"><a href="advanced-r.html#cb109-2"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x) x</span>
<span id="cb109-3"><a href="advanced-r.html#cb109-3"></a></span>
<span id="cb109-4"><a href="advanced-r.html#cb109-4"></a>f2 &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb109-5"><a href="advanced-r.html#cb109-5"></a>  <span class="co"># bind f a scalar</span></span>
<span id="cb109-6"><a href="advanced-r.html#cb109-6"></a>  f &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb109-7"><a href="advanced-r.html#cb109-7"></a>  </span>
<span id="cb109-8"><a href="advanced-r.html#cb109-8"></a>  <span class="co"># f represents both a variable and a function when calling f() because f() specifically </span></span>
<span id="cb109-9"><a href="advanced-r.html#cb109-9"></a>  <span class="co"># scopes for function objects only</span></span>
<span id="cb109-10"><a href="advanced-r.html#cb109-10"></a>  <span class="kw">f</span>(f)</span>
<span id="cb109-11"><a href="advanced-r.html#cb109-11"></a>}</span>
<span id="cb109-12"><a href="advanced-r.html#cb109-12"></a></span>
<span id="cb109-13"><a href="advanced-r.html#cb109-13"></a><span class="kw">f2</span>()</span>
<span id="cb109-14"><a href="advanced-r.html#cb109-14"></a><span class="co">## [1] 100</span></span></code></pre></div>
</div>
<div id="variable-lifespan" class="section level5" number="1.1.5.6.3">
<h5 number="1.1.5.6.3"><span class="header-section-number">1.1.5.6.3</span> Variable lifespan</h5>
<p>Objects defined wihtin the environment of a function only exist while the
function is invoked:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="advanced-r.html#cb110-1"></a><span class="co"># create a function either to instantiate a scalar integer or add to it</span></span>
<span id="cb110-2"><a href="advanced-r.html#cb110-2"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb110-3"><a href="advanced-r.html#cb110-3"></a>  <span class="cf">if</span> (<span class="op">!</span><span class="kw">exists</span>(<span class="st">&quot;a&quot;</span>)){</span>
<span id="cb110-4"><a href="advanced-r.html#cb110-4"></a>    a &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb110-5"><a href="advanced-r.html#cb110-5"></a>  }<span class="cf">else</span>{</span>
<span id="cb110-6"><a href="advanced-r.html#cb110-6"></a>    a &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb110-7"><a href="advanced-r.html#cb110-7"></a>  }</span>
<span id="cb110-8"><a href="advanced-r.html#cb110-8"></a>  </span>
<span id="cb110-9"><a href="advanced-r.html#cb110-9"></a>  a</span>
<span id="cb110-10"><a href="advanced-r.html#cb110-10"></a>}</span>
<span id="cb110-11"><a href="advanced-r.html#cb110-11"></a></span>
<span id="cb110-12"><a href="advanced-r.html#cb110-12"></a><span class="co"># both function calls return 1 because environment variables in the function are </span></span>
<span id="cb110-13"><a href="advanced-r.html#cb110-13"></a><span class="co"># rewritten at each function call</span></span>
<span id="cb110-14"><a href="advanced-r.html#cb110-14"></a><span class="kw">f</span>()</span>
<span id="cb110-15"><a href="advanced-r.html#cb110-15"></a><span class="co">## [1] 1</span></span>
<span id="cb110-16"><a href="advanced-r.html#cb110-16"></a><span class="kw">f</span>()</span>
<span id="cb110-17"><a href="advanced-r.html#cb110-17"></a><span class="co">## [1] 1</span></span></code></pre></div>
</div>
<div id="dynamic-lookup" class="section level5" number="1.1.5.6.4">
<h5 number="1.1.5.6.4"><span class="header-section-number">1.1.5.6.4</span> Dynamic lookup</h5>
<p>Lexical scoping determines where, but not when, a value is retrieved. This can
change the value a function returns because R does not scope the object until
it is called:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="advanced-r.html#cb111-1"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb111-2"><a href="advanced-r.html#cb111-2"></a>  x <span class="op">*</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb111-3"><a href="advanced-r.html#cb111-3"></a>}</span>
<span id="cb111-4"><a href="advanced-r.html#cb111-4"></a></span>
<span id="cb111-5"><a href="advanced-r.html#cb111-5"></a>x &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb111-6"><a href="advanced-r.html#cb111-6"></a></span>
<span id="cb111-7"><a href="advanced-r.html#cb111-7"></a><span class="kw">f</span>()</span>
<span id="cb111-8"><a href="advanced-r.html#cb111-8"></a><span class="co">## [1] 2</span></span>
<span id="cb111-9"><a href="advanced-r.html#cb111-9"></a></span>
<span id="cb111-10"><a href="advanced-r.html#cb111-10"></a>x &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb111-11"><a href="advanced-r.html#cb111-11"></a></span>
<span id="cb111-12"><a href="advanced-r.html#cb111-12"></a><span class="kw">f</span>()</span>
<span id="cb111-13"><a href="advanced-r.html#cb111-13"></a><span class="co">## [1] 4</span></span></code></pre></div>
<p><code>codetools::findGlobals()</code> can be used to find names in a function that are
externally unbound.</p>
<p>R uses lexical scoping to find <em>everything</em>, including objects that may not be
obvious like <code>+</code> and <code>[</code>.</p>
</div>
</div>
<div id="lazy-evaluation" class="section level4" number="1.1.5.7">
<h4 number="1.1.5.7"><span class="header-section-number">1.1.5.7</span> Lazy evaluation</h4>
<p>R does not compute an expression until it is needed. This is called <em>lazy evaluation</em>:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="advanced-r.html#cb112-1"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb112-2"><a href="advanced-r.html#cb112-2"></a>  <span class="kw">message</span>(<span class="st">&quot;The function doesn&#39;t stop because x is not used in f().&quot;</span>)</span>
<span id="cb112-3"><a href="advanced-r.html#cb112-3"></a>}</span>
<span id="cb112-4"><a href="advanced-r.html#cb112-4"></a></span>
<span id="cb112-5"><a href="advanced-r.html#cb112-5"></a><span class="kw">f</span>(<span class="kw">stop</span>(<span class="st">&#39;Let me outa here!&#39;</span>))</span>
<span id="cb112-6"><a href="advanced-r.html#cb112-6"></a><span class="co">## The function doesn&#39;t stop because x is not used in f().</span></span></code></pre></div>
<div id="promises" class="section level5" number="1.1.5.7.1">
<h5 number="1.1.5.7.1"><span class="header-section-number">1.1.5.7.1</span> Promises</h5>
<p>Lazy evaluation is powered by a data structure called a promise, which has
three components: the expression (e.g. <code>x + y</code>), an environment, and a value
(which is cached and calculated only once).</p>
</div>
<div id="default-arguments" class="section level5" number="1.1.5.7.2">
<h5 number="1.1.5.7.2"><span class="header-section-number">1.1.5.7.2</span> Default arguments</h5>
<p>You can use lazy evaluation to pass default arguments or reference variables
later defined in the function. This is common in base R. However, this can be
confusing because
<em>variables in the function call are otherwise scoped outside the function environment</em>.</p>
<p>For example, <code>a</code> and <code>b</code> are not scoped from the global environment (<code>1e6</code>) because we reference
them as variables in the <strong>default argument</strong> <code>z</code>. Also, default arguments can reference
other default arguments (see <code>x</code>), even if later defined in the function (<code>a</code> and <code>b</code>):</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="advanced-r.html#cb113-1"></a><span class="co"># a &amp; b are defined in the global environment</span></span>
<span id="cb113-2"><a href="advanced-r.html#cb113-2"></a>a &lt;-<span class="st"> </span><span class="fl">1e6</span></span>
<span id="cb113-3"><a href="advanced-r.html#cb113-3"></a>b &lt;-<span class="st"> </span><span class="fl">1e6</span></span>
<span id="cb113-4"><a href="advanced-r.html#cb113-4"></a></span>
<span id="cb113-5"><a href="advanced-r.html#cb113-5"></a><span class="co"># use = to define the default argument</span></span>
<span id="cb113-6"><a href="advanced-r.html#cb113-6"></a><span class="co"># default arguments can reference other arguments, even if defined later in the function</span></span>
<span id="cb113-7"><a href="advanced-r.html#cb113-7"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x, <span class="dt">z =</span> a <span class="op">*</span><span class="st"> </span>b){</span>
<span id="cb113-8"><a href="advanced-r.html#cb113-8"></a>  a &lt;-<span class="st"> </span><span class="dv">3</span></span>
<span id="cb113-9"><a href="advanced-r.html#cb113-9"></a>  b &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb113-10"><a href="advanced-r.html#cb113-10"></a>  </span>
<span id="cb113-11"><a href="advanced-r.html#cb113-11"></a>  <span class="kw">c</span>(x, y, z)</span>
<span id="cb113-12"><a href="advanced-r.html#cb113-12"></a>}</span>
<span id="cb113-13"><a href="advanced-r.html#cb113-13"></a></span>
<span id="cb113-14"><a href="advanced-r.html#cb113-14"></a><span class="kw">f</span>()</span>
<span id="cb113-15"><a href="advanced-r.html#cb113-15"></a><span class="co">## [1] 1 2 3</span></span></code></pre></div>
</div>
<div id="missing-arguments" class="section level5" number="1.1.5.7.3">
<h5 number="1.1.5.7.3"><span class="header-section-number">1.1.5.7.3</span> Missing arguments</h5>
<p><code>missing()</code> can tell you if an argument was given by the user or was default:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="advanced-r.html#cb114-1"></a></span>
<span id="cb114-2"><a href="advanced-r.html#cb114-2"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> <span class="dv">1</span>){</span>
<span id="cb114-3"><a href="advanced-r.html#cb114-3"></a>  <span class="kw">missing</span>(x)</span>
<span id="cb114-4"><a href="advanced-r.html#cb114-4"></a>}</span>
<span id="cb114-5"><a href="advanced-r.html#cb114-5"></a></span>
<span id="cb114-6"><a href="advanced-r.html#cb114-6"></a><span class="co"># TRUE; x was missing and the default value used</span></span>
<span id="cb114-7"><a href="advanced-r.html#cb114-7"></a><span class="kw">f</span>()</span>
<span id="cb114-8"><a href="advanced-r.html#cb114-8"></a><span class="co">## [1] TRUE</span></span>
<span id="cb114-9"><a href="advanced-r.html#cb114-9"></a><span class="co"># FALSE; x was given to the function call</span></span>
<span id="cb114-10"><a href="advanced-r.html#cb114-10"></a><span class="kw">f</span>(<span class="dv">1</span>)</span>
<span id="cb114-11"><a href="advanced-r.html#cb114-11"></a><span class="co">## [1] FALSE</span></span></code></pre></div>
<p>Read <code>?missing()</code> carefully because there are a lot of “gotchas” with <code>missing()</code>
in base R. For example, read <code>sample</code>–<code>sample()</code> will assign a value for argument
<code>size</code> even though it has no default argument.</p>
<div id="infix-function" class="section level6" number="1.1.5.7.3.1">
<h6 number="1.1.5.7.3.1"><span class="header-section-number">1.1.5.7.3.1</span> <code>%||%</code> infix function</h6>
<p>This common pattern, <code>if (missing(x)) x &lt;- object</code>, in base R functions can be simplified by the <code>%||%</code> infix function from rlang. Instead of pretending an argument is required, set the default argument
to <code>NULL</code>:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="advanced-r.html#cb115-1"></a><span class="kw">library</span>(rlang)</span>
<span id="cb115-2"><a href="advanced-r.html#cb115-2"></a><span class="co">## Warning: package &#39;rlang&#39; was built under R version 3.6.3</span></span>
<span id="cb115-3"><a href="advanced-r.html#cb115-3"></a></span>
<span id="cb115-4"><a href="advanced-r.html#cb115-4"></a><span class="co"># %||% is relatively simple; if left side is NULL return right side else return left side</span></span>
<span id="cb115-5"><a href="advanced-r.html#cb115-5"></a><span class="cf">function</span> (x, y) </span>
<span id="cb115-6"><a href="advanced-r.html#cb115-6"></a>{</span>
<span id="cb115-7"><a href="advanced-r.html#cb115-7"></a>    <span class="cf">if</span> (<span class="kw">is_null</span>(x)) </span>
<span id="cb115-8"><a href="advanced-r.html#cb115-8"></a>        y</span>
<span id="cb115-9"><a href="advanced-r.html#cb115-9"></a>    <span class="cf">else</span> x</span>
<span id="cb115-10"><a href="advanced-r.html#cb115-10"></a>}</span>
<span id="cb115-11"><a href="advanced-r.html#cb115-11"></a><span class="co">## function (x, y) </span></span>
<span id="cb115-12"><a href="advanced-r.html#cb115-12"></a><span class="co">## {</span></span>
<span id="cb115-13"><a href="advanced-r.html#cb115-13"></a><span class="co">##     if (is_null(x)) </span></span>
<span id="cb115-14"><a href="advanced-r.html#cb115-14"></a><span class="co">##         y</span></span>
<span id="cb115-15"><a href="advanced-r.html#cb115-15"></a><span class="co">##     else x</span></span>
<span id="cb115-16"><a href="advanced-r.html#cb115-16"></a><span class="co">## }</span></span>
<span id="cb115-17"><a href="advanced-r.html#cb115-17"></a></span>
<span id="cb115-18"><a href="advanced-r.html#cb115-18"></a><span class="co"># in this example, it&#39;s explicit x is optional and control flow is concise if NULL</span></span>
<span id="cb115-19"><a href="advanced-r.html#cb115-19"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> <span class="ot">NULL</span>){</span>
<span id="cb115-20"><a href="advanced-r.html#cb115-20"></a>  x <span class="op">%||%</span><span class="st"> </span><span class="dv">7</span></span>
<span id="cb115-21"><a href="advanced-r.html#cb115-21"></a>}</span>
<span id="cb115-22"><a href="advanced-r.html#cb115-22"></a></span>
<span id="cb115-23"><a href="advanced-r.html#cb115-23"></a><span class="kw">f</span>()</span>
<span id="cb115-24"><a href="advanced-r.html#cb115-24"></a><span class="co">## [1] 7</span></span></code></pre></div>
</div>
</div>
</div>
<div id="dot-dot-dot" class="section level4" number="1.1.5.8">
<h4 number="1.1.5.8"><span class="header-section-number">1.1.5.8</span> <code>...</code> (dot-dot-dot)</h4>
<p><code>...</code> in other languages is often called <em>varargs</em> (variable arguments). In R it’s
called “dots”. It allows functions to take any number of additional arguments:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="advanced-r.html#cb116-1"></a><span class="co"># f only takes 3 arguments, so calling with 4 returns an error</span></span>
<span id="cb116-2"><a href="advanced-r.html#cb116-2"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, z){</span>
<span id="cb116-3"><a href="advanced-r.html#cb116-3"></a>  <span class="kw">c</span>(x,y,z)</span>
<span id="cb116-4"><a href="advanced-r.html#cb116-4"></a>}</span>
<span id="cb116-5"><a href="advanced-r.html#cb116-5"></a></span>
<span id="cb116-6"><a href="advanced-r.html#cb116-6"></a><span class="kw">f</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb116-7"><a href="advanced-r.html#cb116-7"></a><span class="co">## Error in f(1, 2, 3, 4): unused argument (4)</span></span>
<span id="cb116-8"><a href="advanced-r.html#cb116-8"></a></span>
<span id="cb116-9"><a href="advanced-r.html#cb116-9"></a><span class="co"># ... allows you to pass more arguments</span></span>
<span id="cb116-10"><a href="advanced-r.html#cb116-10"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, z, ...){</span>
<span id="cb116-11"><a href="advanced-r.html#cb116-11"></a>  <span class="kw">c</span>(x,y,z)</span>
<span id="cb116-12"><a href="advanced-r.html#cb116-12"></a>}</span>
<span id="cb116-13"><a href="advanced-r.html#cb116-13"></a></span>
<span id="cb116-14"><a href="advanced-r.html#cb116-14"></a><span class="kw">f</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb116-15"><a href="advanced-r.html#cb116-15"></a><span class="co">## [1] 1 2 3</span></span></code></pre></div>
<p>When creating a <a href="advanced-r.html#arfunctionals">functional</a> and passing dots use <code>...</code> in the sub-functions
requiring them:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="advanced-r.html#cb117-1"></a><span class="co"># create functional to return aggregate of random samples from a distribution (rnorm, runif, rt etc)</span></span>
<span id="cb117-2"><a href="advanced-r.html#cb117-2"></a>functional &lt;-<span class="st"> </span><span class="cf">function</span>(f, distr, ... ){</span>
<span id="cb117-3"><a href="advanced-r.html#cb117-3"></a>  <span class="kw">f</span>(<span class="kw">distr</span>(...))</span>
<span id="cb117-4"><a href="advanced-r.html#cb117-4"></a>}</span>
<span id="cb117-5"><a href="advanced-r.html#cb117-5"></a></span>
<span id="cb117-6"><a href="advanced-r.html#cb117-6"></a><span class="kw">functional</span>(<span class="dt">f =</span> sum, </span>
<span id="cb117-7"><a href="advanced-r.html#cb117-7"></a>           <span class="dt">distr =</span> rnorm, </span>
<span id="cb117-8"><a href="advanced-r.html#cb117-8"></a>           <span class="dt">n =</span> <span class="dv">100</span>, </span>
<span id="cb117-9"><a href="advanced-r.html#cb117-9"></a>           <span class="dt">mean =</span> <span class="dv">7</span>, </span>
<span id="cb117-10"><a href="advanced-r.html#cb117-10"></a>           <span class="dt">sd =</span> <span class="dv">2</span>)</span>
<span id="cb117-11"><a href="advanced-r.html#cb117-11"></a><span class="co">## [1] 678.5773</span></span></code></pre></div>
<p>The primary use of <code>...</code> is to pass additional arguments to other functions or methods. For example,
<code>lapply()</code> applys a function over each element of a list. In this case, I’m using the <code>...</code>
argument of <code>lapply()</code> to pass the <code>trim</code> argument to <code>mean()</code>:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="advanced-r.html#cb118-1"></a><span class="kw">lapply</span>(<span class="dt">X =</span> mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">FUN =</span> mean, <span class="dt">trim =</span> <span class="fl">.25</span>)</span>
<span id="cb118-2"><a href="advanced-r.html#cb118-2"></a><span class="co">## $mpg</span></span>
<span id="cb118-3"><a href="advanced-r.html#cb118-3"></a><span class="co">## [1] 19.175</span></span>
<span id="cb118-4"><a href="advanced-r.html#cb118-4"></a><span class="co">## </span></span>
<span id="cb118-5"><a href="advanced-r.html#cb118-5"></a><span class="co">## $cyl</span></span>
<span id="cb118-6"><a href="advanced-r.html#cb118-6"></a><span class="co">## [1] 6.375</span></span></code></pre></div>
<p>It is possible to use <code>..N</code> to specify the position of the additional arguments:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="advanced-r.html#cb119-1"></a><span class="co"># this function returns the first three additional arguments in reverse order</span></span>
<span id="cb119-2"><a href="advanced-r.html#cb119-2"></a>f &lt;-<span class="cf">function</span>(...){</span>
<span id="cb119-3"><a href="advanced-r.html#cb119-3"></a>  <span class="kw">c</span>(..<span class="dv">3</span>, ..<span class="dv">2</span>, ..<span class="dv">1</span>)</span>
<span id="cb119-4"><a href="advanced-r.html#cb119-4"></a>}</span>
<span id="cb119-5"><a href="advanced-r.html#cb119-5"></a></span>
<span id="cb119-6"><a href="advanced-r.html#cb119-6"></a><span class="kw">f</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb119-7"><a href="advanced-r.html#cb119-7"></a><span class="co">## [1] 3 2 1</span></span></code></pre></div>
<p>However, it may be more useful to store them in a list:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="advanced-r.html#cb120-1"></a>f &lt;-<span class="cf">function</span>(...){</span>
<span id="cb120-2"><a href="advanced-r.html#cb120-2"></a>  <span class="kw">list</span>(...)</span>
<span id="cb120-3"><a href="advanced-r.html#cb120-3"></a>}</span>
<span id="cb120-4"><a href="advanced-r.html#cb120-4"></a></span>
<span id="cb120-5"><a href="advanced-r.html#cb120-5"></a><span class="co"># a list of the additional arguments (with name if defined)</span></span>
<span id="cb120-6"><a href="advanced-r.html#cb120-6"></a><span class="kw">str</span>(<span class="kw">f</span>(<span class="dt">arg1 =</span> <span class="dv">1</span>, <span class="dt">arg2 =</span> <span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb120-7"><a href="advanced-r.html#cb120-7"></a><span class="co">## List of 3</span></span>
<span id="cb120-8"><a href="advanced-r.html#cb120-8"></a><span class="co">##  $ arg1: num 1</span></span>
<span id="cb120-9"><a href="advanced-r.html#cb120-9"></a><span class="co">##  $ arg2: num 2</span></span>
<span id="cb120-10"><a href="advanced-r.html#cb120-10"></a><span class="co">##  $     : num 3</span></span></code></pre></div>
<p>Beware that misspelled arguments does not raise an error:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="advanced-r.html#cb121-1"></a><span class="co"># mean argument trim is mispelled and therfor silently dropped</span></span>
<span id="cb121-2"><a href="advanced-r.html#cb121-2"></a><span class="kw">lapply</span>(mtcars[<span class="st">&quot;mpg&quot;</span>], mean, <span class="dt">trimm =</span> <span class="fl">.25</span>)</span>
<span id="cb121-3"><a href="advanced-r.html#cb121-3"></a><span class="co">## $mpg</span></span>
<span id="cb121-4"><a href="advanced-r.html#cb121-4"></a><span class="co">## [1] 20.09062</span></span></code></pre></div>
</div>
<div id="exiting-a-function" class="section level4" number="1.1.5.9">
<h4 number="1.1.5.9"><span class="header-section-number">1.1.5.9</span> Exiting a function</h4>
<p>Most functions exit by either returning a value or throwing an error.</p>
<div id="explicit-vs-implicit" class="section level5" number="1.1.5.9.1">
<h5 number="1.1.5.9.1"><span class="header-section-number">1.1.5.9.1</span> Explicit vs implicit</h5>
<p>R will implicitly return the last value encountered, or you can explicitly
define the return with <code>return()</code>:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="advanced-r.html#cb122-1"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb122-2"><a href="advanced-r.html#cb122-2"></a>  x<span class="op">*</span><span class="dv">2</span></span>
<span id="cb122-3"><a href="advanced-r.html#cb122-3"></a>  x</span>
<span id="cb122-4"><a href="advanced-r.html#cb122-4"></a>}</span>
<span id="cb122-5"><a href="advanced-r.html#cb122-5"></a></span>
<span id="cb122-6"><a href="advanced-r.html#cb122-6"></a><span class="kw">f</span>(<span class="dv">1</span>)</span>
<span id="cb122-7"><a href="advanced-r.html#cb122-7"></a><span class="co">## [1] 1</span></span>
<span id="cb122-8"><a href="advanced-r.html#cb122-8"></a></span>
<span id="cb122-9"><a href="advanced-r.html#cb122-9"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb122-10"><a href="advanced-r.html#cb122-10"></a>  <span class="kw">return</span>(x<span class="op">*</span><span class="dv">2</span>)</span>
<span id="cb122-11"><a href="advanced-r.html#cb122-11"></a>  x</span>
<span id="cb122-12"><a href="advanced-r.html#cb122-12"></a>}</span>
<span id="cb122-13"><a href="advanced-r.html#cb122-13"></a></span>
<span id="cb122-14"><a href="advanced-r.html#cb122-14"></a><span class="kw">f</span>(<span class="dv">1</span>)</span>
<span id="cb122-15"><a href="advanced-r.html#cb122-15"></a><span class="co">## [1] 2</span></span></code></pre></div>
</div>
<div id="visible-vs-invisible" class="section level5" number="1.1.5.9.2">
<h5 number="1.1.5.9.2"><span class="header-section-number">1.1.5.9.2</span> Visible vs invisible</h5>
<p>Functions return values visibly by default (i.e. they get printed); however, you
can turn this off with <code>invisible()</code>. The value still is return, just not printed:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="advanced-r.html#cb123-1"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">invisible</span>(x)</span>
<span id="cb123-2"><a href="advanced-r.html#cb123-2"></a></span>
<span id="cb123-3"><a href="advanced-r.html#cb123-3"></a><span class="kw">f</span>(<span class="dv">2</span>)</span>
<span id="cb123-4"><a href="advanced-r.html#cb123-4"></a></span>
<span id="cb123-5"><a href="advanced-r.html#cb123-5"></a><span class="co"># enclosing with () forces print; showing the value is indeed returned</span></span>
<span id="cb123-6"><a href="advanced-r.html#cb123-6"></a>(<span class="kw">f</span>(<span class="dv">2</span>))</span>
<span id="cb123-7"><a href="advanced-r.html#cb123-7"></a><span class="co">## [1] 2</span></span></code></pre></div>
<p><code>&lt;-</code>, <code>plot()</code>, <code>print()</code> or any function that exists primarily for a side-effect,
the value should be returned invisibly. This is what allows <code>x &lt;- y &lt;- 2</code> type
assignment chaining.</p>
</div>
<div id="errors" class="section level5" number="1.1.5.9.3">
<h5 number="1.1.5.9.3"><span class="header-section-number">1.1.5.9.3</span> Errors</h5>
<p><code>stop()</code> should be used to halt and exit a function if it cannot be completed:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="advanced-r.html#cb124-1"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb124-2"><a href="advanced-r.html#cb124-2"></a>  <span class="cf">if</span> (<span class="kw">is.numeric</span>(x)) </span>
<span id="cb124-3"><a href="advanced-r.html#cb124-3"></a>    <span class="kw">sum</span>(x) </span>
<span id="cb124-4"><a href="advanced-r.html#cb124-4"></a>  <span class="cf">else</span> </span>
<span id="cb124-5"><a href="advanced-r.html#cb124-5"></a>    <span class="kw">stop</span>(<span class="st">&#39;x must be numeric.&#39;</span>)</span>
<span id="cb124-6"><a href="advanced-r.html#cb124-6"></a>}</span>
<span id="cb124-7"><a href="advanced-r.html#cb124-7"></a></span>
<span id="cb124-8"><a href="advanced-r.html#cb124-8"></a><span class="kw">f</span>(<span class="st">&quot;banjos&quot;</span>)</span>
<span id="cb124-9"><a href="advanced-r.html#cb124-9"></a><span class="co">## Error in f(&quot;banjos&quot;): x must be numeric.</span></span></code></pre></div>
</div>
<div id="exit-handlers" class="section level5" number="1.1.5.9.4">
<h5 number="1.1.5.9.4"><span class="header-section-number">1.1.5.9.4</span> Exit handlers</h5>
<p>Sometimes you modify objects in a function which need to be cleaned up whether
the code executes successfully or not. Use <code>on.exit(add = TRUE)</code>:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="advanced-r.html#cb125-1"></a>old_dir &lt;-<span class="st"> </span><span class="kw">getwd</span>()</span>
<span id="cb125-2"><a href="advanced-r.html#cb125-2"></a>old_dir</span>
<span id="cb125-3"><a href="advanced-r.html#cb125-3"></a><span class="co">## [1] &quot;C:/Users/hickmancr/Desktop/ChaseHickman&quot;</span></span>
<span id="cb125-4"><a href="advanced-r.html#cb125-4"></a></span>
<span id="cb125-5"><a href="advanced-r.html#cb125-5"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...){</span>
<span id="cb125-6"><a href="advanced-r.html#cb125-6"></a>  <span class="cf">if</span> (x){</span>
<span id="cb125-7"><a href="advanced-r.html#cb125-7"></a>    <span class="co"># set working directory to one level up</span></span>
<span id="cb125-8"><a href="advanced-r.html#cb125-8"></a>    <span class="kw">setwd</span>(<span class="st">&#39;..&#39;</span>)</span>
<span id="cb125-9"><a href="advanced-r.html#cb125-9"></a>    <span class="co"># reset the original working directory whether the function executes or not</span></span>
<span id="cb125-10"><a href="advanced-r.html#cb125-10"></a>    <span class="kw">on.exit</span>(<span class="kw">setwd</span>(old_dir), <span class="dt">add =</span> <span class="ot">TRUE</span>)</span>
<span id="cb125-11"><a href="advanced-r.html#cb125-11"></a>    </span>
<span id="cb125-12"><a href="advanced-r.html#cb125-12"></a>    <span class="kw">getwd</span>()</span>
<span id="cb125-13"><a href="advanced-r.html#cb125-13"></a>  }<span class="cf">else</span>{</span>
<span id="cb125-14"><a href="advanced-r.html#cb125-14"></a>    <span class="kw">stop</span>(<span class="st">&quot;You&#39;re not my supervisor!&quot;</span>)</span>
<span id="cb125-15"><a href="advanced-r.html#cb125-15"></a>  }</span>
<span id="cb125-16"><a href="advanced-r.html#cb125-16"></a>}</span>
<span id="cb125-17"><a href="advanced-r.html#cb125-17"></a></span>
<span id="cb125-18"><a href="advanced-r.html#cb125-18"></a><span class="kw">f</span>(<span class="ot">FALSE</span>)</span>
<span id="cb125-19"><a href="advanced-r.html#cb125-19"></a><span class="co">## Error in f(FALSE): You&#39;re not my supervisor!</span></span>
<span id="cb125-20"><a href="advanced-r.html#cb125-20"></a></span>
<span id="cb125-21"><a href="advanced-r.html#cb125-21"></a><span class="co"># on.exit() cleaned up the working directory even though the function threw an error</span></span>
<span id="cb125-22"><a href="advanced-r.html#cb125-22"></a><span class="kw">getwd</span>()</span>
<span id="cb125-23"><a href="advanced-r.html#cb125-23"></a><span class="co">## [1] &quot;C:/Users/hickmancr/Desktop/ChaseHickman&quot;</span></span></code></pre></div>
<p><code>on.exit()</code> can be called from anywhere in the function, so it’s helpful to place it
next to the code to be cleaned up.</p>
<p>User <code>after</code> argument to help order the execution of <code>on.exit()</code>.</p>
<p><strong>It’s important to set <code>add = TRUE</code> or each exit handler will overwrite the previous!</strong></p>
</div>
</div>
<div id="function-forms" class="section level4" number="1.1.5.10">
<h4 number="1.1.5.10"><span class="header-section-number">1.1.5.10</span> Function forms</h4>
<p>Every action in R is a function call.</p>
<p>They take four forms:</p>
<ol style="list-style-type: decimal">
<li><em>Prefix</em>: <code>function(x, y)</code> where the name comes before the arguments</li>
<li><em>Infix</em>: <code>x + y</code> where the name comes between the arguments</li>
<li><em>Replacement</em>: <code>function(x) &lt;-</code> updates values by assignment</li>
<li><em>Specials</em>: <code>[[</code>, <code>for</code>, <code>if</code> etc. have non standard structures</li>
</ol>
<p>All functions can be written in <em>prefix</em> form, however (e.g. <code>`+`(x, y)</code>)</p>
<div id="prefix-form" class="section level5" number="1.1.5.10.1">
<h5 number="1.1.5.10.1"><span class="header-section-number">1.1.5.10.1</span> Prefix form</h5>
<p><code>function(x, y)</code> where the name comes before the arguments.</p>
<p>This is the most common function form in R and beyond. Arguments are mached
<em>exact name</em> &gt; <em>unique prefix</em> &gt; <em>position</em>:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="advanced-r.html#cb126-1"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x, yellow, zoo, zoom){</span>
<span id="cb126-2"><a href="advanced-r.html#cb126-2"></a>  l &lt;-<span class="st"> </span><span class="kw">list</span>(x, yellow, zoo, zoom)</span>
<span id="cb126-3"><a href="advanced-r.html#cb126-3"></a>  </span>
<span id="cb126-4"><a href="advanced-r.html#cb126-4"></a>  <span class="kw">str</span>(l)</span>
<span id="cb126-5"><a href="advanced-r.html#cb126-5"></a>}</span>
<span id="cb126-6"><a href="advanced-r.html#cb126-6"></a></span>
<span id="cb126-7"><a href="advanced-r.html#cb126-7"></a><span class="co"># error because zo could be partially matching zoo or zoom</span></span>
<span id="cb126-8"><a href="advanced-r.html#cb126-8"></a><span class="kw">f</span>(<span class="dt">yel =</span> <span class="dv">2</span>, <span class="dt">zo =</span> <span class="dv">3</span>, <span class="dv">4</span>, <span class="dt">x =</span> <span class="dv">1</span>)</span>
<span id="cb126-9"><a href="advanced-r.html#cb126-9"></a><span class="co">## Error in f(yel = 2, zo = 3, 4, x = 1): argument 2 matches multiple formal arguments</span></span>
<span id="cb126-10"><a href="advanced-r.html#cb126-10"></a></span>
<span id="cb126-11"><a href="advanced-r.html#cb126-11"></a><span class="co"># R matches unspecified arguments by position</span></span>
<span id="cb126-12"><a href="advanced-r.html#cb126-12"></a><span class="kw">f</span>(<span class="dt">yel =</span> <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dt">x =</span> <span class="dv">1</span>)</span>
<span id="cb126-13"><a href="advanced-r.html#cb126-13"></a><span class="co">## List of 4</span></span>
<span id="cb126-14"><a href="advanced-r.html#cb126-14"></a><span class="co">##  $ : num 1</span></span>
<span id="cb126-15"><a href="advanced-r.html#cb126-15"></a><span class="co">##  $ : num 2</span></span>
<span id="cb126-16"><a href="advanced-r.html#cb126-16"></a><span class="co">##  $ : num 3</span></span>
<span id="cb126-17"><a href="advanced-r.html#cb126-17"></a><span class="co">##  $ : num 4</span></span></code></pre></div>
</div>
<div id="infix-form" class="section level5" number="1.1.5.10.2">
<h5 number="1.1.5.10.2"><span class="header-section-number">1.1.5.10.2</span> Infix form</h5>
<p><code>x + y</code> where the name comes inbetween the arguments, and therefor take two arguments composed
left to right.</p>
<p>A full list of base <a href="misc-temp-r.html#infixfuncs">infix functions</a> and their <em>rank</em>, which determines the
order R processes the functions.</p>
<p>You can assign your own infix functions using <code>%{var}%</code> form using any characters except <code>%</code>.
Special characters have to be escaped when assigning, but not when calling infix functions.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="advanced-r.html#cb127-1"></a><span class="st">`</span><span class="dt">%</span><span class="ch">\\</span><span class="dt">%</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="cf">function</span>(x,y) <span class="kw">paste0</span>(<span class="st">&#39;I don</span><span class="ch">\&#39;</span><span class="st">t know; &#39;</span>, x <span class="op">+</span><span class="st"> </span>y, <span class="st">&#39;?&#39;</span>)</span>
<span id="cb127-2"><a href="advanced-r.html#cb127-2"></a></span>
<span id="cb127-3"><a href="advanced-r.html#cb127-3"></a><span class="dv">1</span> <span class="op">%\%</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb127-4"><a href="advanced-r.html#cb127-4"></a><span class="co">## [1] &quot;I don&#39;t know; 3?&quot;</span></span></code></pre></div>
<p><code>+</code> and <code>-</code> are two infix functions that can be called with only one argument.</p>
</div>
<div id="replacement-form" class="section level5" number="1.1.5.10.3">
<h5 number="1.1.5.10.3"><span class="header-section-number">1.1.5.10.3</span> Replacement form</h5>
<p>Replacement functions appear to update their value in place, <code>names() &lt;-</code>, but
they actually do create object copies you can see with <code>tracemem()</code>.</p>
<p>They must take the general form: <code>`function_name&lt;-` &lt;- function(x, value)</code> where <code>x</code> and <code>value</code>
must be the first and last arguments, with addition arguments inbetween if needed,
and must return <code>x</code>:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="advanced-r.html#cb128-1"></a><span class="co"># create replacement function to modify even position elements of a vector</span></span>
<span id="cb128-2"><a href="advanced-r.html#cb128-2"></a><span class="st">`</span><span class="dt">evens&lt;-</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="cf">function</span>(x, value){</span>
<span id="cb128-3"><a href="advanced-r.html#cb128-3"></a>  x[<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x) <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span>value</span>
<span id="cb128-4"><a href="advanced-r.html#cb128-4"></a>  x</span>
<span id="cb128-5"><a href="advanced-r.html#cb128-5"></a>}</span>
<span id="cb128-6"><a href="advanced-r.html#cb128-6"></a></span>
<span id="cb128-7"><a href="advanced-r.html#cb128-7"></a>v &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span></span>
<span id="cb128-8"><a href="advanced-r.html#cb128-8"></a></span>
<span id="cb128-9"><a href="advanced-r.html#cb128-9"></a><span class="co"># could be expressed as evens(x = v, value = 0)</span></span>
<span id="cb128-10"><a href="advanced-r.html#cb128-10"></a><span class="kw">evens</span>(v) &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb128-11"><a href="advanced-r.html#cb128-11"></a></span>
<span id="cb128-12"><a href="advanced-r.html#cb128-12"></a>v</span>
<span id="cb128-13"><a href="advanced-r.html#cb128-13"></a><span class="co">## [1] 1 0 3 0 5</span></span></code></pre></div>
</div>
<div id="specials" class="section level5" number="1.1.5.10.4">
<h5 number="1.1.5.10.4"><span class="header-section-number">1.1.5.10.4</span> Specials</h5>
<p>Everything else in R fall under the special form, including control flow (<code>if</code>,<code>for</code>, <code>break</code> etc),
subsetting operators (<code>[</code>, <code>[[</code>), parentheses and braces (<code>(</code>,<code>{</code>), <code>function</code> etc.</p>
<p>Anything you have questions about refer to `<code>?</code>function_name```</p>

</div>
</div>
</div>
<div id="environments" class="section level3" number="1.1.6">
<h3 number="1.1.6"><span class="header-section-number">1.1.6</span> Environments</h3>
<p><a href="https://adv-r.hadley.nz/environments.html">Environments</a></p>
</div>
<div id="conditionals" class="section level3" number="1.1.7">
<h3 number="1.1.7"><span class="header-section-number">1.1.7</span> Conditionals</h3>
<p><a href="https://adv-r.hadley.nz/conditions.html">Conditionals</a></p>
</div>
<div id="arfunctionals" class="section level3" number="1.1.8">
<h3 number="1.1.8"><span class="header-section-number">1.1.8</span> Functionals</h3>
<p>Functionals take a function as input and return a vector. The are commonly used
in place of <code>for</code> loops.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="advanced-r.html#cb129-1"></a><span class="co"># apply a function to all even elements of a vector x</span></span>
<span id="cb129-2"><a href="advanced-r.html#cb129-2"></a><span class="co"># use dots (...) to pass additional arguments to function</span></span>
<span id="cb129-3"><a href="advanced-r.html#cb129-3"></a>evens &lt;-<span class="st"> </span><span class="cf">function</span>(x, f, ...){</span>
<span id="cb129-4"><a href="advanced-r.html#cb129-4"></a>  <span class="kw">f</span>(x[x<span class="op">%%</span><span class="dv">2</span><span class="op">==</span><span class="dv">0</span>], ...)</span>
<span id="cb129-5"><a href="advanced-r.html#cb129-5"></a>}</span>
<span id="cb129-6"><a href="advanced-r.html#cb129-6"></a></span>
<span id="cb129-7"><a href="advanced-r.html#cb129-7"></a><span class="co"># passes na.rm=TRUE on to sum</span></span>
<span id="cb129-8"><a href="advanced-r.html#cb129-8"></a><span class="kw">evens</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">f =</span> sum, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb129-9"><a href="advanced-r.html#cb129-9"></a><span class="co">## [1] 6</span></span>
<span id="cb129-10"><a href="advanced-r.html#cb129-10"></a><span class="kw">evens</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">f =</span> length)</span>
<span id="cb129-11"><a href="advanced-r.html#cb129-11"></a><span class="co">## [1] 5</span></span></code></pre></div>
<div id="lapply-and-purrrmap" class="section level4" number="1.1.8.1">
<h4 number="1.1.8.1"><span class="header-section-number">1.1.8.1</span> lapply() and purrr::map()</h4>
<p><code>lapply()</code> and <code>purrr::map()</code> are ubiquitous functionals. They take either an
atomic or list vector and apply a function to each element and return a list:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="advanced-r.html#cb130-1"></a><span class="kw">library</span>(magrittr)</span>
<span id="cb130-2"><a href="advanced-r.html#cb130-2"></a><span class="kw">library</span>(purrr)</span>
<span id="cb130-3"><a href="advanced-r.html#cb130-3"></a><span class="co">## </span></span>
<span id="cb130-4"><a href="advanced-r.html#cb130-4"></a><span class="co">## Attaching package: &#39;purrr&#39;</span></span>
<span id="cb130-5"><a href="advanced-r.html#cb130-5"></a><span class="co">## The following object is masked from &#39;package:magrittr&#39;:</span></span>
<span id="cb130-6"><a href="advanced-r.html#cb130-6"></a><span class="co">## </span></span>
<span id="cb130-7"><a href="advanced-r.html#cb130-7"></a><span class="co">##     set_names</span></span>
<span id="cb130-8"><a href="advanced-r.html#cb130-8"></a></span>
<span id="cb130-9"><a href="advanced-r.html#cb130-9"></a>f &lt;-<span class="st"> </span><span class="cf">function</span>(x) x<span class="op">*</span><span class="dv">2</span></span>
<span id="cb130-10"><a href="advanced-r.html#cb130-10"></a></span>
<span id="cb130-11"><a href="advanced-r.html#cb130-11"></a><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, f) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</span>
<span id="cb130-12"><a href="advanced-r.html#cb130-12"></a><span class="co">## List of 3</span></span>
<span id="cb130-13"><a href="advanced-r.html#cb130-13"></a><span class="co">##  $ : num 2</span></span>
<span id="cb130-14"><a href="advanced-r.html#cb130-14"></a><span class="co">##  $ : num 4</span></span>
<span id="cb130-15"><a href="advanced-r.html#cb130-15"></a><span class="co">##  $ : num 6</span></span>
<span id="cb130-16"><a href="advanced-r.html#cb130-16"></a></span>
<span id="cb130-17"><a href="advanced-r.html#cb130-17"></a><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, f) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</span>
<span id="cb130-18"><a href="advanced-r.html#cb130-18"></a><span class="co">## List of 3</span></span>
<span id="cb130-19"><a href="advanced-r.html#cb130-19"></a><span class="co">##  $ : num 2</span></span>
<span id="cb130-20"><a href="advanced-r.html#cb130-20"></a><span class="co">##  $ : num 4</span></span>
<span id="cb130-21"><a href="advanced-r.html#cb130-21"></a><span class="co">##  $ : num 6</span></span></code></pre></div>
<p>To predict what the apply family of functionals <em>can</em> do it’s important to
consider the input and output vectors.</p>
<ul>
<li>Atomic vs List Vector input</li>
</ul>
<p>As <code>lapply()</code> or <code>map()</code> iterate through each vector element be aware of the object
actually being passed. You might be iterating over each value in an atomic
vector, or, with a list, potentially any R object (e.g. each atomic vector in a
dataframe).</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="advanced-r.html#cb131-1"></a><span class="dv">1</span><span class="op">:</span><span class="dv">10</span> <span class="op">%&gt;%</span><span class="st"> </span>.[[<span class="dv">1</span>]]</span>
<span id="cb131-2"><a href="advanced-r.html#cb131-2"></a><span class="co">## [1] 1</span></span>
<span id="cb131-3"><a href="advanced-r.html#cb131-3"></a></span>
<span id="cb131-4"><a href="advanced-r.html#cb131-4"></a><span class="kw">list</span>(<span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">2</span>), <span class="ot">TRUE</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>.[[<span class="dv">1</span>]]</span>
<span id="cb131-5"><a href="advanced-r.html#cb131-5"></a><span class="co">##      [,1] [,2]</span></span>
<span id="cb131-6"><a href="advanced-r.html#cb131-6"></a><span class="co">## [1,]    1    3</span></span>
<span id="cb131-7"><a href="advanced-r.html#cb131-7"></a><span class="co">## [2,]    2    4</span></span></code></pre></div>
<ul>
<li>Atomic vs List Vector output</li>
</ul>
<p><code>lapply()</code> and <code>map()</code> both return lists, which can contain any R object. So there
is no limit to the objects returned by the function being applied.</p>
<p>However, other functionals in the <code>apply()</code> and <code>map()</code> family can return simplified
objects like atomic vectors, in which case the applied function must return a single
value of consistent type:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="advanced-r.html#cb132-1"></a><span class="co"># aggregate functions are okay because they return single values</span></span>
<span id="cb132-2"><a href="advanced-r.html#cb132-2"></a><span class="kw">vapply</span>(mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="cf">function</span>(x) <span class="kw">sum</span>(x), <span class="dt">FUN.VALUE =</span> <span class="kw">double</span>(<span class="dv">1</span>))</span>
<span id="cb132-3"><a href="advanced-r.html#cb132-3"></a><span class="co">##    mpg    cyl   disp </span></span>
<span id="cb132-4"><a href="advanced-r.html#cb132-4"></a><span class="co">##  642.9  198.0 7383.1</span></span>
<span id="cb132-5"><a href="advanced-r.html#cb132-5"></a></span>
<span id="cb132-6"><a href="advanced-r.html#cb132-6"></a><span class="co"># this function errors because it would return an atomic vector, which cannot be an </span></span>
<span id="cb132-7"><a href="advanced-r.html#cb132-7"></a><span class="co"># element of an atomic vector</span></span>
<span id="cb132-8"><a href="advanced-r.html#cb132-8"></a><span class="kw">vapply</span>(mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="cf">function</span>(x) x<span class="op">*</span><span class="dv">2</span>, <span class="dt">FUN.VALUE =</span> <span class="kw">double</span>(<span class="dv">1</span>))</span>
<span id="cb132-9"><a href="advanced-r.html#cb132-9"></a><span class="co">## Error in vapply(mtcars[1:3], function(x) x * 2, FUN.VALUE = double(1)): values must be length 1,</span></span>
<span id="cb132-10"><a href="advanced-r.html#cb132-10"></a><span class="co">##  but FUN(X[[1]]) result is length 32</span></span></code></pre></div>
<div id="returning-atomic-vectors" class="section level5" number="1.1.8.1.1">
<h5 number="1.1.8.1.1"><span class="header-section-number">1.1.8.1.1</span> Returning atomic vectors</h5>
<p>To simplify the object type return from <code>map()</code>, <code>purrr</code> has the following <code>map_*()</code>
functionals:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="advanced-r.html#cb133-1"></a><span class="co"># character</span></span>
<span id="cb133-2"><a href="advanced-r.html#cb133-2"></a><span class="kw">map_chr</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>], <span class="cf">function</span>(x) <span class="kw">toupper</span>(x))</span>
<span id="cb133-3"><a href="advanced-r.html#cb133-3"></a><span class="co">## [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot;</span></span>
<span id="cb133-4"><a href="advanced-r.html#cb133-4"></a></span>
<span id="cb133-5"><a href="advanced-r.html#cb133-5"></a><span class="co"># logical</span></span>
<span id="cb133-6"><a href="advanced-r.html#cb133-6"></a><span class="kw">map_lgl</span>(<span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]), is.numeric)</span>
<span id="cb133-7"><a href="advanced-r.html#cb133-7"></a><span class="co">## [1]  TRUE FALSE</span></span>
<span id="cb133-8"><a href="advanced-r.html#cb133-8"></a></span>
<span id="cb133-9"><a href="advanced-r.html#cb133-9"></a><span class="co"># double</span></span>
<span id="cb133-10"><a href="advanced-r.html#cb133-10"></a><span class="kw">map_dbl</span>(mtcars, <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="kw">max</span>(x) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">8</span>) <span class="kw">max</span>(x) <span class="cf">else</span> <span class="ot">NA</span>)</span>
<span id="cb133-11"><a href="advanced-r.html#cb133-11"></a><span class="co">##   mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb </span></span>
<span id="cb133-12"><a href="advanced-r.html#cb133-12"></a><span class="co">##    NA 8.000    NA    NA 4.930 5.424    NA 1.000 1.000 5.000 8.000</span></span>
<span id="cb133-13"><a href="advanced-r.html#cb133-13"></a></span>
<span id="cb133-14"><a href="advanced-r.html#cb133-14"></a><span class="co"># integer</span></span>
<span id="cb133-15"><a href="advanced-r.html#cb133-15"></a><span class="kw">map_int</span>(<span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, T, letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]), length)</span>
<span id="cb133-16"><a href="advanced-r.html#cb133-16"></a><span class="co">## [1] 3 1 3</span></span></code></pre></div>
<p>Using <code>map()</code> may be helpful when debugging <code>map_*()</code>, as you could expect the
list and see where invalid values were returned.</p>
<p><code>vapply()</code> in base R is similar in that you can return an atomic vector of a
specific type with argument <code>FUN.VALUE</code>:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="advanced-r.html#cb134-1"></a><span class="co"># FUN.VALUE must be a vector of the type you want returned, usually length 1 to </span></span>
<span id="cb134-2"><a href="advanced-r.html#cb134-2"></a><span class="co"># indicate that the return value should be the same length as x; see ?vapply</span></span>
<span id="cb134-3"><a href="advanced-r.html#cb134-3"></a><span class="kw">vapply</span>(<span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]), is.character, <span class="dt">FUN.VALUE =</span> <span class="kw">logical</span>(<span class="dv">1</span>))</span>
<span id="cb134-4"><a href="advanced-r.html#cb134-4"></a><span class="co">## [1] FALSE  TRUE</span></span></code></pre></div>
<p>Avoid <code>sapply()</code> as the simplified value may return different types.</p>
</div>
<div id="anonymous-functions-and-purrr-formulas" class="section level5" number="1.1.8.1.2">
<h5 number="1.1.8.1.2"><span class="header-section-number">1.1.8.1.2</span> Anonymous functions and purrr formulas</h5>
<p>Anonymous functions can be used in the functional call, i.e. a function with no
bound name.</p>
<p><code>purrr</code> functions accepts a special, shorter syntax for creating anonymous functions.
It converts formulas (<code>~</code>) to anonymous functions using <code>.x</code>/<code>..1</code>, <code>.y</code>/<code>..2</code>,
<code>..3</code> etc arguments:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="advanced-r.html#cb135-1"></a><span class="kw">map_dbl</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="op">~</span><span class="st"> </span>.x <span class="op">*</span><span class="st"> </span>.y, <span class="dv">10</span>)</span>
<span id="cb135-2"><a href="advanced-r.html#cb135-2"></a><span class="co">## [1] 10 20 30</span></span>
<span id="cb135-3"><a href="advanced-r.html#cb135-3"></a></span>
<span id="cb135-4"><a href="advanced-r.html#cb135-4"></a><span class="co"># use as_mapper() to peer into the function created </span></span>
<span id="cb135-5"><a href="advanced-r.html#cb135-5"></a><span class="kw">as_mapper</span>(<span class="op">~</span><span class="st"> </span>.x <span class="op">*</span><span class="st"> </span>.y)</span>
<span id="cb135-6"><a href="advanced-r.html#cb135-6"></a><span class="co">## &lt;lambda&gt;</span></span>
<span id="cb135-7"><a href="advanced-r.html#cb135-7"></a><span class="co">## function (..., .x = ..1, .y = ..2, . = ..1) </span></span>
<span id="cb135-8"><a href="advanced-r.html#cb135-8"></a><span class="co">## .x * .y</span></span>
<span id="cb135-9"><a href="advanced-r.html#cb135-9"></a><span class="co">## attr(,&quot;class&quot;)</span></span>
<span id="cb135-10"><a href="advanced-r.html#cb135-10"></a><span class="co">## [1] &quot;rlang_lambda_function&quot; &quot;function&quot;</span></span></code></pre></div>
<p><code>purrr</code> also makes it easy to extract elements from lists by position, name, and/
name and position using the same functions, even when the lists are heavily
nested:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="advanced-r.html#cb136-1"></a>x &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb136-2"><a href="advanced-r.html#cb136-2"></a>  <span class="kw">list</span>(<span class="st">&quot;1&quot;</span>, <span class="dt">a =</span> <span class="fl">2.1</span>, <span class="dt">c =</span> <span class="kw">c</span>(<span class="fl">1.1</span>,<span class="fl">2.1</span>)),</span>
<span id="cb136-3"><a href="advanced-r.html#cb136-3"></a>  <span class="kw">list</span>(<span class="st">&quot;2&quot;</span>, <span class="dt">a =</span> <span class="fl">2.2</span>, <span class="dt">c =</span> <span class="kw">c</span>(<span class="fl">1.2</span>,<span class="fl">2.2</span>))</span>
<span id="cb136-4"><a href="advanced-r.html#cb136-4"></a>)</span>
<span id="cb136-5"><a href="advanced-r.html#cb136-5"></a></span>
<span id="cb136-6"><a href="advanced-r.html#cb136-6"></a><span class="kw">map_chr</span>(x, <span class="dv">1</span>)</span>
<span id="cb136-7"><a href="advanced-r.html#cb136-7"></a><span class="co">## [1] &quot;1&quot; &quot;2&quot;</span></span>
<span id="cb136-8"><a href="advanced-r.html#cb136-8"></a><span class="kw">map_dbl</span>(x, <span class="st">&quot;a&quot;</span>)</span>
<span id="cb136-9"><a href="advanced-r.html#cb136-9"></a><span class="co">## [1] 2.1 2.2</span></span>
<span id="cb136-10"><a href="advanced-r.html#cb136-10"></a><span class="kw">map_dbl</span>(x, <span class="kw">list</span>(<span class="st">&quot;c&quot;</span>,<span class="dv">2</span>))</span>
<span id="cb136-11"><a href="advanced-r.html#cb136-11"></a><span class="co">## [1] 2.1 2.2</span></span></code></pre></div>
</div>
<div id="dots-for-passing-arguments" class="section level5" number="1.1.8.1.3">
<h5 number="1.1.8.1.3"><span class="header-section-number">1.1.8.1.3</span> … (dots) for passing arguments</h5>
<p>In <code>lapply()</code> and <code>map()</code> additional arguments can be passed into function via
<code>...</code>:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="advanced-r.html#cb137-1"></a><span class="co"># na.rm=TRUE is passed into function sum via dots</span></span>
<span id="cb137-2"><a href="advanced-r.html#cb137-2"></a><span class="kw">lapply</span>(<span class="dt">X =</span> <span class="kw">list</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="ot">NA</span>)), <span class="dt">FUN =</span> sum, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb137-3"><a href="advanced-r.html#cb137-3"></a><span class="co">## [[1]]</span></span>
<span id="cb137-4"><a href="advanced-r.html#cb137-4"></a><span class="co">## [1] 3</span></span></code></pre></div>
<ul>
<li>decomposition</li>
</ul>
<p><code>...</code> are not decomposed; meaning, for example, if you were to pass a vector using
<code>...</code> then the entire vector would be evaluated per function call, i.e. elements
are not iterated in parallel with <code>X</code>:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="advanced-r.html#cb138-1"></a><span class="co"># for each element in 1:3, sum the vector passed in the second additonal argument .y</span></span>
<span id="cb138-2"><a href="advanced-r.html#cb138-2"></a><span class="co"># if .y were decomposed, it would return 3, 2, 1</span></span>
<span id="cb138-3"><a href="advanced-r.html#cb138-3"></a><span class="kw">map_dbl</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.y), <span class="dv">3</span><span class="op">:</span><span class="dv">1</span>)</span>
<span id="cb138-4"><a href="advanced-r.html#cb138-4"></a><span class="co">## [1] 6 6 6</span></span></code></pre></div>
<ul>
<li><code>...</code> passed arguments vs intra-function arguments</li>
</ul>
<p>Additional arguments are only evaluated once in a named function, but evaluated per
function call in anonymous functions:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="advanced-r.html#cb139-1"></a><span class="co"># since .y is passed via ... it is only evaluated once</span></span>
<span id="cb139-2"><a href="advanced-r.html#cb139-2"></a><span class="kw">map_dbl</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="op">~</span><span class="st"> </span>.x <span class="op">*</span><span class="st"> </span>.y, <span class="dt">.y=</span><span class="kw">runif</span>(<span class="dv">1</span>))</span>
<span id="cb139-3"><a href="advanced-r.html#cb139-3"></a><span class="co">## [1] 0.3513488 0.3513488 0.3513488</span></span>
<span id="cb139-4"><a href="advanced-r.html#cb139-4"></a></span>
<span id="cb139-5"><a href="advanced-r.html#cb139-5"></a><span class="co"># since .y is defined within the function, it is re-evaluated each time</span></span>
<span id="cb139-6"><a href="advanced-r.html#cb139-6"></a><span class="kw">map_dbl</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="op">~</span><span class="st"> </span>.x <span class="op">*</span><span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>))</span>
<span id="cb139-7"><a href="advanced-r.html#cb139-7"></a><span class="co">## [1] 0.2566184 0.3698173 0.4780058</span></span></code></pre></div>
</div>
<div id="apply-as-for-loop-generator" class="section level5" number="1.1.8.1.4">
<h5 number="1.1.8.1.4"><span class="header-section-number">1.1.8.1.4</span> Apply as for loop generator</h5>
<p>This is simply to document a creative use of <code>lapply</code> and <code>map</code> that might otherwise
go unoticed.</p>
<ol style="list-style-type: decimal">
<li>generating random data</li>
</ol>
<p>Map over a vector, not to transform the vector, but to thrice run a function
generating data frames of random, normally distributed data sets. Mean and sd
are defined within the function so it reevaluates each call:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="advanced-r.html#cb140-1"></a>rnorm.data &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,</span>
<span id="cb140-2"><a href="advanced-r.html#cb140-2"></a>    <span class="cf">function</span>(.x){</span>
<span id="cb140-3"><a href="advanced-r.html#cb140-3"></a>      mean =<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">100</span><span class="op">:</span><span class="dv">100</span>)[<span class="kw">sample</span>(<span class="kw">length</span>(<span class="op">-</span><span class="dv">100</span><span class="op">:</span><span class="dv">100</span>), </span>
<span id="cb140-4"><a href="advanced-r.html#cb140-4"></a>                                <span class="dt">size =</span> <span class="dv">1</span>)]</span>
<span id="cb140-5"><a href="advanced-r.html#cb140-5"></a>      sd =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">20</span>)[<span class="kw">sample</span>(<span class="kw">length</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>), </span>
<span id="cb140-6"><a href="advanced-r.html#cb140-6"></a>                          <span class="dt">size =</span> <span class="dv">1</span>)]</span>
<span id="cb140-7"><a href="advanced-r.html#cb140-7"></a>      </span>
<span id="cb140-8"><a href="advanced-r.html#cb140-8"></a>      <span class="kw">data.frame</span>(<span class="dt">rnorm =</span> <span class="kw">rnorm</span>(<span class="dt">n=</span><span class="dv">10</span>, </span>
<span id="cb140-9"><a href="advanced-r.html#cb140-9"></a>                               <span class="dt">mean=</span>mean, </span>
<span id="cb140-10"><a href="advanced-r.html#cb140-10"></a>                               <span class="dt">sd =</span> sd),</span>
<span id="cb140-11"><a href="advanced-r.html#cb140-11"></a>               <span class="dt">mean=</span>mean,</span>
<span id="cb140-12"><a href="advanced-r.html#cb140-12"></a>               <span class="dt">sd=</span>sd)</span>
<span id="cb140-13"><a href="advanced-r.html#cb140-13"></a>    }</span>
<span id="cb140-14"><a href="advanced-r.html#cb140-14"></a>)</span>
<span id="cb140-15"><a href="advanced-r.html#cb140-15"></a></span>
<span id="cb140-16"><a href="advanced-r.html#cb140-16"></a><span class="kw">str</span>(rnorm.data)</span>
<span id="cb140-17"><a href="advanced-r.html#cb140-17"></a><span class="co">## List of 3</span></span>
<span id="cb140-18"><a href="advanced-r.html#cb140-18"></a><span class="co">##  $ :&#39;data.frame&#39;:    10 obs. of  3 variables:</span></span>
<span id="cb140-19"><a href="advanced-r.html#cb140-19"></a><span class="co">##   ..$ rnorm: num [1:10] -43.8 -44.8 -45.2 -43.7 -47 ...</span></span>
<span id="cb140-20"><a href="advanced-r.html#cb140-20"></a><span class="co">##   ..$ mean : int [1:10] -45 -45 -45 -45 -45 -45 -45 -45 -45 -45</span></span>
<span id="cb140-21"><a href="advanced-r.html#cb140-21"></a><span class="co">##   ..$ sd   : int [1:10] 5 5 5 5 5 5 5 5 5 5</span></span>
<span id="cb140-22"><a href="advanced-r.html#cb140-22"></a><span class="co">##  $ :&#39;data.frame&#39;:    10 obs. of  3 variables:</span></span>
<span id="cb140-23"><a href="advanced-r.html#cb140-23"></a><span class="co">##   ..$ rnorm: num [1:10] 6.1 5.48 6.42 4.91 7.77 ...</span></span>
<span id="cb140-24"><a href="advanced-r.html#cb140-24"></a><span class="co">##   ..$ mean : int [1:10] 6 6 6 6 6 6 6 6 6 6</span></span>
<span id="cb140-25"><a href="advanced-r.html#cb140-25"></a><span class="co">##   ..$ sd   : int [1:10] 1 1 1 1 1 1 1 1 1 1</span></span>
<span id="cb140-26"><a href="advanced-r.html#cb140-26"></a><span class="co">##  $ :&#39;data.frame&#39;:    10 obs. of  3 variables:</span></span>
<span id="cb140-27"><a href="advanced-r.html#cb140-27"></a><span class="co">##   ..$ rnorm: num [1:10] -38.3 -38.2 -38.7 -36.9 -35.8 ...</span></span>
<span id="cb140-28"><a href="advanced-r.html#cb140-28"></a><span class="co">##   ..$ mean : int [1:10] -38 -38 -38 -38 -38 -38 -38 -38 -38 -38</span></span>
<span id="cb140-29"><a href="advanced-r.html#cb140-29"></a><span class="co">##   ..$ sd   : int [1:10] 1 1 1 1 1 1 1 1 1 1</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Accessing related elements accross a data frame</li>
</ol>
<p>You can apply a function using a <code>1:n</code> vector to subset dataframes by row index.
In the example below using <code>mtcars</code>, this allows me to calculate the mean <code>mpg</code>
only of cars which have a higher number of cylinders than the one being observed:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="advanced-r.html#cb141-1"></a><span class="kw">vapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(mtcars), </span>
<span id="cb141-2"><a href="advanced-r.html#cb141-2"></a>       <span class="cf">function</span>(i) mtcars[mtcars<span class="op">$</span>cyl <span class="op">&gt;</span><span class="st"> </span>mtcars[i,<span class="st">&#39;cyl&#39;</span>],<span class="st">&#39;mpg&#39;</span>] <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb141-3"><a href="advanced-r.html#cb141-3"></a><span class="st">       </span><span class="kw">mean</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb141-4"><a href="advanced-r.html#cb141-4"></a><span class="st">       </span><span class="kw">round</span>(<span class="dv">1</span>),</span>
<span id="cb141-5"><a href="advanced-r.html#cb141-5"></a>       <span class="dt">FUN.VALUE =</span> <span class="kw">double</span>(<span class="dv">1</span>)) <span class="op">%&gt;%</span></span>
<span id="cb141-6"><a href="advanced-r.html#cb141-6"></a><span class="st">  </span><span class="kw">cbind</span>(mtcars[,<span class="kw">c</span>(<span class="st">&#39;mpg&#39;</span>,<span class="st">&#39;cyl&#39;</span>)])</span>
<span id="cb141-7"><a href="advanced-r.html#cb141-7"></a><span class="co">##                        .  mpg cyl</span></span>
<span id="cb141-8"><a href="advanced-r.html#cb141-8"></a><span class="co">## Mazda RX4           15.1 21.0   6</span></span>
<span id="cb141-9"><a href="advanced-r.html#cb141-9"></a><span class="co">## Mazda RX4 Wag       15.1 21.0   6</span></span>
<span id="cb141-10"><a href="advanced-r.html#cb141-10"></a><span class="co">## Datsun 710          16.6 22.8   4</span></span>
<span id="cb141-11"><a href="advanced-r.html#cb141-11"></a><span class="co">## Hornet 4 Drive      15.1 21.4   6</span></span>
<span id="cb141-12"><a href="advanced-r.html#cb141-12"></a><span class="co">## Hornet Sportabout    NaN 18.7   8</span></span>
<span id="cb141-13"><a href="advanced-r.html#cb141-13"></a><span class="co">## Valiant             15.1 18.1   6</span></span>
<span id="cb141-14"><a href="advanced-r.html#cb141-14"></a><span class="co">## Duster 360           NaN 14.3   8</span></span>
<span id="cb141-15"><a href="advanced-r.html#cb141-15"></a><span class="co">## Merc 240D           16.6 24.4   4</span></span>
<span id="cb141-16"><a href="advanced-r.html#cb141-16"></a><span class="co">## Merc 230            16.6 22.8   4</span></span>
<span id="cb141-17"><a href="advanced-r.html#cb141-17"></a><span class="co">## Merc 280            15.1 19.2   6</span></span>
<span id="cb141-18"><a href="advanced-r.html#cb141-18"></a><span class="co">## Merc 280C           15.1 17.8   6</span></span>
<span id="cb141-19"><a href="advanced-r.html#cb141-19"></a><span class="co">## Merc 450SE           NaN 16.4   8</span></span>
<span id="cb141-20"><a href="advanced-r.html#cb141-20"></a><span class="co">## Merc 450SL           NaN 17.3   8</span></span>
<span id="cb141-21"><a href="advanced-r.html#cb141-21"></a><span class="co">## Merc 450SLC          NaN 15.2   8</span></span>
<span id="cb141-22"><a href="advanced-r.html#cb141-22"></a><span class="co">## Cadillac Fleetwood   NaN 10.4   8</span></span>
<span id="cb141-23"><a href="advanced-r.html#cb141-23"></a><span class="co">## Lincoln Continental  NaN 10.4   8</span></span>
<span id="cb141-24"><a href="advanced-r.html#cb141-24"></a><span class="co">## Chrysler Imperial    NaN 14.7   8</span></span>
<span id="cb141-25"><a href="advanced-r.html#cb141-25"></a><span class="co">## Fiat 128            16.6 32.4   4</span></span>
<span id="cb141-26"><a href="advanced-r.html#cb141-26"></a><span class="co">## Honda Civic         16.6 30.4   4</span></span>
<span id="cb141-27"><a href="advanced-r.html#cb141-27"></a><span class="co">## Toyota Corolla      16.6 33.9   4</span></span>
<span id="cb141-28"><a href="advanced-r.html#cb141-28"></a><span class="co">## Toyota Corona       16.6 21.5   4</span></span>
<span id="cb141-29"><a href="advanced-r.html#cb141-29"></a><span class="co">## Dodge Challenger     NaN 15.5   8</span></span>
<span id="cb141-30"><a href="advanced-r.html#cb141-30"></a><span class="co">## AMC Javelin          NaN 15.2   8</span></span>
<span id="cb141-31"><a href="advanced-r.html#cb141-31"></a><span class="co">## Camaro Z28           NaN 13.3   8</span></span>
<span id="cb141-32"><a href="advanced-r.html#cb141-32"></a><span class="co">## Pontiac Firebird     NaN 19.2   8</span></span>
<span id="cb141-33"><a href="advanced-r.html#cb141-33"></a><span class="co">## Fiat X1-9           16.6 27.3   4</span></span>
<span id="cb141-34"><a href="advanced-r.html#cb141-34"></a><span class="co">## Porsche 914-2       16.6 26.0   4</span></span>
<span id="cb141-35"><a href="advanced-r.html#cb141-35"></a><span class="co">## Lotus Europa        16.6 30.4   4</span></span>
<span id="cb141-36"><a href="advanced-r.html#cb141-36"></a><span class="co">## Ford Pantera L       NaN 15.8   8</span></span>
<span id="cb141-37"><a href="advanced-r.html#cb141-37"></a><span class="co">## Ferrari Dino        15.1 19.7   6</span></span>
<span id="cb141-38"><a href="advanced-r.html#cb141-38"></a><span class="co">## Maserati Bora        NaN 15.0   8</span></span>
<span id="cb141-39"><a href="advanced-r.html#cb141-39"></a><span class="co">## Volvo 142E          16.6 21.4   4</span></span></code></pre></div>
</div>
</div>
<div id="purrr-style" class="section level4" number="1.1.8.2">
<h4 number="1.1.8.2"><span class="header-section-number">1.1.8.2</span> Purrr style</h4>
<p>Below is an example of using chained purrr functionals to solve a data analysis
problem.</p>
<p>I want to extract <span class="math inline">\(\beta_1\)</span> coefficients from linear models of each sub-class
Species in the Iris dataset. This example uses base R’s <code>split()</code> to return a
list of dataframes by group:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="advanced-r.html#cb142-1"></a><span class="kw">split</span>(iris, iris<span class="op">$</span>Species) <span class="op">%&gt;%</span></span>
<span id="cb142-2"><a href="advanced-r.html#cb142-2"></a><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">lm</span>(Sepal.Length <span class="op">~</span><span class="st"> </span>Sepal.Width, </span>
<span id="cb142-3"><a href="advanced-r.html#cb142-3"></a>           <span class="dt">data =</span> .x)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb142-4"><a href="advanced-r.html#cb142-4"></a><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">coef</span>(.x)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb142-5"><a href="advanced-r.html#cb142-5"></a><span class="st">  </span><span class="kw">map_dbl</span>(<span class="st">&#39;Sepal.Width&#39;</span>)</span>
<span id="cb142-6"><a href="advanced-r.html#cb142-6"></a><span class="co">##     setosa versicolor  virginica </span></span>
<span id="cb142-7"><a href="advanced-r.html#cb142-7"></a><span class="co">##  0.6904897  0.8650777  0.9015345</span></span></code></pre></div>
<p>In Base R using functionals:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="advanced-r.html#cb143-1"></a>temp_var &lt;-<span class="st"> </span><span class="kw">split</span>(iris, iris<span class="op">$</span>Species)</span>
<span id="cb143-2"><a href="advanced-r.html#cb143-2"></a>temp_var &lt;-<span class="st"> </span><span class="kw">lapply</span>(temp_var, </span>
<span id="cb143-3"><a href="advanced-r.html#cb143-3"></a>                   <span class="cf">function</span>(x) <span class="kw">lm</span>(Sepal.Length <span class="op">~</span><span class="st"> </span>Sepal.Width, </span>
<span id="cb143-4"><a href="advanced-r.html#cb143-4"></a>                                            <span class="dt">data =</span> x))</span>
<span id="cb143-5"><a href="advanced-r.html#cb143-5"></a><span class="kw">vapply</span>(temp_var, </span>
<span id="cb143-6"><a href="advanced-r.html#cb143-6"></a>       <span class="cf">function</span>(x) <span class="kw">coef</span>(x)[[<span class="st">&#39;Sepal.Width&#39;</span>]], </span>
<span id="cb143-7"><a href="advanced-r.html#cb143-7"></a>       <span class="dt">FUN.VALUE =</span> <span class="kw">double</span>(<span class="dv">1</span>))</span>
<span id="cb143-8"><a href="advanced-r.html#cb143-8"></a><span class="co">##     setosa versicolor  virginica </span></span>
<span id="cb143-9"><a href="advanced-r.html#cb143-9"></a><span class="co">##  0.6904897  0.8650777  0.9015345</span></span></code></pre></div>
</div>
<div id="map-variants" class="section level4" number="1.1.8.3">
<h4 number="1.1.8.3"><span class="header-section-number">1.1.8.3</span> Map variants</h4>
<p>The <code>map()</code> family of functions has <em>orthagonal</em> inputs and outputs, meaning they
can be summarised in a 2d matrix[input, output]:</p>
<table>
<thead>
<tr class="header">
<th>(input)</th>
<th>List</th>
<th>Atomic Vector</th>
<th>Same type</th>
<th>Nothing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>One Argument</td>
<td><code>map()</code></td>
<td><code>map_lgl(), ...</code></td>
<td><code>modify()</code></td>
<td><code>walk()</code></td>
</tr>
<tr class="even">
<td>Two Arguments</td>
<td><code>map2()</code></td>
<td><code>map2_lgl(), ...</code></td>
<td><code>modify2()</code></td>
<td><code>walk2()</code></td>
</tr>
<tr class="odd">
<td>One Argument + index</td>
<td><code>imap()</code></td>
<td><code>imap_lgl(), ...</code></td>
<td><code>imodify()</code></td>
<td><code>iwalk()</code></td>
</tr>
<tr class="even">
<td>n Arguments</td>
<td><code>pmap()</code></td>
<td><code>pmap_lgl(), ...</code></td>
<td></td>
<td><code>pwalk()</code></td>
</tr>
</tbody>
</table>
<div id="modify" class="section level5" number="1.1.8.3.1">
<h5 number="1.1.8.3.1"><span class="header-section-number">1.1.8.3.1</span> <code>modify()</code></h5>
<p><code>modify()</code> always returns the same vector type as the input:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="advanced-r.html#cb144-1"></a><span class="co"># Logical input = logical output</span></span>
<span id="cb144-2"><a href="advanced-r.html#cb144-2"></a><span class="kw">modify</span>(<span class="kw">c</span>(T,F,T), <span class="op">~</span><span class="st"> </span><span class="kw">is.numeric</span>(.x))</span>
<span id="cb144-3"><a href="advanced-r.html#cb144-3"></a><span class="co">## [1] FALSE FALSE FALSE</span></span>
<span id="cb144-4"><a href="advanced-r.html#cb144-4"></a></span>
<span id="cb144-5"><a href="advanced-r.html#cb144-5"></a><span class="co"># Dataframe input = dataframe output</span></span>
<span id="cb144-6"><a href="advanced-r.html#cb144-6"></a><span class="kw">modify</span>(<span class="kw">data.frame</span>(<span class="dt">a=</span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">b=</span><span class="dv">10</span><span class="op">:</span><span class="dv">1</span>), <span class="op">~</span><span class="st"> </span>.x <span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb144-7"><a href="advanced-r.html#cb144-7"></a><span class="co">##       a    b</span></span>
<span id="cb144-8"><a href="advanced-r.html#cb144-8"></a><span class="co">## 1   100 1000</span></span>
<span id="cb144-9"><a href="advanced-r.html#cb144-9"></a><span class="co">## 2   200  900</span></span>
<span id="cb144-10"><a href="advanced-r.html#cb144-10"></a><span class="co">## 3   300  800</span></span>
<span id="cb144-11"><a href="advanced-r.html#cb144-11"></a><span class="co">## 4   400  700</span></span>
<span id="cb144-12"><a href="advanced-r.html#cb144-12"></a><span class="co">## 5   500  600</span></span>
<span id="cb144-13"><a href="advanced-r.html#cb144-13"></a><span class="co">## 6   600  500</span></span>
<span id="cb144-14"><a href="advanced-r.html#cb144-14"></a><span class="co">## 7   700  400</span></span>
<span id="cb144-15"><a href="advanced-r.html#cb144-15"></a><span class="co">## 8   800  300</span></span>
<span id="cb144-16"><a href="advanced-r.html#cb144-16"></a><span class="co">## 9   900  200</span></span>
<span id="cb144-17"><a href="advanced-r.html#cb144-17"></a><span class="co">## 10 1000  100</span></span></code></pre></div>
</div>
<div id="map2" class="section level5" number="1.1.8.3.2">
<h5 number="1.1.8.3.2"><span class="header-section-number">1.1.8.3.2</span> <code>map2()</code></h5>
<p><code>map2()</code> is vectorized over two arguments before the function:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="advanced-r.html#cb145-1"></a><span class="kw">map2_chr</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>],</span>
<span id="cb145-2"><a href="advanced-r.html#cb145-2"></a>     <span class="op">~</span><span class="st"> </span><span class="kw">paste0</span>(.x, .y))</span>
<span id="cb145-3"><a href="advanced-r.html#cb145-3"></a><span class="co">## [1] &quot;1a&quot; &quot;2b&quot; &quot;3c&quot;</span></span></code></pre></div>
</div>
<div id="walk" class="section level5" number="1.1.8.3.3">
<h5 number="1.1.8.3.3"><span class="header-section-number">1.1.8.3.3</span> <code>walk()</code></h5>
<p><code>walk()</code> returns a <code>NULL</code> list and is said to return “nothing”. You would use this when
you want to map a function over arguments for their side-effects, e.g. saving plots,
writing data, printing messages:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="advanced-r.html#cb146-1"></a><span class="kw">iwalk</span>(<span class="kw">c</span>(<span class="st">&#39;Tom&#39;</span>,<span class="st">&#39;Jerry&#39;</span>),</span>
<span id="cb146-2"><a href="advanced-r.html#cb146-2"></a>     <span class="op">~</span><span class="st"> </span><span class="kw">message</span>(<span class="st">&#39;Hi-ya, &#39;</span>, .x ,<span class="st">&#39;!&#39;</span>))</span>
<span id="cb146-3"><a href="advanced-r.html#cb146-3"></a><span class="co">## Hi-ya, Tom!</span></span>
<span id="cb146-4"><a href="advanced-r.html#cb146-4"></a><span class="co">## Hi-ya, Jerry!</span></span></code></pre></div>
</div>
<div id="imap" class="section level5" number="1.1.8.3.4">
<h5 number="1.1.8.3.4"><span class="header-section-number">1.1.8.3.4</span> <code>imap()</code></h5>
<p><code>imap()</code> allows you to iterate on a vector and its index in parallel. It’s similar
to <code>map2(.x, .y = names(.x))</code> if <code>.x</code> is named, or <code>map2(.x, .y = seq_along(.x))</code>
if not.</p>
<p>This is useful for labeling vectors already named, or working with vector elements
and their index position (e.g. accessing further variables at the same index
location).</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="advanced-r.html#cb147-1"></a><span class="kw">iwalk</span>(<span class="kw">split</span>(iris, iris<span class="op">$</span>Species)[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="op">~</span><span class="st"> </span><span class="kw">plot</span>(.x<span class="op">$</span>Sepal.Width, </span>
<span id="cb147-2"><a href="advanced-r.html#cb147-2"></a>                                             .x<span class="op">$</span>Sepal.Length, </span>
<span id="cb147-3"><a href="advanced-r.html#cb147-3"></a>                                             <span class="dt">main =</span> <span class="kw">paste0</span>(.y)))</span></code></pre></div>
<p><img src="01_01_R_Advanced_06_files/figure-html/unnamed-chunk-20-1.png" width="50%" /><img src="01_01_R_Advanced_06_files/figure-html/unnamed-chunk-20-2.png" width="50%" /></p>
</div>
<div id="pmap" class="section level5" number="1.1.8.3.5">
<h5 number="1.1.8.3.5"><span class="header-section-number">1.1.8.3.5</span> <code>pmap()</code></h5>
<p><code>pmap()</code> generalizes the number of input vectors to decompose by passing a
(possibly named) list for <code>.l</code>, commonly, a dataframe.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="advanced-r.html#cb148-1"></a><span class="kw">pmap_dbl</span>(<span class="dt">.l =</span> <span class="kw">data.frame</span>(<span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">b=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">c=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>), <span class="op">~</span><span class="st"> </span>.x <span class="op">+</span><span class="st"> </span>.y <span class="op">+</span><span class="st"> </span>..<span class="dv">3</span>)</span>
<span id="cb148-2"><a href="advanced-r.html#cb148-2"></a><span class="co">## [1] 3 6 9</span></span></code></pre></div>
<p>In base R you can use <code>Map()</code> or <code>mapply()</code> for similar functionality. <code>Map()</code> is
a wrapper for <code>mapply()</code> that will not try to simplify the return vector like
<code>mapply()</code> will. <code>Map()</code> decomposes all input vectors.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="advanced-r.html#cb149-1"></a><span class="kw">Map</span>(<span class="cf">function</span>(...) ..<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>..<span class="dv">2</span> <span class="op">+</span><span class="st"> </span>..<span class="dv">3</span>, </span>
<span id="cb149-2"><a href="advanced-r.html#cb149-2"></a>    <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, </span>
<span id="cb149-3"><a href="advanced-r.html#cb149-3"></a>    <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, </span>
<span id="cb149-4"><a href="advanced-r.html#cb149-4"></a>    <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</span>
<span id="cb149-5"><a href="advanced-r.html#cb149-5"></a><span class="co">## List of 3</span></span>
<span id="cb149-6"><a href="advanced-r.html#cb149-6"></a><span class="co">##  $ : int 3</span></span>
<span id="cb149-7"><a href="advanced-r.html#cb149-7"></a><span class="co">##  $ : int 6</span></span>
<span id="cb149-8"><a href="advanced-r.html#cb149-8"></a><span class="co">##  $ : int 9</span></span>
<span id="cb149-9"><a href="advanced-r.html#cb149-9"></a></span>
<span id="cb149-10"><a href="advanced-r.html#cb149-10"></a><span class="kw">mapply</span>(<span class="cf">function</span>(...) ..<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>..<span class="dv">2</span> <span class="op">+</span><span class="st"> </span>..<span class="dv">3</span>, </span>
<span id="cb149-11"><a href="advanced-r.html#cb149-11"></a>       <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, </span>
<span id="cb149-12"><a href="advanced-r.html#cb149-12"></a>       <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, </span>
<span id="cb149-13"><a href="advanced-r.html#cb149-13"></a>       <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</span>
<span id="cb149-14"><a href="advanced-r.html#cb149-14"></a><span class="co">## [1] 3 6 9</span></span></code></pre></div>
</div>
</div>
<div id="reduce" class="section level4" number="1.1.8.4">
<h4 number="1.1.8.4"><span class="header-section-number">1.1.8.4</span> Reduce</h4>
<p>The next important family of functionals is <code>reduce()</code> and is related to the
map-reduce framework that powers many “big data” stacks.</p>
<p><strong><code>reduce()</code> reduces a list to a single vector.</strong></p>
<div id="basics" class="section level5" number="1.1.8.4.1">
<h5 number="1.1.8.4.1"><span class="header-section-number">1.1.8.4.1</span> Basics</h5>
<p>In essence, <code>reduce()</code> (or <code>Reduce()</code> in base R) applys a <em>binary function</em> to
two elements of a vector, and reduces the result to the first argument of the
next function call plus the next element. For example, a four element vector:</p>
<p><code>f( f( f(1,2), 3), 4)</code></p>
<p>Or, to restate, <strong><code>reduce()</code> reduces a list to a single vector.</strong></p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="advanced-r.html#cb150-1"></a><span class="co"># Generate a 3 element list with 10 bootstrap samples from `1:20`</span></span>
<span id="cb150-2"><a href="advanced-r.html#cb150-2"></a><span class="kw">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb150-3"><a href="advanced-r.html#cb150-3"></a>v &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="op">~</span><span class="st"> </span><span class="kw">sample</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">size =</span> <span class="dv">10</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>))</span>
<span id="cb150-4"><a href="advanced-r.html#cb150-4"></a><span class="kw">str</span>(v)</span>
<span id="cb150-5"><a href="advanced-r.html#cb150-5"></a><span class="co">## List of 3</span></span>
<span id="cb150-6"><a href="advanced-r.html#cb150-6"></a><span class="co">##  $ : int [1:10] 2 16 17 5 12 7 3 11 7 13</span></span>
<span id="cb150-7"><a href="advanced-r.html#cb150-7"></a><span class="co">##  $ : int [1:10] 2 17 8 15 7 6 14 3 3 11</span></span>
<span id="cb150-8"><a href="advanced-r.html#cb150-8"></a><span class="co">##  $ : int [1:10] 18 12 2 3 10 16 11 2 9 8</span></span></code></pre></div>
<p>In this example, we want to return a set containing numbers that appear in every
element vector. <code>reduce()</code> applies <code>intersect( intersect(v[[1]], v[[2]]), v[[3]])</code>
to find 2, 3, and 11 appear in each.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="advanced-r.html#cb151-1"></a><span class="kw">reduce</span>(v, intersect)</span>
<span id="cb151-2"><a href="advanced-r.html#cb151-2"></a><span class="co">## [1]  2  3 11</span></span></code></pre></div>
<p>Or, if we wanted to return the vector element with the greatest sum:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="advanced-r.html#cb152-1"></a><span class="kw">reduce</span>(v, <span class="cf">function</span>(x, y) <span class="cf">if</span> (<span class="kw">sum</span>(x) <span class="op">&gt;=</span><span class="st"> </span><span class="kw">sum</span>(y)) x <span class="cf">else</span> y )</span>
<span id="cb152-2"><a href="advanced-r.html#cb152-2"></a><span class="co">##  [1]  2 16 17  5 12  7  3 11  7 13</span></span>
<span id="cb152-3"><a href="advanced-r.html#cb152-3"></a></span>
<span id="cb152-4"><a href="advanced-r.html#cb152-4"></a><span class="co"># check this is correct by applying sum over each element</span></span>
<span id="cb152-5"><a href="advanced-r.html#cb152-5"></a><span class="co"># reduce returned the first vector, which had the largest sum: 93</span></span>
<span id="cb152-6"><a href="advanced-r.html#cb152-6"></a><span class="kw">map_dbl</span>(v, sum)</span>
<span id="cb152-7"><a href="advanced-r.html#cb152-7"></a><span class="co">## [1] 93 86 91</span></span></code></pre></div>
</div>
<div id="accumulate" class="section level5" number="1.1.8.4.2">
<h5 number="1.1.8.4.2"><span class="header-section-number">1.1.8.4.2</span> Accumulate</h5>
<p><code>accumulate()</code> (or base R <code>Accumulate()</code>) is a <code>reduce()</code> variant that also returns
all intermediate results, rather than just the final:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="advanced-r.html#cb153-1"></a><span class="co"># reduce only returns the final result</span></span>
<span id="cb153-2"><a href="advanced-r.html#cb153-2"></a><span class="kw">reduce</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, sum)</span>
<span id="cb153-3"><a href="advanced-r.html#cb153-3"></a><span class="co">## [1] 55</span></span>
<span id="cb153-4"><a href="advanced-r.html#cb153-4"></a></span>
<span id="cb153-5"><a href="advanced-r.html#cb153-5"></a><span class="co"># accumulate returns all call results; in this case the cummulative sum</span></span>
<span id="cb153-6"><a href="advanced-r.html#cb153-6"></a><span class="kw">accumulate</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, sum)</span>
<span id="cb153-7"><a href="advanced-r.html#cb153-7"></a><span class="co">##  [1]  1  3  6 10 15 21 28 36 45 55</span></span>
<span id="cb153-8"><a href="advanced-r.html#cb153-8"></a></span>
<span id="cb153-9"><a href="advanced-r.html#cb153-9"></a><span class="co"># our example from earlier intersecting each element of v show how the set </span></span>
<span id="cb153-10"><a href="advanced-r.html#cb153-10"></a><span class="co"># reduced with each call</span></span>
<span id="cb153-11"><a href="advanced-r.html#cb153-11"></a><span class="kw">accumulate</span>(v, intersect) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</span>
<span id="cb153-12"><a href="advanced-r.html#cb153-12"></a><span class="co">## List of 3</span></span>
<span id="cb153-13"><a href="advanced-r.html#cb153-13"></a><span class="co">##  $ : int [1:10] 2 16 17 5 12 7 3 11 7 13</span></span>
<span id="cb153-14"><a href="advanced-r.html#cb153-14"></a><span class="co">##  $ : int [1:5] 2 17 7 3 11</span></span>
<span id="cb153-15"><a href="advanced-r.html#cb153-15"></a><span class="co">##  $ : int [1:3] 2 3 11</span></span></code></pre></div>
</div>
<div id="output-types" class="section level5" number="1.1.8.4.3">
<h5 number="1.1.8.4.3"><span class="header-section-number">1.1.8.4.3</span> Output types</h5>
<p><code>reduce()</code> has an important argument <code>.init</code>. If supplied, <code>.init</code> is used to
start the accumulation.</p>
<p>For example, what if you created a function using <code>reduce()</code>, except it’s later
passed a zero length vector?</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="advanced-r.html#cb154-1"></a><span class="kw">reduce</span>(<span class="kw">double</span>(), sum)</span>
<span id="cb154-2"><a href="advanced-r.html#cb154-2"></a><span class="co">## Error: `.x` is empty, and no `.init` supplied</span></span></code></pre></div>
<p>You can supply an initial value instead:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="advanced-r.html#cb155-1"></a><span class="kw">reduce</span>(<span class="kw">double</span>(), sum, <span class="dt">.init =</span> <span class="dv">0</span>)</span>
<span id="cb155-2"><a href="advanced-r.html#cb155-2"></a><span class="co">## [1] 0</span></span></code></pre></div>
</div>
<div id="multiple-inputs" class="section level5" number="1.1.8.4.4">
<h5 number="1.1.8.4.4"><span class="header-section-number">1.1.8.4.4</span> Multiple inputs</h5>
<p><code>reduce2()</code> exists, which takes two lists to decompose. The length of .y may vary
if you supply <code>.init</code>.</p>
<p>This is a very rare scenario, but the functionality exists when you need it.</p>
</div>
<div id="map-reduce" class="section level5" number="1.1.8.4.5">
<h5 number="1.1.8.4.5"><span class="header-section-number">1.1.8.4.5</span> Map-Reduce</h5>
<p>The concept of <em>map-reduce</em> is used to power “big data” applications like Hadoop.
Put simply, vectors are mapped over multiple computers and then sent back to the
<em>conductor</em>, which reduces the results into an output vector.</p>
</div>
</div>
<div id="predicates" class="section level4" number="1.1.8.5">
<h4 number="1.1.8.5"><span class="header-section-number">1.1.8.5</span> Predicates</h4>
<p><strong>Predicates</strong> are functions that return a single <code>TRUE</code>/<code>FALSE</code> like <code>is.null()</code> or
<code>all()</code>. If the predicate returns <code>TRUE</code> you say the predicate <strong>matches</strong> the
vector.</p>
<div id="predicate-functionals" class="section level5" number="1.1.8.5.1">
<h5 number="1.1.8.5.1"><span class="header-section-number">1.1.8.5.1</span> Predicate functionals</h5>
<p><strong>Predicate functionals</strong> apply a predicate to each element of a vector. Purrr
has the following variant pairs:</p>
<ul>
<li><code>some()</code> if any element matches (base R <code>any()</code>)</li>
<li><code>every()</code> if all elements match (base R <code>all()</code>)</li>
</ul>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="advanced-r.html#cb156-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,</span>
<span id="cb156-2"><a href="advanced-r.html#cb156-2"></a>                 <span class="dt">b =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>],</span>
<span id="cb156-3"><a href="advanced-r.html#cb156-3"></a>                 <span class="dt">c =</span> <span class="dv">4</span><span class="op">:</span><span class="dv">1</span>,</span>
<span id="cb156-4"><a href="advanced-r.html#cb156-4"></a>                 <span class="dt">d =</span> letters[<span class="dv">4</span><span class="op">:</span><span class="dv">1</span>],</span>
<span id="cb156-5"><a href="advanced-r.html#cb156-5"></a>                 <span class="dt">stringsAsFactors =</span> F)</span>
<span id="cb156-6"><a href="advanced-r.html#cb156-6"></a></span>
<span id="cb156-7"><a href="advanced-r.html#cb156-7"></a><span class="kw">some</span>(df, <span class="dt">.p =</span>  is.numeric)</span>
<span id="cb156-8"><a href="advanced-r.html#cb156-8"></a><span class="co">## [1] TRUE</span></span>
<span id="cb156-9"><a href="advanced-r.html#cb156-9"></a><span class="kw">every</span>(df, <span class="dt">.p =</span>  is.numeric)</span>
<span id="cb156-10"><a href="advanced-r.html#cb156-10"></a><span class="co">## [1] FALSE</span></span></code></pre></div>
<ul>
<li><code>detect()</code> return the value of the first match</li>
<li><code>detect_index</code> return the location of the first match</li>
</ul>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="advanced-r.html#cb157-1"></a><span class="kw">detect</span>(df, <span class="dt">.f =</span>  is.character)</span>
<span id="cb157-2"><a href="advanced-r.html#cb157-2"></a><span class="co">## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot;</span></span>
<span id="cb157-3"><a href="advanced-r.html#cb157-3"></a><span class="kw">detect_index</span>(df, <span class="dt">.f =</span> is.character)</span>
<span id="cb157-4"><a href="advanced-r.html#cb157-4"></a><span class="co">## [1] 2</span></span></code></pre></div>
<ul>
<li><code>keep()</code> keep all matching elements</li>
<li><code>discard()</code> discard all matching elements</li>
</ul>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="advanced-r.html#cb158-1"></a><span class="kw">keep</span>(df, <span class="dt">.p =</span> is.numeric)</span>
<span id="cb158-2"><a href="advanced-r.html#cb158-2"></a><span class="co">##   a c</span></span>
<span id="cb158-3"><a href="advanced-r.html#cb158-3"></a><span class="co">## 1 1 4</span></span>
<span id="cb158-4"><a href="advanced-r.html#cb158-4"></a><span class="co">## 2 2 3</span></span>
<span id="cb158-5"><a href="advanced-r.html#cb158-5"></a><span class="co">## 3 3 2</span></span>
<span id="cb158-6"><a href="advanced-r.html#cb158-6"></a><span class="co">## 4 4 1</span></span>
<span id="cb158-7"><a href="advanced-r.html#cb158-7"></a><span class="kw">discard</span>(df, <span class="dt">.p =</span> is.numeric)</span>
<span id="cb158-8"><a href="advanced-r.html#cb158-8"></a><span class="co">##   b d</span></span>
<span id="cb158-9"><a href="advanced-r.html#cb158-9"></a><span class="co">## 1 a d</span></span>
<span id="cb158-10"><a href="advanced-r.html#cb158-10"></a><span class="co">## 2 b c</span></span>
<span id="cb158-11"><a href="advanced-r.html#cb158-11"></a><span class="co">## 3 c b</span></span>
<span id="cb158-12"><a href="advanced-r.html#cb158-12"></a><span class="co">## 4 d a</span></span></code></pre></div>
</div>
<div id="map-variants-1" class="section level5" number="1.1.8.5.2">
<h5 number="1.1.8.5.2"><span class="header-section-number">1.1.8.5.2</span> Map variants</h5>
<p><code>map()</code> and <code>modify()</code> contain predicate variants that only apply over elements
that match a predicate:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="advanced-r.html#cb159-1"></a>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</span>
<span id="cb159-2"><a href="advanced-r.html#cb159-2"></a><span class="co">## &#39;data.frame&#39;:    4 obs. of  4 variables:</span></span>
<span id="cb159-3"><a href="advanced-r.html#cb159-3"></a><span class="co">##  $ a: int  1 2 3 4</span></span>
<span id="cb159-4"><a href="advanced-r.html#cb159-4"></a><span class="co">##  $ b: chr  &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot;</span></span>
<span id="cb159-5"><a href="advanced-r.html#cb159-5"></a><span class="co">##  $ c: int  4 3 2 1</span></span>
<span id="cb159-6"><a href="advanced-r.html#cb159-6"></a><span class="co">##  $ d: chr  &quot;d&quot; &quot;c&quot; &quot;b&quot; &quot;a&quot;</span></span>
<span id="cb159-7"><a href="advanced-r.html#cb159-7"></a></span>
<span id="cb159-8"><a href="advanced-r.html#cb159-8"></a><span class="kw">map_if</span>(df, <span class="dt">.p =</span> is.numeric, <span class="op">~</span><span class="st"> </span>.x<span class="op">*</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</span>
<span id="cb159-9"><a href="advanced-r.html#cb159-9"></a><span class="co">## List of 4</span></span>
<span id="cb159-10"><a href="advanced-r.html#cb159-10"></a><span class="co">##  $ a: num [1:4] 2 4 6 8</span></span>
<span id="cb159-11"><a href="advanced-r.html#cb159-11"></a><span class="co">##  $ b: chr [1:4] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot;</span></span>
<span id="cb159-12"><a href="advanced-r.html#cb159-12"></a><span class="co">##  $ c: num [1:4] 8 6 4 2</span></span>
<span id="cb159-13"><a href="advanced-r.html#cb159-13"></a><span class="co">##  $ d: chr [1:4] &quot;d&quot; &quot;c&quot; &quot;b&quot; &quot;a&quot;</span></span>
<span id="cb159-14"><a href="advanced-r.html#cb159-14"></a><span class="kw">modify_if</span>(df, <span class="dt">.p =</span> is.character, <span class="op">~</span><span class="st"> </span><span class="kw">toupper</span>(.x)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</span>
<span id="cb159-15"><a href="advanced-r.html#cb159-15"></a><span class="co">## &#39;data.frame&#39;:    4 obs. of  4 variables:</span></span>
<span id="cb159-16"><a href="advanced-r.html#cb159-16"></a><span class="co">##  $ a: int  1 2 3 4</span></span>
<span id="cb159-17"><a href="advanced-r.html#cb159-17"></a><span class="co">##  $ b: chr  &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot;</span></span>
<span id="cb159-18"><a href="advanced-r.html#cb159-18"></a><span class="co">##  $ c: int  4 3 2 1</span></span>
<span id="cb159-19"><a href="advanced-r.html#cb159-19"></a><span class="co">##  $ d: chr  &quot;D&quot; &quot;C&quot; &quot;B&quot; &quot;A&quot;</span></span>
<span id="cb159-20"><a href="advanced-r.html#cb159-20"></a></span>
<span id="cb159-21"><a href="advanced-r.html#cb159-21"></a><span class="co"># wrap .x in a predicate functional to discard() or keep() columns by predicate</span></span>
<span id="cb159-22"><a href="advanced-r.html#cb159-22"></a><span class="kw">map_dbl</span>(<span class="kw">discard</span>(df, is.character), <span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.x))</span>
<span id="cb159-23"><a href="advanced-r.html#cb159-23"></a><span class="co">##  a  c </span></span>
<span id="cb159-24"><a href="advanced-r.html#cb159-24"></a><span class="co">## 10 10</span></span></code></pre></div>
</div>
</div>
<div id="base-functionals" class="section level4" number="1.1.8.6">
<h4 number="1.1.8.6"><span class="header-section-number">1.1.8.6</span> Base functionals</h4>
<p>There are many more functionals in base R with mathmatrics/statistical
applications, such as <code>integrate()</code> to find the area under the curve of a
function, <code>uniroot()</code> to find where a function hits zero, and <code>optimise()</code> to
return the highest and lowest values of a function.</p>
<p>Read more in <a href="https://adv-r.hadley.nz/functionals.html#base-functionals">Base Functionals</a>.</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Portable Operating System Interface standard.<a href="advanced-r.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="programming.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="misc-temp-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
